/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/src/animation/AnimationClip.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{AnimationUtils}from"./AnimationUtils.js";import{KeyframeTrack}from"./KeyframeTrack.js";import{BooleanKeyframeTrack}from"./tracks/BooleanKeyframeTrack.js";import{ColorKeyframeTrack}from"./tracks/ColorKeyframeTrack.js";import{NumberKeyframeTrack}from"./tracks/NumberKeyframeTrack.js";import{QuaternionKeyframeTrack}from"./tracks/QuaternionKeyframeTrack.js";import{StringKeyframeTrack}from"./tracks/StringKeyframeTrack.js";import{VectorKeyframeTrack}from"./tracks/VectorKeyframeTrack.js";import{MathUtils}from"../math/MathUtils.js";import{NormalAnimationBlendMode}from"../constants.js";function AnimationClip(r,e,a,t){this.name=r,this.tracks=a,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==t?t:NormalAnimationBlendMode,this.uuid=MathUtils.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function parseKeyframeTrack(r){if(void 0===r.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=getTrackTypeForValueTypeName(r.type);if(void 0===r.times){var a=[],t=[];AnimationUtils.flattenJSON(r.keys,a,t,"value"),r.times=a,r.values=t}return void 0!==e.parse?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}Object.assign(AnimationClip,{parse:function(r){for(var e=[],a=r.tracks,t=1/(r.fps||1),n=0,i=a.length;n!==i;++n)e.push(parseKeyframeTrack(a[n]).scale(t));return new AnimationClip(r.name,r.duration,e,r.blendMode)},toJSON:function(r){for(var e=[],a=r.tracks,t={name:r.name,duration:r.duration,tracks:e,uuid:r.uuid,blendMode:r.blendMode},n=0,i=a.length;n!==i;++n)e.push(KeyframeTrack.toJSON(a[n]));return t},CreateFromMorphTargetSequence:function(r,e,a,t){for(var n=e.length,i=[],o=0;o<n;o++){var s=[],m=[];s.push((o+n-1)%n,o,(o+1)%n),m.push(0,1,0);var c=AnimationUtils.getKeyframeOrder(s);s=AnimationUtils.sortedArray(s,1,c),m=AnimationUtils.sortedArray(m,1,c),t||0!==s[0]||(s.push(n),m.push(m[0])),i.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[o].name+"]",s,m).scale(1/a))}return new AnimationClip(r,-1,i)},findByName:function(r,e){var a=r;if(!Array.isArray(r)){var t=r;a=t.geometry&&t.geometry.animations||t.animations}for(var n=0;n<a.length;n++)if(a[n].name===e)return a[n];return null},CreateClipsFromMorphTargetSequences:function(r,e,a){for(var t={},n=/^([\w-]*?)([\d]+)$/,i=0,o=r.length;i<o;i++){var s=r[i],m=s.name.match(n);if(m&&m.length>1){var c=t[f=m[1]];c||(t[f]=c=[]),c.push(s)}}var u=[];for(var f in t)u.push(AnimationClip.CreateFromMorphTargetSequence(f,t[f],e,a));return u},parseAnimation:function(r,e){if(!r)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var a=function(r,e,a,t,n){if(0!==a.length){var i=[],o=[];AnimationUtils.flattenJSON(a,i,o,t),0!==i.length&&n.push(new r(e,i,o))}},t=[],n=r.name||"default",i=r.length||-1,o=r.fps||30,s=r.blendMode,m=r.hierarchy||[],c=0;c<m.length;c++){var u=m[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var f={},l=0;l<u.length;l++)if(u[l].morphTargets)for(var h=0;h<u[l].morphTargets.length;h++)f[u[l].morphTargets[h]]=-1;for(var p in f){var k=[],y=[];for(h=0;h!==u[l].morphTargets.length;++h){var T=u[l];k.push(T.time),y.push(T.morphTarget===p?1:0)}t.push(new NumberKeyframeTrack(".morphTargetInfluence["+p+"]",k,y))}i=f.length*(o||1)}else{var d=".bones["+e[c].name+"]";a(VectorKeyframeTrack,d+".position",u,"pos",t),a(QuaternionKeyframeTrack,d+".quaternion",u,"rot",t),a(VectorKeyframeTrack,d+".scale",u,"scl",t)}}return 0===t.length?null:new AnimationClip(n,i,t,s)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var r=0,e=0,a=this.tracks.length;e!==a;++e){var t=this.tracks[e];r=Math.max(r,t.times[t.times.length-1])}return this.duration=r,this},trim:function(){for(var r=0;r<this.tracks.length;r++)this.tracks[r].trim(0,this.duration);return this},validate:function(){for(var r=!0,e=0;e<this.tracks.length;e++)r=r&&this.tracks[e].validate();return r},optimize:function(){for(var r=0;r<this.tracks.length;r++)this.tracks[r].optimize();return this},clone:function(){for(var r=[],e=0;e<this.tracks.length;e++)r.push(this.tracks[e].clone());return new AnimationClip(this.name,this.duration,r,this.blendMode)}});export{AnimationClip};
//# sourceMappingURL=/sm/d462201b87a6b3927ecd5c5770352fe071c746919d00b761ba8d2610d0412718.map