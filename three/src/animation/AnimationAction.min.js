/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/src/animation/AnimationAction.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{WrapAroundEnding,ZeroCurvatureEnding,ZeroSlopeEnding,LoopPingPong,LoopOnce,LoopRepeat,NormalAnimationBlendMode,AdditiveAnimationBlendMode}from"../constants.js";function AnimationAction(t,i,e,n){this._mixer=t,this._clip=i,this._localRoot=e||null,this.blendMode=n||i.blendMode;for(var s=i.tracks,r=s.length,a=new Array(r),o={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},h=0;h!==r;++h){var l=s[h].createInterpolant(null);a[h]=l,l.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,i){return this.loop=t,this.repetitions=i,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,i,e){if(t.fadeOut(i),this.fadeIn(i),e){var n=this._clip.duration,s=t._clip.duration,r=s/n,a=n/s;t.warp(1,r,i),this.warp(a,1,i)}return this},crossFadeTo:function(t,i,e){return t.crossFadeFrom(this,i,e)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,i,e){var n=this._mixer,s=n.time,r=this._timeScaleInterpolant,a=this.timeScale;null===r&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);var o=r.parameterPositions,h=r.sampleValues;return o[0]=s,o[1]=s+e,h[0]=t/a,h[1]=i/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,i,e,n){if(this.enabled){var s=this._startTime;if(null!==s){var r=(t-s)*e;if(r<0||0===e)return;this._startTime=null,i=e*r}i*=this._updateTimeScale(t);var a=this._updateTime(i),o=this._updateWeight(t);if(o>0){var h=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(var u=0,p=h.length;u!==p;++u)h[u].evaluate(a),l[u].accumulateAdditive(o);break;case NormalAnimationBlendMode:default:for(u=0,p=h.length;u!==p;++u)h[u].evaluate(a),l[u].accumulate(n,o)}}}else this._updateWeight(t)},_updateWeight:function(t){var i=0;if(this.enabled){i=this.weight;var e=this._weightInterpolant;if(null!==e){var n=e.evaluate(t)[0];i*=n,t>e.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=i,i},_updateTimeScale:function(t){var i=0;if(!this.paused){i=this.timeScale;var e=this._timeScaleInterpolant;if(null!==e)i*=e.evaluate(t)[0],t>e.parameterPositions[1]&&(this.stopWarping(),0===i?this.paused=!0:this.timeScale=i)}return this._effectiveTimeScale=i,i},_updateTime:function(t){var i=this.time+t,e=this._clip.duration,n=this.loop,s=this._loopCount,r=n===LoopPingPong;if(0===t)return-1===s?i:r&&1==(1&s)?e-i:i;if(n===LoopOnce){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),i>=e||i<0){var a=Math.floor(i/e);i-=e*a,s+=Math.abs(a);var o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){var h=t<0;this._setEndings(h,!h,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(r&&1==(1&s))return e-i}return i},_setEndings:function(t,i,e){var n=this._interpolantSettings;e?(n.endingStart=ZeroSlopeEnding,n.endingEnd=ZeroSlopeEnding):(n.endingStart=t?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,n.endingEnd=i?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)},_scheduleFading:function(t,i,e){var n=this._mixer,s=n.time,r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);var a=r.parameterPositions,o=r.sampleValues;return a[0]=s,o[0]=i,a[1]=s+t,o[1]=e,this}});export{AnimationAction};
//# sourceMappingURL=/sm/c8b1ca5c5dea5da687fd3c1e495604a99014daae91c69410be670f4be98f7249.map