/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/src/renderers/webgl/WebGLUniforms.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{CubeTexture}from"../../textures/CubeTexture.js";import{Texture}from"../../textures/Texture.js";import{DataTexture2DArray}from"../../textures/DataTexture2DArray.js";import{DataTexture3D}from"../../textures/DataTexture3D.js";var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,e,a){var t=r[0];if(t<=0||t>0)return r;var i=e*a,u=arrayCacheF32[i];if(void 0===u&&(u=new Float32Array(i),arrayCacheF32[i]=u),0!==e){t.toArray(u,0);for(var s=1,n=0;s!==e;++s)n+=a,r[s].toArray(u,n)}return u}function arraysEqual(r,e){if(r.length!==e.length)return!1;for(var a=0,t=r.length;a<t;a++)if(r[a]!==e[a])return!1;return!0}function copyArray(r,e){for(var a=0,t=e.length;a<t;a++)r[a]=e[a]}function allocTexUnits(r,e){var a=arrayCacheI32[e];void 0===a&&(a=new Int32Array(e),arrayCacheI32[e]=a);for(var t=0;t!==e;++t)a[t]=r.allocateTextureUnit();return a}function setValueV1f(r,e){var a=this.cache;a[0]!==e&&(r.uniform1f(this.addr,e),a[0]=e)}function setValueV2f(r,e){var a=this.cache;if(void 0!==e.x)a[0]===e.x&&a[1]===e.y||(r.uniform2f(this.addr,e.x,e.y),a[0]=e.x,a[1]=e.y);else{if(arraysEqual(a,e))return;r.uniform2fv(this.addr,e),copyArray(a,e)}}function setValueV3f(r,e){var a=this.cache;if(void 0!==e.x)a[0]===e.x&&a[1]===e.y&&a[2]===e.z||(r.uniform3f(this.addr,e.x,e.y,e.z),a[0]=e.x,a[1]=e.y,a[2]=e.z);else if(void 0!==e.r)a[0]===e.r&&a[1]===e.g&&a[2]===e.b||(r.uniform3f(this.addr,e.r,e.g,e.b),a[0]=e.r,a[1]=e.g,a[2]=e.b);else{if(arraysEqual(a,e))return;r.uniform3fv(this.addr,e),copyArray(a,e)}}function setValueV4f(r,e){var a=this.cache;if(void 0!==e.x)a[0]===e.x&&a[1]===e.y&&a[2]===e.z&&a[3]===e.w||(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w);else{if(arraysEqual(a,e))return;r.uniform4fv(this.addr,e),copyArray(a,e)}}function setValueM2(r,e){var a=this.cache,t=e.elements;if(void 0===t){if(arraysEqual(a,e))return;r.uniformMatrix2fv(this.addr,!1,e),copyArray(a,e)}else{if(arraysEqual(a,t))return;mat2array.set(t),r.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(a,t)}}function setValueM3(r,e){var a=this.cache,t=e.elements;if(void 0===t){if(arraysEqual(a,e))return;r.uniformMatrix3fv(this.addr,!1,e),copyArray(a,e)}else{if(arraysEqual(a,t))return;mat3array.set(t),r.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(a,t)}}function setValueM4(r,e){var a=this.cache,t=e.elements;if(void 0===t){if(arraysEqual(a,e))return;r.uniformMatrix4fv(this.addr,!1,e),copyArray(a,e)}else{if(arraysEqual(a,t))return;mat4array.set(t),r.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(a,t)}}function setValueT1(r,e,a){var t=this.cache,i=a.allocateTextureUnit();t[0]!==i&&(r.uniform1i(this.addr,i),t[0]=i),a.safeSetTexture2D(e||emptyTexture,i)}function setValueT2DArray1(r,e,a){var t=this.cache,i=a.allocateTextureUnit();t[0]!==i&&(r.uniform1i(this.addr,i),t[0]=i),a.setTexture2DArray(e||emptyTexture2dArray,i)}function setValueT3D1(r,e,a){var t=this.cache,i=a.allocateTextureUnit();t[0]!==i&&(r.uniform1i(this.addr,i),t[0]=i),a.setTexture3D(e||emptyTexture3d,i)}function setValueT6(r,e,a){var t=this.cache,i=a.allocateTextureUnit();t[0]!==i&&(r.uniform1i(this.addr,i),t[0]=i),a.safeSetTextureCube(e||emptyCubeTexture,i)}function setValueV1i(r,e){var a=this.cache;a[0]!==e&&(r.uniform1i(this.addr,e),a[0]=e)}function setValueV2i(r,e){var a=this.cache;arraysEqual(a,e)||(r.uniform2iv(this.addr,e),copyArray(a,e))}function setValueV3i(r,e){var a=this.cache;arraysEqual(a,e)||(r.uniform3iv(this.addr,e),copyArray(a,e))}function setValueV4i(r,e){var a=this.cache;arraysEqual(a,e)||(r.uniform4iv(this.addr,e),copyArray(a,e))}function setValueV1ui(r,e){var a=this.cache;a[0]!==e&&(r.uniform1ui(this.addr,e),a[0]=e)}function getSingularSetter(r){switch(r){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(r,e){r.uniform1fv(this.addr,e)}function setValueV1iArray(r,e){r.uniform1iv(this.addr,e)}function setValueV2iArray(r,e){r.uniform2iv(this.addr,e)}function setValueV3iArray(r,e){r.uniform3iv(this.addr,e)}function setValueV4iArray(r,e){r.uniform4iv(this.addr,e)}function setValueV2fArray(r,e){var a=flatten(e,this.size,2);r.uniform2fv(this.addr,a)}function setValueV3fArray(r,e){var a=flatten(e,this.size,3);r.uniform3fv(this.addr,a)}function setValueV4fArray(r,e){var a=flatten(e,this.size,4);r.uniform4fv(this.addr,a)}function setValueM2Array(r,e){var a=flatten(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,a)}function setValueM3Array(r,e){var a=flatten(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,a)}function setValueM4Array(r,e){var a=flatten(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,a)}function setValueT1Array(r,e,a){var t=e.length,i=allocTexUnits(a,t);r.uniform1iv(this.addr,i);for(var u=0;u!==t;++u)a.safeSetTexture2D(e[u]||emptyTexture,i[u])}function setValueT6Array(r,e,a){var t=e.length,i=allocTexUnits(a,t);r.uniform1iv(this.addr,i);for(var u=0;u!==t;++u)a.safeSetTextureCube(e[u]||emptyCubeTexture,i[u])}function getPureArraySetter(r){switch(r){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(r,e,a){this.id=r,this.addr=a,this.cache=[],this.setValue=getSingularSetter(e.type)}function PureArrayUniform(r,e,a){this.id=r,this.addr=a,this.cache=[],this.size=e.size,this.setValue=getPureArraySetter(e.type)}function StructuredUniform(r){this.id=r,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(r){var e=this.cache;r instanceof Float32Array&&e.length!==r.length&&(this.cache=new Float32Array(r.length)),copyArray(e,r)},StructuredUniform.prototype.setValue=function(r,e,a){for(var t=this.seq,i=0,u=t.length;i!==u;++i){var s=t[i];s.setValue(r,e[s.id],a)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(r,e){r.seq.push(e),r.map[e.id]=e}function parseUniform(r,e,a){var t=r.name,i=t.length;for(RePathPart.lastIndex=0;;){var u=RePathPart.exec(t),s=RePathPart.lastIndex,n=u[1],f="]"===u[2],o=u[3];if(f&&(n|=0),void 0===o||"["===o&&s+2===i){addUniform(a,void 0===o?new SingleUniform(n,r,e):new PureArrayUniform(n,r,e));break}var c=a.map[n];void 0===c&&addUniform(a,c=new StructuredUniform(n)),a=c}}function WebGLUniforms(r,e){this.seq=[],this.map={};for(var a=r.getProgramParameter(e,r.ACTIVE_UNIFORMS),t=0;t<a;++t){var i=r.getActiveUniform(e,t);parseUniform(i,r.getUniformLocation(e,i.name),this)}}WebGLUniforms.prototype.setValue=function(r,e,a,t){var i=this.map[e];void 0!==i&&i.setValue(r,a,t)},WebGLUniforms.prototype.setOptional=function(r,e,a){var t=e[a];void 0!==t&&this.setValue(r,a,t)},WebGLUniforms.upload=function(r,e,a,t){for(var i=0,u=e.length;i!==u;++i){var s=e[i],n=a[s.id];!1!==n.needsUpdate&&s.setValue(r,n.value,t)}},WebGLUniforms.seqWithValue=function(r,e){for(var a=[],t=0,i=r.length;t!==i;++t){var u=r[t];u.id in e&&a.push(u)}return a};export{WebGLUniforms};
//# sourceMappingURL=/sm/6f100d9490bca3e60cd0b2d7ae26f9b2752ed635230c8bf2286e2265959f20fa.map