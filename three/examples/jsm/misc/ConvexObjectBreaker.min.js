/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/misc/ConvexObjectBreaker.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Line3,Mesh,Plane,Vector3}from"../../../build/three.module.js";import{ConvexBufferGeometry}from"../geometries/ConvexGeometry.js";var ConvexObjectBreaker=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3,this.tempCM2=new Vector3,this.tempVector3=new Vector3,this.tempVector3_2=new Vector3,this.tempVector3_3=new Vector3,this.tempVector3_P0=new Vector3,this.tempVector3_P1=new Vector3,this.tempVector3_P2=new Vector3,this.tempVector3_N0=new Vector3,this.tempVector3_N1=new Vector3,this.tempVector3_AB=new Vector3,this.tempVector3_CB=new Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var r=0;r<900;r++)this.segments[r]=!1};ConvexObjectBreaker.prototype={constructor:ConvexObjectBreaker,prepareBreakableObject:function(e,t,r,o,n){e.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var s=e.userData;s.mass=t,s.velocity=r.clone(),s.angularVelocity=o.clone(),s.breakable=n},subdivideByImpact:function(e,t,r,o,n){var s=[],a=this.tempPlane1,i=this.tempPlane2;this.tempVector3.addVectors(t,r),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var c=n+o,m=this;return function n(p,l,h,u){if(Math.random()<.05*u||u>c)s.push(p);else{var v=Math.PI;0===u?(i.normal.copy(a.normal),i.constant=a.constant):u<=o?(v=(h-l)*(.2+.6*Math.random())+l,m.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(r,v).add(t),i.setFromCoplanarPoints(t,m.tempVector3,m.tempVector3_2)):(v=(.5*(1&u)+.2*(2-Math.random()))*Math.PI,m.tempVector3_2.copy(t).sub(p.position).applyAxisAngle(r,v).add(p.position),m.tempVector3_3.copy(r).add(p.position),i.setFromCoplanarPoints(p.position,m.tempVector3_3,m.tempVector3_2)),m.cutByPlane(p,i,m.tempResultObjects);var V=m.tempResultObjects.object1,f=m.tempResultObjects.object2;V&&n(V,l,v,u+1),f&&n(f,v,h,u+1)}}(e,0,2*Math.PI,0),s},cutByPlane:function(e,t,r){var o=e.geometry,n=o.attributes.position.array,s=o.attributes.normal.array,a=n.length/3,i=a/3,c=o.getIndex();function m(e,t){var r=3*e+t;return c?c[r]:r}c&&(i=(c=c.array).length/3);for(var p=[],l=[],h=this.smallDelta,u=a*a,v=0;v<u;v++)this.segments[v]=!1;var V=this.tempVector3_P0,f=this.tempVector3_P1,b=this.tempVector3_N0,y=this.tempVector3_N1;for(v=0;v<i-1;v++){var d=m(v,0),C=m(v,1),x=m(v,2);b.set(s[d],s[d]+1,s[d]+2);for(var j=v+1;j<i;j++){var B=m(j,0),P=m(j,1),g=m(j,2);y.set(s[B],s[B]+1,s[B]+2),1-b.dot(y)<h&&(d===B||d===P||d===g?C===B||C===P||C===g?(this.segments[d*a+C]=!0,this.segments[C*a+d]=!0):(this.segments[x*a+d]=!0,this.segments[d*a+x]=!0):C!==B&&C!==P&&C!==g||(this.segments[x*a+C]=!0,this.segments[C*a+x]=!0))}}var M=this.tempPlane_Cut;e.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(t,e.matrix,M);for(v=0;v<i;v++)for(var w=m(v,0),O=m(v,1),_=m(v,2),k=0;k<3;k++){var z=0===k?w:1===k?O:_,I=0===k?O:1===k?_:w;if(!this.segments[z*a+I]){this.segments[z*a+I]=!0,this.segments[I*a+z]=!0,V.set(n[3*z],n[3*z+1],n[3*z+2]),f.set(n[3*I],n[3*I+1],n[3*I+2]);var F=0;(L=M.distanceToPoint(V))>h?(F=2,l.push(V.clone())):L<-h?(F=1,p.push(V.clone())):(F=3,p.push(V.clone()),l.push(V.clone()));var L,D=0;if((L=M.distanceToPoint(f))>h?(D=2,l.push(f.clone())):L<-h?(D=1,p.push(f.clone())):(D=3,p.push(f.clone()),l.push(f.clone())),1===F&&2===D||2===F&&1===D){this.tempLine1.start.copy(V),this.tempLine1.end.copy(f);var S=new Vector3;if(void 0===(S=M.intersectLine(this.tempLine1,S)))return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;p.push(S),l.push(S.clone())}}}var T=.5*e.userData.mass;this.tempCM1.set(0,0,0);var G=0,A=p.length;if(A>0){for(v=0;v<A;v++)this.tempCM1.add(p[v]);this.tempCM1.divideScalar(A);for(v=0;v<A;v++){(N=p[v]).sub(this.tempCM1),G=Math.max(G,N.x,N.y,N.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var R=0,q=l.length;if(q>0){for(v=0;v<q;v++)this.tempCM2.add(l[v]);this.tempCM2.divideScalar(q);for(v=0;v<q;v++){var N;(N=l[v]).sub(this.tempCM2),R=Math.max(R,N.x,N.y,N.z)}this.tempCM2.add(e.position)}var E=null,H=null,J=0;return A>4&&((E=new Mesh(new ConvexBufferGeometry(p),e.material)).position.copy(this.tempCM1),E.quaternion.copy(e.quaternion),this.prepareBreakableObject(E,T,e.userData.velocity,e.userData.angularVelocity,2*G>this.minSizeForBreak),J++),q>4&&((H=new Mesh(new ConvexBufferGeometry(l),e.material)).position.copy(this.tempCM2),H.quaternion.copy(e.quaternion),this.prepareBreakableObject(H,T,e.userData.velocity,e.userData.angularVelocity,2*R>this.minSizeForBreak),J++),r.object1=E,r.object2=H,J}},ConvexObjectBreaker.transformFreeVector=function(e,t){var r=e.x,o=e.y,n=e.z,s=t.elements;return e.x=s[0]*r+s[4]*o+s[8]*n,e.y=s[1]*r+s[5]*o+s[9]*n,e.z=s[2]*r+s[6]*o+s[10]*n,e},ConvexObjectBreaker.transformFreeVectorInverse=function(e,t){var r=e.x,o=e.y,n=e.z,s=t.elements;return e.x=s[0]*r+s[1]*o+s[2]*n,e.y=s[4]*r+s[5]*o+s[6]*n,e.z=s[8]*r+s[9]*o+s[10]*n,e},ConvexObjectBreaker.transformTiedVectorInverse=function(e,t){var r=e.x,o=e.y,n=e.z,s=t.elements;return e.x=s[0]*r+s[1]*o+s[2]*n-s[12],e.y=s[4]*r+s[5]*o+s[6]*n-s[13],e.z=s[8]*r+s[9]*o+s[10]*n-s[14],e},ConvexObjectBreaker.transformPlaneToLocalSpace=function(){var e=new Vector3;return function(t,r,o){o.normal.copy(t.normal),o.constant=t.constant;var n=ConvexObjectBreaker.transformTiedVectorInverse(t.coplanarPoint(e),r);ConvexObjectBreaker.transformFreeVectorInverse(o.normal,r),o.constant=-n.dot(o.normal)}}();export{ConvexObjectBreaker};
//# sourceMappingURL=/sm/4f3f06c087f6f25d66b53bec807e9f46c81213a3ba90503cf730707364a11201.map