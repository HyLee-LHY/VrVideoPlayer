/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/objects/Refractor.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Color,LinearEncoding,LinearFilter,MathUtils,Matrix4,Mesh,PerspectiveCamera,Plane,Quaternion,RGBFormat,ShaderMaterial,UniformsUtils,Vector3,Vector4,WebGLRenderTarget}from"../../../build/three.module.js";var Refractor=function(e,r){Mesh.call(this,e),this.type="Refractor";var t=this,a=void 0!==(r=r||{}).color?new Color(r.color):new Color(8355711),o=r.textureWidth||512,n=r.textureHeight||512,i=r.clipBias||0,l=r.shader||Refractor.RefractorShader,s=void 0!==r.encoding?r.encoding:LinearEncoding,c=new PerspectiveCamera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;var d=new Plane,m=new Matrix4,u=new WebGLRenderTarget(o,n,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBFormat,stencilBuffer:!1,encoding:s});MathUtils.isPowerOfTwo(o)&&MathUtils.isPowerOfTwo(n)||(u.texture.generateMipmaps=!1),this.material=new ShaderMaterial({uniforms:UniformsUtils.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,transparent:!0}),this.material.uniforms.color.value=a,this.material.uniforms.tDiffuse.value=u.texture,this.material.uniforms.textureMatrix.value=m;var v,f,x,p,b,h,g,w,M=(v=new Vector3,f=new Vector3,x=new Matrix4,p=new Vector3,b=new Vector3,function(e){return v.setFromMatrixPosition(t.matrixWorld),f.setFromMatrixPosition(e.matrixWorld),p.subVectors(v,f),x.extractRotation(t.matrixWorld),b.set(0,0,1),b.applyMatrix4(x),p.dot(b)<0}),y=function(){var e=new Vector3,r=new Vector3,a=new Quaternion,o=new Vector3;return function(){t.matrixWorld.decompose(r,a,o),e.set(0,0,1).applyQuaternion(a).normalize(),e.negate(),d.setFromNormalAndCoplanarPoint(e,r)}}(),R=(h=new Plane,g=new Vector4,w=new Vector4,function(e){c.matrixWorld.copy(e.matrixWorld),c.matrixWorldInverse.getInverse(c.matrixWorld),c.projectionMatrix.copy(e.projectionMatrix),c.far=e.far,h.copy(d),h.applyMatrix4(c.matrixWorldInverse),g.set(h.normal.x,h.normal.y,h.normal.z,h.constant);var r=c.projectionMatrix;w.x=(Math.sign(g.x)+r.elements[8])/r.elements[0],w.y=(Math.sign(g.y)+r.elements[9])/r.elements[5],w.z=-1,w.w=(1+r.elements[10])/r.elements[14],g.multiplyScalar(2/g.dot(w)),r.elements[2]=g.x,r.elements[6]=g.y,r.elements[10]=g.z+1-i,r.elements[14]=g.w});this.onBeforeRender=function(e,r,a){!0!==a.userData.refractor&&!0!=!M(a)&&(y(),function(e){m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(e.projectionMatrix),m.multiply(e.matrixWorldInverse),m.multiply(t.matrixWorld)}(a),R(a),function(e,r,a){t.visible=!1;var o=e.getRenderTarget(),n=e.xr.enabled,i=e.shadowMap.autoUpdate;e.xr.enabled=!1,e.shadowMap.autoUpdate=!1,e.setRenderTarget(u),!1===e.autoClear&&e.clear(),e.render(r,c),e.xr.enabled=n,e.shadowMap.autoUpdate=i,e.setRenderTarget(o);var l=a.viewport;void 0!==l&&e.state.viewport(l),t.visible=!0}(e,r,a))},this.getRenderTarget=function(){return u}};Refractor.prototype=Object.create(Mesh.prototype),Refractor.prototype.constructor=Refractor,Refractor.RefractorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};export{Refractor};
//# sourceMappingURL=/sm/0cb8a2a9ffb4962d18393cc66544b9a49cfa438e536c6c0da94320b07407728d.map