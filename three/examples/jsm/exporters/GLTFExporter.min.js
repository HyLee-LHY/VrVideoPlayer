/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/exporters/GLTFExporter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferAttribute,BufferGeometry,ClampToEdgeWrapping,DoubleSide,InterpolateDiscrete,InterpolateLinear,LinearFilter,LinearMipmapLinearFilter,LinearMipmapNearestFilter,MathUtils,MirroredRepeatWrapping,NearestFilter,NearestMipmapLinearFilter,NearestMipmapNearestFilter,PropertyBinding,RGBAFormat,RepeatWrapping,Scene,Vector3}from"../../../build/three.module.js";var WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},THREE_TO_WEBGL={};THREE_TO_WEBGL[NearestFilter]=WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[NearestMipmapNearestFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[NearestMipmapLinearFilter]=WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[LinearFilter]=WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[LinearMipmapNearestFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[LinearMipmapLinearFilter]=WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[ClampToEdgeWrapping]=WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[RepeatWrapping]=WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[MirroredRepeatWrapping]=WEBGL_CONSTANTS.MIRRORED_REPEAT;var PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},GLTFExporter=function(){};GLTFExporter.prototype={constructor:GLTFExporter,parse:function(e,t,r){var a={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],forcePowerOfTwoTextures:!1,includeCustomExtensions:!1};(r=Object.assign({},a,r)).animations.length>0&&(r.trs=!0);var n,i={asset:{version:"2.0",generator:"GLTFExporter"}},s=0,o=[],l=[],u=new Map,p=[],f={},m={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},c=new Map,h=0;function g(e){return c.has(e)||c.set(e,h++),c.get(e)}function T(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}function E(e){return 4*Math.ceil(e/4)}function d(e,t){t=t||0;var r=E(e.byteLength);if(r!==e.byteLength){var a=new Uint8Array(r);if(a.set(new Uint8Array(e)),0!==t)for(var n=e.byteLength;n<r;n++)a[n]=t;return a.buffer}return e}function v(e,t){if(0!==Object.keys(e.userData).length)try{var a=JSON.parse(JSON.stringify(e.userData));if(r.includeCustomExtensions&&a.gltfExtensions){for(var n in void 0===t.extensions&&(t.extensions={}),a.gltfExtensions)t.extensions[n]=a.gltfExtensions[n],f[n]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(t.extras=a)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}function N(e,t){var r=!1,a={};0===t.offset.x&&0===t.offset.y||(a.offset=t.offset.toArray(),r=!0),0!==t.rotation&&(a.rotation=t.rotation,r=!0),1===t.repeat.x&&1===t.repeat.y||(a.scale=t.repeat.toArray(),r=!0),r&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,f.KHR_texture_transform=!0)}function S(e){return i.buffers||(i.buffers=[{byteLength:0}]),o.push(e),0}function L(e,t,a,n){var o;if(e.array.constructor===Float32Array)o=WEBGL_CONSTANTS.FLOAT;else if(e.array.constructor===Uint32Array)o=WEBGL_CONSTANTS.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)o=WEBGL_CONSTANTS.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");o=WEBGL_CONSTANTS.UNSIGNED_BYTE}if(void 0===a&&(a=0),void 0===n&&(n=e.count),r.truncateDrawRange&&void 0!==t&&null===t.index){var l=a+n,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;a=Math.max(a,t.drawRange.start),(n=Math.min(l,u)-a)<0&&(n=0)}if(0===n)return null;var p,f=function(e,t,r){for(var a={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},n=t;n<t+r;n++)for(var i=0;i<e.itemSize;i++){var s=e.array[n*e.itemSize+i];a.min[i]=Math.min(a.min[i],s),a.max[i]=Math.max(a.max[i],s)}return a}(e,a,n);void 0!==t&&(p=e===t.index?WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS.ARRAY_BUFFER);var m=function(e,t,r,a,n){var o;i.bufferViews||(i.bufferViews=[]),o=t===WEBGL_CONSTANTS.UNSIGNED_BYTE?1:t===WEBGL_CONSTANTS.UNSIGNED_SHORT?2:4;for(var l=E(a*e.itemSize*o),u=new DataView(new ArrayBuffer(l)),p=0,f=r;f<r+a;f++)for(var m=0;m<e.itemSize;m++){var c;e.itemSize>4?c=e.array[f*e.itemSize+m]:0===m?c=e.getX(f):1===m?c=e.getY(f):2===m?c=e.getZ(f):3===m&&(c=e.getW(f)),t===WEBGL_CONSTANTS.FLOAT?u.setFloat32(p,c,!0):t===WEBGL_CONSTANTS.UNSIGNED_INT?u.setUint32(p,c,!0):t===WEBGL_CONSTANTS.UNSIGNED_SHORT?u.setUint16(p,c,!0):t===WEBGL_CONSTANTS.UNSIGNED_BYTE&&u.setUint8(p,c),p+=o}var h={buffer:S(u.buffer),byteOffset:s,byteLength:l};return void 0!==n&&(h.target=n),n===WEBGL_CONSTANTS.ARRAY_BUFFER&&(h.byteStride=e.itemSize*o),s+=l,i.bufferViews.push(h),{id:i.bufferViews.length-1,byteLength:0}}(e,o,a,n,p),c={bufferView:m.id,byteOffset:m.byteOffset,componentType:o,count:n,max:f.max,min:f.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(c.normalized=!0),i.accessors||(i.accessors=[]),i.accessors.push(c),i.accessors.length-1}function y(e,t,a){m.images.has(e)||m.images.set(e,{});var o=m.images.get(e),u=t===RGBAFormat?"image/png":"image/jpeg",p=u+":flipY/"+a.toString();if(void 0!==o[p])return o[p];i.images||(i.images=[]);var f={mimeType:u};if(r.embedImages){var c=n=n||document.createElement("canvas");c.width=Math.min(e.width,r.maxTextureSize),c.height=Math.min(e.height,r.maxTextureSize),r.forcePowerOfTwoTextures&&!function(e){return MathUtils.isPowerOfTwo(e.width)&&MathUtils.isPowerOfTwo(e.height)}(c)&&(console.warn("GLTFExporter: Resized non-power-of-two image.",e),c.width=MathUtils.floorPowerOfTwo(c.width),c.height=MathUtils.floorPowerOfTwo(c.height));var h=c.getContext("2d");!0===a&&(h.translate(0,c.height),h.scale(1,-1)),h.drawImage(e,0,0,c.width,c.height),!0===r.binary?l.push(new Promise(function(e){c.toBlob(function(t){(function(e){return i.bufferViews||(i.bufferViews=[]),new Promise(function(t){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=d(r.result),a={buffer:S(e),byteOffset:s,byteLength:e.byteLength};s+=e.byteLength,i.bufferViews.push(a),t(i.bufferViews.length-1)}})})(t).then(function(t){f.bufferView=t,e()})},u)})):f.uri=c.toDataURL(u)}else f.uri=e.src;i.images.push(f);var g=i.images.length-1;return o[p]=g,g}function A(e){i.samplers||(i.samplers=[]);var t={magFilter:THREE_TO_WEBGL[e.magFilter],minFilter:THREE_TO_WEBGL[e.minFilter],wrapS:THREE_TO_WEBGL[e.wrapS],wrapT:THREE_TO_WEBGL[e.wrapT]};return i.samplers.push(t),i.samplers.length-1}function _(e){if(m.textures.has(e))return m.textures.get(e);i.textures||(i.textures=[]);var t={sampler:A(e),source:y(e.image,e.format,e.flipY)};e.name&&(t.name=e.name),i.textures.push(t);var r=i.textures.length-1;return m.textures.set(e,r),r}function R(e){if(m.materials.has(e))return m.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);var t={pbrMetallicRoughness:{}};e.isMeshBasicMaterial?(t.extensions={KHR_materials_unlit:{}},f.KHR_materials_unlit=!0):e.isGLTFSpecularGlossinessMaterial?(t.extensions={KHR_materials_pbrSpecularGlossiness:{}},f.KHR_materials_pbrSpecularGlossiness=!0):e.isMeshStandardMaterial||console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(T(r,[1,1,1,1])||(t.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(t.pbrMetallicRoughness.metallicFactor=e.metalness,t.pbrMetallicRoughness.roughnessFactor=e.roughness):e.isMeshBasicMaterial?(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9):(t.pbrMetallicRoughness.metallicFactor=.5,t.pbrMetallicRoughness.roughnessFactor=.5),e.isGLTFSpecularGlossinessMaterial){t.pbrMetallicRoughness.baseColorFactor&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var a=[1,1,1];e.specular.toArray(a,0),t.extensions.KHR_materials_pbrSpecularGlossiness.specularFactor=a,t.extensions.KHR_materials_pbrSpecularGlossiness.glossinessFactor=e.glossiness}if(e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var n={index:_(e.metalnessMap)};N(n,e.metalnessMap),t.pbrMetallicRoughness.metallicRoughnessTexture=n}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var s={index:_(e.map)};N(s,e.map),e.isGLTFSpecularGlossinessMaterial&&(t.extensions.KHR_materials_pbrSpecularGlossiness.diffuseTexture=s),t.pbrMetallicRoughness.baseColorTexture=s}if(e.isGLTFSpecularGlossinessMaterial&&e.specularMap){var o={index:_(e.specularMap)};N(o,e.specularMap),t.extensions.KHR_materials_pbrSpecularGlossiness.specularGlossinessTexture=o}if(e.emissive){var l=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();if(T(l,[0,0,0])||(t.emissiveFactor=l),e.emissiveMap){var u={index:_(e.emissiveMap)};N(u,e.emissiveMap),t.emissiveTexture=u}}if(e.normalMap){var p={index:_(e.normalMap)};e.normalScale&&-1!==e.normalScale.x&&(e.normalScale.x!==e.normalScale.y&&console.warn("THREE.GLTFExporter: Normal scale components are different, ignoring Y and exporting X."),p.scale=e.normalScale.x),N(p,e.normalMap),t.normalTexture=p}if(e.aoMap){var c={index:_(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(c.strength=e.aoMapIntensity),N(c,e.aoMap),t.occlusionTexture=c}e.transparent?t.alphaMode="BLEND":e.alphaTest>0&&(t.alphaMode="MASK",t.alphaCutoff=e.alphaTest),e.side===DoubleSide&&(t.doubleSided=!0),""!==e.name&&(t.name=e.name),v(e,t),i.materials.push(t);var h=i.materials.length-1;return m.materials.set(e,h),h}function b(e){var t=[e.geometry.uuid];if(Array.isArray(e.material))for(var r=0,a=e.material.length;r<a;r++)t.push(e.material[r].uuid);else t.push(e.material.uuid);var n=t.join(":");if(m.meshes.has(n))return m.meshes.get(n);var s,o=e.geometry;s=e.isLineSegments?WEBGL_CONSTANTS.LINES:e.isLineLoop?WEBGL_CONSTANTS.LINE_LOOP:e.isLine?WEBGL_CONSTANTS.LINE_STRIP:e.isPoints?WEBGL_CONSTANTS.POINTS:e.material.wireframe?WEBGL_CONSTANTS.LINES:WEBGL_CONSTANTS.TRIANGLES,o.isBufferGeometry||(console.warn("GLTFExporter: Exporting THREE.Geometry will increase file size. Use BufferGeometry instead."),o=(new BufferGeometry).setFromObject(e));var l={},u={},p=[],f=[],c={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},h=o.getAttribute("normal");void 0===h||function(e){if(m.attributesNormalized.has(e))return!1;for(var t=new Vector3,r=0,a=e.count;r<a;r++)if(Math.abs(t.fromArray(e.array,3*r).length()-1)>5e-4)return!1;return!0}(h)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",function(e){if(m.attributesNormalized.has(e))return m.attributesNormalized.get(e);for(var t=e.clone(),r=new Vector3,a=0,n=t.count;a<n;a++)r.fromArray(t.array,3*a),0===r.x&&0===r.y&&0===r.z?r.setX(1):r.normalize(),r.toArray(t.array,3*a);return m.attributesNormalized.set(e,t),t}(h)));var T=null;for(var E in o.attributes)if("morph"!==E.substr(0,5)){var d=o.attributes[E];E=c[E]||E.toUpperCase();if(/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(E)||(E="_"+E),m.attributes.has(g(d)))u[E]=m.attributes.get(g(d));else{T=null;var N=d.array;"JOINTS_0"!==E||N instanceof Uint16Array||N instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),T=new BufferAttribute(new Uint16Array(N),d.itemSize,d.normalized));var S=L(T||d,o);null!==S&&(u[E]=S,m.attributes.set(g(d),S))}}if(void 0!==h&&o.setAttribute("normal",h),0===Object.keys(u).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var y=[],A=[],_={};if(void 0!==e.morphTargetDictionary)for(var b in e.morphTargetDictionary)_[e.morphTargetDictionary[b]]=b;for(r=0;r<e.morphTargetInfluences.length;++r){var x={},w=!1;for(var E in o.morphAttributes)if("position"===E||"normal"===E){d=o.morphAttributes[E][r];var M=E.toUpperCase(),I=o.attributes[E];if(m.attributes.has(g(d)))x[M]=m.attributes.get(g(d));else{var G=d.clone();if(!o.morphTargetsRelative)for(var O=0,B=d.count;O<B;O++)G.setXYZ(O,d.getX(O)-I.getX(O),d.getY(O)-I.getY(O),d.getZ(O)-I.getZ(O));x[M]=L(G,o),m.attributes.set(g(I),x[M])}}else w||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),w=!0);f.push(x),y.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&A.push(_[r])}l.weights=y,A.length>0&&(l.extras={},l.extras.targetNames=A)}var F=Array.isArray(e.material);if(F&&0===o.groups.length)return null;for(var C=F?e.material:[e.material],P=F?o.groups:[{materialIndex:0,start:void 0,count:void 0}],U=(r=0,P.length);r<U;r++){var H={mode:s,attributes:u};if(v(o,H),f.length>0&&(H.targets=f),null!==o.index){var W=g(o.index);void 0===P[r].start&&void 0===P[r].count||(W+=":"+P[r].start+":"+P[r].count),m.attributes.has(W)?H.indices=m.attributes.get(W):(H.indices=L(o.index,o,P[r].start,P[r].count),m.attributes.set(W,H.indices)),null===H.indices&&delete H.indices}var D=R(C[P[r].materialIndex]);null!==D&&(H.material=D),p.push(H)}l.primitives=p,i.meshes||(i.meshes=[]),i.meshes.push(l);var z=i.meshes.length-1;return m.meshes.set(n,z),z}function x(e,t){i.animations||(i.animations=[]);for(var r=(e=GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],n=[],s=0;s<r.length;++s){var o=r[s],l=PropertyBinding.parseTrackName(o.name),p=PropertyBinding.findNode(t,l.nodeName),f=PATH_PROPERTIES[l.propertyName];if("bones"===l.objectName&&(p=!0===p.isSkinnedMesh?p.skeleton.getBoneByName(l.objectIndex):void 0),!p||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',o.name),null;var m,c=o.values.length/o.times.length;f===PATH_PROPERTIES.morphTargetInfluences&&(c/=p.morphTargetInfluences.length),!0===o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(m="CUBICSPLINE",c/=3):m=o.getInterpolation()===InterpolateDiscrete?"STEP":"LINEAR",n.push({input:L(new BufferAttribute(o.times,1)),output:L(new BufferAttribute(o.values,c)),interpolation:m}),a.push({sampler:n.length-1,target:{node:u.get(p),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:n,channels:a}),i.animations.length-1}function w(e){var t=i.nodes[u.get(e)],r=e.skeleton;if(void 0===r)return null;var a=e.skeleton.bones[0];if(void 0===a)return null;for(var n=[],s=new Float32Array(16*r.bones.length),o=0;o<r.bones.length;++o)n.push(u.get(r.bones[o])),r.boneInverses[o].toArray(s,16*o);return void 0===i.skins&&(i.skins=[]),i.skins.push({inverseBindMatrices:L(new BufferAttribute(s,16)),joints:n,skeleton:u.get(a)}),t.skin=i.skins.length-1}function M(e){var t={};e.name&&(t.name=e.name),t.color=e.color.toArray(),t.intensity=e.intensity,e.isDirectionalLight?t.type="directional":e.isPointLight?(t.type="point",e.distance>0&&(t.range=e.distance)):e.isSpotLight&&(t.type="spot",e.distance>0&&(t.range=e.distance),t.spot={},t.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,t.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1.");var r=i.extensions.KHR_lights_punctual.lights;return r.push(t),r.length-1}function I(e){i.nodes||(i.nodes=[]);var t={};if(r.trs){var a=e.quaternion.toArray(),n=e.position.toArray(),s=e.scale.toArray();T(a,[0,0,0,1])||(t.rotation=a),T(n,[0,0,0])||(t.translation=n),T(s,[1,1,1])||(t.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),T(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(t.matrix=e.matrix.elements);if(""!==e.name&&(t.name=String(e.name)),v(e,t),e.isMesh||e.isLine||e.isPoints){var o=b(e);null!==o&&(t.mesh=o)}else if(e.isCamera)t.camera=function(e){i.cameras||(i.cameras=[]);var t=e.isOrthographicCamera,r={type:t?"orthographic":"perspective"};return t?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:MathUtils.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(r.name=e.type),i.cameras.push(r),i.cameras.length-1}(e);else if(e.isDirectionalLight||e.isPointLight||e.isSpotLight)f.KHR_lights_punctual||(i.extensions=i.extensions||{},i.extensions.KHR_lights_punctual={lights:[]},f.KHR_lights_punctual=!0),t.extensions=t.extensions||{},t.extensions.KHR_lights_punctual={light:M(e)};else if(e.isLight)return console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e),null;if(e.isSkinnedMesh&&p.push(e),e.children.length>0){for(var l=[],m=0,c=e.children.length;m<c;m++){var h=e.children[m];if(h.visible||!1===r.onlyVisible){var g=I(h);null!==g&&l.push(g)}}l.length>0&&(t.children=l)}i.nodes.push(t);var E=i.nodes.length-1;return u.set(e,E),E}function G(e){i.scenes||(i.scenes=[],i.scene=0);var t={};""!==e.name&&(t.name=e.name),i.scenes.push(t);for(var a=[],n=0,s=e.children.length;n<s;n++){var o=e.children[n];if(o.visible||!1===r.onlyVisible){var l=I(o);null!==l&&a.push(l)}}a.length>0&&(t.nodes=a),v(e,t)}!function(e){e=e instanceof Array?e:[e];for(var t=[],a=0;a<e.length;a++)e[a]instanceof Scene?G(e[a]):t.push(e[a]);for(t.length>0&&function(e){var t=new Scene;t.name="AuxScene";for(var r=0;r<e.length;r++)t.children.push(e[r]);G(t)}(t),a=0;a<p.length;++a)w(p[a]);for(a=0;a<r.animations.length;++a)x(r.animations[a],e[0])}(e),Promise.all(l).then(function(){var e=new Blob(o,{type:"application/octet-stream"}),a=Object.keys(f);if(a.length>0&&(i.extensionsUsed=a),i.buffers&&i.buffers.length>0&&(i.buffers[0].byteLength=e.size),!0===r.binary){(n=new window.FileReader).readAsArrayBuffer(e),n.onloadend=function(){var e=d(n.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,e.byteLength,!0),r.setUint32(4,5130562,!0);var a=d(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),r=0,a=e.length;r<a;r++){var n=e.charCodeAt(r);t[r]=n>255?32:n}return t.buffer}(JSON.stringify(i)),32),s=new DataView(new ArrayBuffer(8));s.setUint32(0,a.byteLength,!0),s.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),l=new DataView(o);l.setUint32(0,1179937895,!0),l.setUint32(4,2,!0);var u=12+s.byteLength+a.byteLength+r.byteLength+e.byteLength;l.setUint32(8,u,!0);var p=new Blob([o,s,a,r,e],{type:"application/octet-stream"}),f=new window.FileReader;f.readAsArrayBuffer(p),f.onloadend=function(){t(f.result)}}}else{var n;if(i.buffers&&i.buffers.length>0)(n=new window.FileReader).readAsDataURL(e),n.onloadend=function(){var e=n.result;i.buffers[0].uri=e,t(i)};else t(i)}})}},GLTFExporter.Utils={insertKeyframe:function(e,t){var r,a=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),i=new e.ValueBufferType(e.values.length+a),s=e.createInterpolant(new e.ValueBufferType(a));if(0===e.times.length){n[0]=t;for(var o=0;o<a;o++)i[o]=0;r=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<.001)return 0;n[0]=t,n.set(e.times,1),i.set(s.evaluate(t),0),i.set(e.values,a),r=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<.001)return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),i.set(e.values,0),i.set(s.evaluate(t),e.values.length),r=n.length-1}else for(o=0;o<e.times.length;o++){if(Math.abs(e.times[o]-t)<.001)return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),i.set(e.values.slice(0,(o+1)*a),0),i.set(s.evaluate(t),(o+1)*a),i.set(e.values.slice((o+1)*a),(o+2)*a),r=o+1;break}}return e.times=n,e.values=i,r},mergeMorphTargetTracks:function(e,t){for(var r=[],a={},n=e.tracks,i=0;i<n.length;++i){var s=n[i],o=PropertyBinding.parseTrackName(s.name),l=PropertyBinding.findNode(t,o.nodeName);if("morphTargetInfluences"===o.propertyName&&void 0!==o.propertyIndex){if(s.createInterpolant!==s.InterpolantFactoryMethodDiscrete&&s.createInterpolant!==s.InterpolantFactoryMethodLinear){if(s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(s=s.clone()).setInterpolation(InterpolateLinear)}var u,p=l.morphTargetInfluences.length,f=l.morphTargetDictionary[o.propertyIndex];if(void 0===f)throw new Error("THREE.GLTFExporter: Morph target name not found: "+o.propertyIndex);if(void 0!==a[l.uuid]){var m=s.createInterpolant(new s.ValueBufferType(1));u=a[l.uuid];for(g=0;g<u.times.length;g++)u.values[g*p+f]=m.evaluate(u.times[g]);for(g=0;g<s.times.length;g++){var c=this.insertKeyframe(u,s.times[g]);u.values[c*p+f]=s.values[g]}}else{for(var h=new((u=s.clone()).ValueBufferType)(p*u.times.length),g=0;g<u.times.length;g++)h[g*p+f]=u.values[g];u.name=o.nodeName+".morphTargetInfluences",u.values=h,a[l.uuid]=u,r.push(u)}}else r.push(s)}return e.tracks=r,e}};export{GLTFExporter};
//# sourceMappingURL=/sm/32bee5705f0bdcae58ef6e58ddac8abfdf55f65ba9cc69b639e2ca6fcaebe4ec.map