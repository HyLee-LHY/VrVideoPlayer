/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/exporters/MMDExporter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Matrix4,Quaternion,Vector3}from"../../../build/three.module.js";import{MMDParser}from"../libs/mmdparser.module.js";var MMDExporter=function(){var r;this.parseVpd=function(e,n,o){if(!0!==e.isSkinnedMesh)return console.warn("THREE.MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function t(r){Math.abs(r)<1e-6&&(r=0);var e=r.toString();-1===e.indexOf(".")&&(e+=".");var n=(e+="000000").indexOf(".");return e.slice(0,n)+"."+e.slice(n+1,n+7)}function a(r){for(var e=[],n=0,o=r.length;n<o;n++)e.push(t(r[n]));return e.join(",")}e.updateMatrixWorld(!0);var i=e.skeleton.bones,s=function(r){var e=r.clone();return e.pose(),e.skeleton.bones}(e),u=new Vector3,p=new Quaternion,h=new Quaternion,l=new Matrix4,c=[];c.push("Vocaloid Pose Data file"),c.push(""),c.push((""!==e.name?e.name.replace(/\s/g,"_"):"skin")+".osm;"),c.push(i.length+";"),c.push("");for(var v=0,d=i.length;v<d;v++){var M=i[v],f=s[v];!0===o&&void 0!==M.userData.ik&&void 0!==M.userData.ik.originalMatrix?l.fromArray(M.userData.ik.originalMatrix):l.copy(M.matrix),u.setFromMatrixPosition(l),p.setFromRotationMatrix(l);var m=u.sub(f.position).toArray(),x=h.copy(f.quaternion).conjugate().multiply(p).toArray();m[2]=-m[2],x[0]=-x[0],x[1]=-x[1],c.push("Bone"+v+"{"+M.name),c.push("  "+a(m)+";"),c.push("  "+a(x)+";"),c.push("}"),c.push("")}c.push("");var g=c.join("\n");return!0===n?function(e){if(void 0===r){var n=(new MMDParser.CharsetEncoder).s2uTable;r={};for(var o=Object.keys(n),t=0,a=o.length;t<a;t++){var i=o[t],s=n[i];i=parseInt(i),r[s]=i}}var u=[];for(t=0,a=e.length;t<a;t++){var p=e.charCodeAt(t);if(void 0===(s=r[p]))throw"cannot convert charcode 0x"+p.toString(16);s>255?(u.push(s>>8&255),u.push(255&s)):u.push(255&s)}return new Uint8Array(u)}(g):g}};export{MMDExporter};
//# sourceMappingURL=/sm/f82726d945b99f828b4381b0618843e05841f55c0e5ee258501c9bb2291be28c.map