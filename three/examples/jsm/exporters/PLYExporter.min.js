/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/exporters/PLYExporter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferGeometry,Matrix3,Vector3}from"../../../build/three.module.js";var PLYExporter=function(){};PLYExporter.prototype={constructor:PLYExporter,parse:function(t,e,n){function r(e){t.traverse(function(t){if(!0===t.isMesh){var n=t,r=n.geometry;!0===r.isGeometry&&(r=o.get(r)),!0===r.isBufferGeometry&&void 0!==r.getAttribute("position")&&e(n,r)}})}e&&"object"==typeof e&&(console.warn('THREE.PLYExporter: The options parameter is now the third argument to the "parse" function. See the documentation for the new API.'),n=e,e=void 0);var i=(n=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},n)).excludeAttributes,o=new WeakMap,l=!1,a=!1,u=!1,s=0,f=0;t.traverse(function(t){if(!0===t.isMesh){var e=t,n=e.geometry;if(!0===n.isGeometry){var r=o.get(n)||(new BufferGeometry).setFromObject(e);o.set(n,r),n=r}if(!0===n.isBufferGeometry){var i=n.getAttribute("position"),g=n.getAttribute("normal"),d=n.getAttribute("uv"),p=n.getAttribute("color"),c=n.getIndex();if(void 0===i)return;s+=i.count,f+=c?c.count/3:i.count/3,void 0!==g&&(l=!0),void 0!==d&&(u=!0),void 0!==p&&(a=!0)}}});var g=-1===i.indexOf("index");if(l=l&&-1===i.indexOf("normal"),a=a&&-1===i.indexOf("color"),u=u&&-1===i.indexOf("uv"),g&&f!==Math.floor(f))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;var d="ply\n"+`format ${n.binary?n.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0\n`+`element vertex ${s}\n`+"property float x\nproperty float y\nproperty float z\n";!0===l&&(d+="property float nx\nproperty float ny\nproperty float nz\n"),!0===u&&(d+="property float s\nproperty float t\n"),!0===a&&(d+="property uchar red\nproperty uchar green\nproperty uchar blue\n"),!0===g&&(d+=`element face ${f}\n`+"property list uchar int vertex_index\n"),d+="end_header\n";var p=new Vector3,c=new Matrix3,y=null;if(!0===n.binary){var x=(new TextEncoder).encode(d),m=s*(12+(l?12:0)+(a?3:0)+(u?8:0)),v=g?13*f:0,b=new DataView(new ArrayBuffer(x.length+m+v));new Uint8Array(b.buffer).set(x,0);var E=x.length,h=x.length+m,A=0;r(function(t,e){var r=e.getAttribute("position"),i=e.getAttribute("normal"),o=e.getAttribute("uv"),s=e.getAttribute("color"),f=e.getIndex();c.getNormalMatrix(t.matrixWorld);for(var d=0,y=r.count;d<y;d++)p.x=r.getX(d),p.y=r.getY(d),p.z=r.getZ(d),p.applyMatrix4(t.matrixWorld),b.setFloat32(E,p.x,n.littleEndian),E+=4,b.setFloat32(E,p.y,n.littleEndian),E+=4,b.setFloat32(E,p.z,n.littleEndian),E+=4,!0===l&&(null!=i?(p.x=i.getX(d),p.y=i.getY(d),p.z=i.getZ(d),p.applyMatrix3(c).normalize(),b.setFloat32(E,p.x,n.littleEndian),E+=4,b.setFloat32(E,p.y,n.littleEndian),E+=4,b.setFloat32(E,p.z,n.littleEndian),E+=4):(b.setFloat32(E,0,n.littleEndian),E+=4,b.setFloat32(E,0,n.littleEndian),E+=4,b.setFloat32(E,0,n.littleEndian),E+=4)),!0===u&&(null!=o?(b.setFloat32(E,o.getX(d),n.littleEndian),E+=4,b.setFloat32(E,o.getY(d),n.littleEndian),E+=4):!1!==u&&(b.setFloat32(E,0,n.littleEndian),E+=4,b.setFloat32(E,0,n.littleEndian),E+=4)),!0===a&&(null!=s?(b.setUint8(E,Math.floor(255*s.getX(d))),E+=1,b.setUint8(E,Math.floor(255*s.getY(d))),E+=1,b.setUint8(E,Math.floor(255*s.getZ(d))),E+=1):(b.setUint8(E,255),E+=1,b.setUint8(E,255),E+=1,b.setUint8(E,255),E+=1));if(!0===g)if(null!==f)for(d=0,y=f.count;d<y;d+=3)b.setUint8(h,3),h+=1,b.setUint32(h,f.getX(d+0)+A,n.littleEndian),h+=4,b.setUint32(h,f.getX(d+1)+A,n.littleEndian),h+=4,b.setUint32(h,f.getX(d+2)+A,n.littleEndian),h+=4;else for(d=0,y=r.count;d<y;d+=3)b.setUint8(h,3),h+=1,b.setUint32(h,A+d,n.littleEndian),h+=4,b.setUint32(h,A+d+1,n.littleEndian),h+=4,b.setUint32(h,A+d+2,n.littleEndian),h+=4;A+=r.count}),y=b.buffer}else{A=0;var M="",F="";r(function(t,e){var n=e.getAttribute("position"),r=e.getAttribute("normal"),i=e.getAttribute("uv"),o=e.getAttribute("color"),s=e.getIndex();c.getNormalMatrix(t.matrixWorld);for(var d=0,y=n.count;d<y;d++){p.x=n.getX(d),p.y=n.getY(d),p.z=n.getZ(d),p.applyMatrix4(t.matrixWorld);var x=p.x+" "+p.y+" "+p.z;!0===l&&(null!=r?(p.x=r.getX(d),p.y=r.getY(d),p.z=r.getZ(d),p.applyMatrix3(c).normalize(),x+=" "+p.x+" "+p.y+" "+p.z):x+=" 0 0 0"),!0===u&&(null!=i?x+=" "+i.getX(d)+" "+i.getY(d):!1!==u&&(x+=" 0 0")),!0===a&&(x+=null!=o?" "+Math.floor(255*o.getX(d))+" "+Math.floor(255*o.getY(d))+" "+Math.floor(255*o.getZ(d)):" 255 255 255"),M+=x+"\n"}if(!0===g){if(null!==s)for(d=0,y=s.count;d<y;d+=3)F+=`3 ${s.getX(d+0)+A}`,F+=` ${s.getX(d+1)+A}`,F+=` ${s.getX(d+2)+A}\n`;else for(d=0,y=n.count;d<y;d+=3)F+=`3 ${A+d} ${A+d+1} ${A+d+2}\n`;f+=s?s.count/3:n.count/3}A+=n.count}),y=`${d}${M}${g?`${F}\n`:"\n"}`}return"function"==typeof e&&requestAnimationFrame(()=>e(y)),y}};export{PLYExporter};
//# sourceMappingURL=/sm/13ee5b726cafc8c2954bdda8704dc26810354fd00df718a6bada12334272a71d.map