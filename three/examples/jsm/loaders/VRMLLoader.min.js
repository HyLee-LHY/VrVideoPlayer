/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/VRMLLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BackSide,BoxBufferGeometry,BufferAttribute,BufferGeometry,ClampToEdgeWrapping,Color,ConeBufferGeometry,CylinderBufferGeometry,DataTexture,DoubleSide,FileLoader,Float32BufferAttribute,FrontSide,Group,LineBasicMaterial,LineSegments,Loader,LoaderUtils,Mesh,MeshBasicMaterial,MeshPhongMaterial,Object3D,Points,PointsMaterial,Quaternion,RGBAFormat,RGBFormat,RepeatWrapping,Scene,ShapeUtils,SphereBufferGeometry,TextureLoader,Vector2,Vector3}from"../../../build/three.module.js";import{chevrotain}from"../libs/chevrotain.module.min.js";var VRMLLoader=function(){if(void 0===chevrotain)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");function e(e){Loader.call(this,e)}function r(e){this.lexer=new chevrotain.Lexer(e)}function a(e){chevrotain.Parser.call(this,e);var r=this,a=e.Version,t=e.LCurly,n=e.RCurly,o=e.LSquare,i=e.RSquare,s=e.Identifier,l=e.RouteIdentifier,u=e.StringLiteral,c=e.HexLiteral,f=e.NumberLiteral,p=e.TrueLiteral,d=e.FalseLiteral,h=e.NullLiteral,v=e.DEF,b=e.USE,m=e.ROUTE,x=e.TO,g=e.NodeName;r.RULE("vrml",function(){r.SUBRULE(r.version),r.AT_LEAST_ONE(function(){r.SUBRULE(r.node)}),r.MANY(function(){r.SUBRULE(r.route)})}),r.RULE("version",function(){r.CONSUME(a)}),r.RULE("node",function(){r.OPTION(function(){r.SUBRULE(r.def)}),r.CONSUME(g),r.CONSUME(t),r.MANY(function(){r.SUBRULE(r.field)}),r.CONSUME(n)}),r.RULE("field",function(){r.CONSUME(s),r.OR2([{ALT:function(){r.SUBRULE(r.singleFieldValue)}},{ALT:function(){r.SUBRULE(r.multiFieldValue)}}])}),r.RULE("def",function(){r.CONSUME(v),r.OR([{ALT:function(){r.CONSUME(s)}},{ALT:function(){r.CONSUME(g)}}])}),r.RULE("use",function(){r.CONSUME(b),r.OR([{ALT:function(){r.CONSUME(s)}},{ALT:function(){r.CONSUME(g)}}])}),r.RULE("singleFieldValue",function(){r.AT_LEAST_ONE(function(){r.OR([{ALT:function(){r.SUBRULE(r.node)}},{ALT:function(){r.SUBRULE(r.use)}},{ALT:function(){r.CONSUME(u)}},{ALT:function(){r.CONSUME(c)}},{ALT:function(){r.CONSUME(f)}},{ALT:function(){r.CONSUME(p)}},{ALT:function(){r.CONSUME(d)}},{ALT:function(){r.CONSUME(h)}}])})}),r.RULE("multiFieldValue",function(){r.CONSUME(o),r.MANY(function(){r.OR([{ALT:function(){r.SUBRULE(r.node)}},{ALT:function(){r.SUBRULE(r.use)}},{ALT:function(){r.CONSUME(u)}},{ALT:function(){r.CONSUME(c)}},{ALT:function(){r.CONSUME(f)}},{ALT:function(){r.CONSUME(h)}}])}),r.CONSUME(i)}),r.RULE("route",function(){r.CONSUME(m),r.CONSUME(l),r.CONSUME(x),r.CONSUME2(l)}),this.performSelfAnalysis()}function t(e,r,a){this.a=e,this.b=r,this.c=a,this.normal=new Vector3}e.prototype=Object.assign(Object.create(Loader.prototype),{constructor:e,load:function(e,r,a,t){var n=this,o=""===n.path?LoaderUtils.extractUrlBase(e):n.path,i=new FileLoader(this.manager);i.setPath(n.path),i.load(e,function(a){try{r(n.parse(a,o))}catch(r){t?t(r):console.error(r),n.manager.itemError(e)}},a,t)},parse:function(e,o){var i={};function s(e){e.DEF&&(i[e.DEF]=e);for(var r=e.fields,a=0,t=r.length;a<t;a++){var n=r[a];if("node"===n.type)for(var o=n.values,l=0,u=o.length;l<u;l++)s(o[l])}}function l(e){return e.USE?(r=e.USE,(a=l(i[r])).isObject3D||a.isMaterial?a.clone():a):void 0!==e.build?e.build:(e.build=function(e){var r,a=e.name;switch(a){case"Group":case"Transform":case"Collision":r=function(e){for(var r=new Group,a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"bboxCenter":case"bboxSize":case"center":break;case"children":f(s,r);break;case"collide":break;case"rotation":var l=new Vector3(s[0],s[1],s[2]),u=s[3];r.quaternion.setFromAxisAngle(l,u);break;case"scale":r.scale.set(s[0],s[1],s[2]);break;case"scaleOrientation":break;case"translation":r.position.set(s[0],s[1],s[2]);break;case"proxy":break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"Background":r=function(e){for(var r,a,t,n,o=new Group,i=e.fields,s=0,l=i.length;s<l;s++){var u=i[s],c=u.name,f=u.values;switch(c){case"groundAngle":r=f;break;case"groundColor":a=f;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":t=f;break;case"skyColor":n=f;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}if(n){var p=new SphereBufferGeometry(1e4,32,16),d=new MeshBasicMaterial({fog:!1,side:BackSide,depthWrite:!1,depthTest:!1});n.length>3?(B(p,1e4,t,C(n),!0),d.vertexColors=!0):d.color.setRGB(n[0],n[1],n[2]);var h=new Mesh(p,d);o.add(h)}if(a&&a.length>0){var v=new SphereBufferGeometry(1e4,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),b=new MeshBasicMaterial({fog:!1,side:BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});B(v,1e4,r,C(a),!1);var m=new Mesh(v,b);o.add(m)}return o.renderOrder=-1/0,o}(e);break;case"Shape":r=function(e){for(var r,a,t=e.fields,n=new MeshBasicMaterial({color:0}),o=0,i=t.length;o<i;o++){var s=t[o],u=s.name,c=s.values;switch(u){case"appearance":null!==c[0]&&(n=l(c[0]));break;case"geometry":null!==c[0]&&(r=l(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(r&&r.attributes.position){var f=r._type;if("points"===f){var p=new PointsMaterial({color:16777215});void 0!==r.attributes.color?p.vertexColors=!0:n.isMeshPhongMaterial&&p.color.copy(n.emissive),a=new Points(r,p)}else if("line"===f){var d=new LineBasicMaterial({color:16777215});void 0!==r.attributes.color?d.vertexColors=!0:n.isMeshPhongMaterial&&d.color.copy(n.emissive),a=new LineSegments(r,d)}else void 0!==r._solid&&(n.side=r._solid?FrontSide:DoubleSide),void 0!==r.attributes.color&&(n.vertexColors=!0),a=new Mesh(r,n)}else(a=new Object3D).visible=!1;return a}(e);break;case"Appearance":r=function(e){for(var r,a=new MeshPhongMaterial,t=e.fields,o=0,i=t.length;o<i;o++){var s=t[o],u=s.name,c=s.values;switch(u){case"material":if(null!==c[0]){var f=l(c[0]);f.diffuseColor&&a.color.copy(f.diffuseColor),f.emissiveColor&&a.emissive.copy(f.emissiveColor),f.shininess&&(a.shininess=f.shininess),f.specularColor&&a.specular.copy(f.specularColor),f.transparency&&(a.opacity=1-f.transparency),f.transparency>0&&(a.transparent=!0)}else a=new MeshBasicMaterial({color:0});break;case"texture":var p=c[0];null!==p&&("ImageTexture"!==p.name&&"PixelTexture"!==p.name||(a.map=l(p)));break;case"textureTransform":null!==c[0]&&(r=l(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(a.map){if(a.map.__type){switch(a.map.__type){case n.INTENSITY_ALPHA:a.opacity=1;break;case n.RGB:a.color.set(16777215);break;case n.RGBA:a.color.set(16777215),a.opacity=1}delete a.map.__type}r&&(a.map.center.copy(r.center),a.map.rotation=r.rotation,a.map.repeat.copy(r.scale),a.map.offset.copy(r.translation))}return a}(e);break;case"Material":r=function(e){for(var r={},a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"ambientIntensity":break;case"diffuseColor":r.diffuseColor=new Color(s[0],s[1],s[2]);break;case"emissiveColor":r.emissiveColor=new Color(s[0],s[1],s[2]);break;case"shininess":r.shininess=s[0];break;case"specularColor":r.emissiveColor=new Color(s[0],s[1],s[2]);break;case"transparency":r.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"ImageTexture":r=function(e){for(var r,a=RepeatWrapping,t=RepeatWrapping,n=e.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,u=s.values;switch(l){case"url":var c=u[0];c&&(r=V.load(c));break;case"repeatS":!1===u[0]&&(a=ClampToEdgeWrapping);break;case"repeatT":!1===u[0]&&(t=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}r&&(r.wrapS=a,r.wrapT=t);return r}(e);break;case"PixelTexture":r=function(e){for(var r,a=RepeatWrapping,t=RepeatWrapping,n=e.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,f=s.values;switch(l){case"image":for(var p=f[0],d=f[1],h=f[2],v=2===h||4===h,b=c(h),m=p*d*(!0===v?4:3),x=new Uint8Array(m),g={r:0,g:0,b:0,a:0},w=3,L=0,k=f.length;w<k;w++,L++)if(u(f[w],b,g),!0===v){var y=4*L;x[y+0]=g.r,x[y+1]=g.g,x[y+2]=g.b,x[y+3]=g.a}else{var y=3*L;x[y+0]=g.r,x[y+1]=g.g,x[y+2]=g.b}(r=new DataTexture(x,p,d,!0===v?RGBAFormat:RGBFormat)).__type=b;break;case"repeatS":!1===f[0]&&(a=ClampToEdgeWrapping);break;case"repeatT":!1===f[0]&&(t=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}r&&(r.wrapS=a,r.wrapT=t);return r}(e);break;case"TextureTransform":r=function(e){for(var r={center:new Vector2,rotation:new Vector2,scale:new Vector2,translation:new Vector2},a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"center":r.center.set(s[0],s[1]);break;case"rotation":r.rotation=s[0];break;case"scale":r.scale.set(s[0],s[1]);break;case"translation":r.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"IndexedFaceSet":r=function(e){for(var r,a,t,n,o,i,s,u,c=!0,f=!0,v=0,b=!0,m=!0,x=e.fields,g=0,w=x.length;g<w;g++){var L=x[g],k=L.name,S=L.values;switch(k){case"color":var T=S[0];null!==T&&(r=l(T));break;case"coord":var R=S[0];null!==R&&(a=l(R));break;case"normal":var M=S[0];null!==M&&(t=l(M));break;case"texCoord":var C=S[0];null!==C&&(n=l(C));break;case"ccw":c=S[0];break;case"colorIndex":o=S;break;case"colorPerVertex":b=S[0];break;case"convex":break;case"coordIndex":i=S;break;case"creaseAngle":v=S[0];break;case"normalIndex":s=S;break;case"normalPerVertex":m=S[0];break;case"solid":f=S[0];break;case"texCoordIndex":u=S;break;default:console.warn("THREE.VRMLLoader: Unknown field:",k)}}if(void 0===i)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new BufferGeometry;var B,V,I,N,F=p(i,c);if(r)if(!0===b)if(o&&o.length>0){var O=p(o,c);V=y(F,O,r,3)}else V=A(F,new Float32BufferAttribute(r,3));else if(o&&o.length>0){var P=h(r,o),G=d(P,i);V=E(F,G)}else{var G=d(r,i);V=E(F,G)}if(t)if(!0===m)if(s&&s.length>0){var _=p(s,c);I=y(F,_,t,3)}else I=A(F,new Float32BufferAttribute(t,3));else if(s&&s.length>0){var H=h(t,s),z=d(H,i);I=E(F,z)}else{var z=d(t,i);I=E(F,z)}else I=U(F,a,v);if(n)if(u&&u.length>0){var D=p(u,c);N=y(F,D,n,2)}else N=A(F,new Float32BufferAttribute(n,2));var W=new BufferGeometry;B=A(F,new Float32BufferAttribute(a,3)),W.setAttribute("position",B),W.setAttribute("normal",I),V&&W.setAttribute("color",V);N&&W.setAttribute("uv",N);return W._solid=f,W._type="mesh",W}(e);break;case"IndexedLineSet":r=function(e){for(var r,a,t,n,o,i=!0,s=e.fields,u=0,c=s.length;u<c;u++){var f=s[u],p=f.name,d=f.values;switch(p){case"color":var m=d[0];null!==m&&(r=l(m));break;case"coord":var x=d[0];null!==x&&(a=l(x));break;case"colorIndex":t=d;break;case"colorPerVertex":i=d[0];break;case"coordIndex":n=d;break;default:console.warn("THREE.VRMLLoader: Unknown field:",p)}}var g=v(n);if(r)if(!0===i)if(t.length>0){var w=v(t);o=y(g,w,r,3)}else o=A(g,new Float32BufferAttribute(r,3));else if(t.length>0){var L=h(r,t),k=b(L,n);o=S(g,k)}else{var k=b(r,n);o=S(g,k)}var E=new BufferGeometry,T=A(g,new Float32BufferAttribute(a,3));E.setAttribute("position",T),o&&E.setAttribute("color",o);return E._type="line",E}(e);break;case"PointSet":r=function(e){for(var r,a,t=e.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,u=i.values;switch(s){case"color":var c=u[0];null!==c&&(r=l(c));break;case"coord":var f=u[0];null!==f&&(a=l(f));break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}var p;(p=new BufferGeometry).setAttribute("position",new Float32BufferAttribute(a,3)),r&&p.setAttribute("color",new Float32BufferAttribute(r,3));return p._type="points",p}(e);break;case"Box":r=function(e){for(var r=new Vector3(2,2,2),a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"size":r.x=s[0],r.y=s[1],r.z=s[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new BoxBufferGeometry(r.x,r.y,r.z)}(e);break;case"Cone":r=function(e){for(var r=1,a=2,t=!1,n=e.fields,o=0,i=n.length;o<i;o++){var s=n[o],l=s.name,u=s.values;switch(l){case"bottom":t=!u[0];break;case"bottomRadius":r=u[0];break;case"height":a=u[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}return new ConeBufferGeometry(r,a,16,1,t)}(e);break;case"Cylinder":r=function(e){for(var r=1,a=2,t=e.fields,n=0,o=t.length;n<o;n++){var i=t[n],s=i.name,l=i.values;switch(s){case"bottom":break;case"radius":r=l[0];break;case"height":a=l[0];break;case"side":case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new CylinderBufferGeometry(r,r,a,16,1)}(e);break;case"Sphere":r=function(e){for(var r=1,a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"radius":r=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return new SphereBufferGeometry(r,16,16)}(e);break;case"ElevationGrid":r=function(e){for(var r,a,t,n,o=!0,i=!0,s=!0,u=!0,c=0,f=2,p=2,d=1,h=1,v=e.fields,b=0,m=v.length;b<m;b++){var x=v[b],g=x.name,w=x.values;switch(g){case"color":var L=w[0];null!==L&&(r=l(L));break;case"normal":var k=w[0];null!==k&&(a=l(k));break;case"texCoord":var y=w[0];null!==y&&(t=l(y));break;case"height":n=w;break;case"ccw":u=w[0];break;case"colorPerVertex":o=w[0];break;case"creaseAngle":c=w[0];break;case"normalPerVertex":i=w[0];break;case"solid":s=w[0];break;case"xDimension":f=w[0];break;case"xSpacing":d=w[0];break;case"zDimension":p=w[0];break;case"zSpacing":h=w[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",g)}}for(var E=[],S=[],T=[],R=[],b=0;b<p;b++)for(var M=0;M<f;M++){var C=b*f+M,B=d*b,V=n[C],I=h*M;if(E.push(B,V,I),r&&!0===o){var N=r[3*C+0],F=r[3*C+1],O=r[3*C+2];T.push(N,F,O)}if(a&&!0===i){var P=a[3*C+0],G=a[3*C+1],_=a[3*C+2];S.push(P,G,_)}if(t){var H=t[2*C+0],z=t[2*C+1];R.push(H,z)}else R.push(b/(f-1),M/(p-1))}for(var D=[],b=0;b<f-1;b++)for(var M=0;M<p-1;M++){var W=b+M*f,O=b+(M+1)*f,j=b+1+(M+1)*f,Y=b+1+M*f;!0===u?(D.push(W,j,O),D.push(j,W,Y)):(D.push(W,O,j),D.push(j,Y,W))}var q,Q,X=A(D,new Float32BufferAttribute(E,3)),K=A(D,new Float32BufferAttribute(R,2));if(r)if(!1===o){for(var b=0;b<f-1;b++)for(var M=0;M<p-1;M++){var C=b+M*(f-1),N=r[3*C+0],F=r[3*C+1],O=r[3*C+2];T.push(N,F,O),T.push(N,F,O),T.push(N,F,O),T.push(N,F,O),T.push(N,F,O),T.push(N,F,O)}q=new Float32BufferAttribute(T,3)}else q=A(D,new Float32BufferAttribute(T,3));if(a)if(!1===i){for(var b=0;b<f-1;b++)for(var M=0;M<p-1;M++){var C=b+M*(f-1),P=a[3*C+0],G=a[3*C+1],_=a[3*C+2];S.push(P,G,_),S.push(P,G,_),S.push(P,G,_),S.push(P,G,_),S.push(P,G,_),S.push(P,G,_)}Q=new Float32BufferAttribute(S,3)}else Q=A(D,new Float32BufferAttribute(S,3));else Q=U(D,E,c);var Z=new BufferGeometry;Z.setAttribute("position",X),Z.setAttribute("normal",Q),Z.setAttribute("uv",K),q&&Z.setAttribute("color",q);return Z._solid=s,Z._type="mesh",Z}(e);break;case"Extrusion":r=function(e){for(var r,a,t=[1,1,1,-1,-1,-1,-1,1,1,1],n=[0,0,0,0,1,0],o=!0,i=!0,s=0,l=!0,u=!0,c=e.fields,f=0,p=c.length;f<p;f++){var d=c[f],h=d.name,v=d.values;switch(h){case"beginCap":o=v[0];break;case"ccw":i=v[0];break;case"convex":break;case"creaseAngle":s=v[0];break;case"crossSection":t=v;break;case"endCap":l=v[0];break;case"orientation":a=v;break;case"scale":r=v;break;case"solid":u=v[0];break;case"spine":n=v;break;default:console.warn("THREE.VRMLLoader: Unknown field:",h)}}for(var b=t[0]===t[t.length-2]&&t[1]===t[t.length-1],m=[],x=new Vector3,g=new Vector3,w=new Vector3,L=new Vector3,k=new Quaternion,f=0,y=0,E=0,S=n.length;f<S;f+=3,y+=2,E+=4){x.fromArray(n,f),g.x=r?r[y+0]:1,g.y=1,g.z=r?r[y+1]:1,w.x=a?a[E+0]:0,w.y=a?a[E+1]:0,w.z=a?a[E+2]:1;for(var T=a?a[E+3]:0,R=0,M=t.length;R<M;R+=2)L.x=t[R+0],L.y=0,L.z=t[R+1],L.multiply(g),k.setFromAxisAngle(w,T),L.applyQuaternion(k),L.add(x),m.push(L.x,L.y,L.z)}for(var C=[],B=n.length/3,V=t.length/2,f=0;f<B-1;f++)for(var y=0;y<V-1;y++){var I=y+f*V,N=y+1+f*V,F=y+(f+1)*V,O=y+1+(f+1)*V;y===V-2&&!0===b&&(N=f*V,O=(f+1)*V),!0===i?(C.push(I,N,F),C.push(F,N,O)):(C.push(I,F,N),C.push(F,O,N))}if(!0===o||!0===l){for(var P=[],f=0,p=t.length;f<p;f+=2)P.push(new Vector2(t[f],t[f+1]));for(var G=ShapeUtils.triangulateShape(P,[]),_=[],f=0,p=G.length;f<p;f++){var H=G[f];_.push(H[0],H[1],H[2])}if(!0===o)for(var f=0,p=_.length;f<p;f+=3)!0===i?C.push(_[f+0],_[f+1],_[f+2]):C.push(_[f+0],_[f+2],_[f+1]);if(!0===l)for(var z=V*(B-1),f=0,p=_.length;f<p;f+=3)!0===i?C.push(z+_[f+0],z+_[f+2],z+_[f+1]):C.push(z+_[f+0],z+_[f+1],z+_[f+2])}var D=A(C,new Float32BufferAttribute(m,3)),W=U(C,m,s),j=new BufferGeometry;return j.setAttribute("position",D),j.setAttribute("normal",W),j._solid=u,j._type="mesh",j}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":r=function(e){return e.fields[0].values}(e);break;case"WorldInfo":r=function(e){for(var r={},a=e.fields,t=0,n=a.length;t<n;t++){var o=a[t],i=o.name,s=o.values;switch(i){case"title":r.title=s[0];break;case"info":r.info=s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",i)}}return r}(e);break;case"Anchor":case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",a)}return r}(e),e.build);var r,a}function u(e,r,a){switch(r){case n.INTENSITY:var t=parseInt(e);a.r=t,a.g=t,a.b=t;break;case n.INTENSITY_ALPHA:t=parseInt("0x"+e.substring(2,4));a.r=t,a.g=t,a.b=t,a.a=parseInt("0x"+e.substring(4,6));break;case n.RGB:a.r=parseInt("0x"+e.substring(2,4)),a.g=parseInt("0x"+e.substring(4,6)),a.b=parseInt("0x"+e.substring(6,8));break;case n.RGBA:a.r=parseInt("0x"+e.substring(2,4)),a.g=parseInt("0x"+e.substring(4,6)),a.b=parseInt("0x"+e.substring(6,8)),a.a=parseInt("0x"+e.substring(8,10))}}function c(e){var r;switch(e){case 1:r=n.INTENSITY;break;case 2:r=n.INTENSITY_ALPHA;break;case 3:r=n.RGB;break;case 4:r=n.RGBA}return r}function f(e,r){for(var a=0,t=e.length;a<t;a++){var n=l(e[a]);n instanceof Object3D&&r.add(n)}}function p(e,r){for(var a=[],t=0,n=0,o=e.length;n<o;n++){var i=e[t],s=e[n+(r?1:2)],l=e[n+(r?2:1)];a.push(i,s,l),(-1===e[n+3]||n+3>=o)&&(t=(n+=3)+1)}return a}function d(e,r){for(var a=[],t=0,n=0,o=r.length;n<o;n++){var i=3*t,s=e[i],l=e[i+1],u=e[i+2];a.push(s,l,u),(-1===r[n+3]||n+3>=o)&&(n+=3,t++)}return a}function h(e,r){for(var a=[],t=0,n=r.length;t<n;t++){var o=3*r[t],i=e[o],s=e[o+1],l=e[o+2];a.push(i,s,l)}return a}function v(e){for(var r=[],a=0,t=e.length;a<t;a++){var n=e[a],o=e[a+1];r.push(n,o),(-1===e[a+2]||a+2>=t)&&(a+=2)}return r}function b(e,r){for(var a=[],t=0,n=0,o=r.length;n<o;n++){var i=3*t,s=e[i],l=e[i+1],u=e[i+2];a.push(s,l,u),(-1===r[n+2]||n+2>=o)&&(n+=2,t++)}return a}var m=new Vector3,x=new Vector3,g=new Vector3,w=new Vector2,L=new Vector2,k=new Vector2;function y(e,r,a,t){for(var n=[],o=0,i=e.length;o<i;o+=3){var s=r[o],l=r[o+1],u=r[o+2];2===t?(w.fromArray(a,s*t),L.fromArray(a,l*t),k.fromArray(a,u*t),n.push(w.x,w.y),n.push(L.x,L.y),n.push(k.x,k.y)):(m.fromArray(a,s*t),x.fromArray(a,l*t),g.fromArray(a,u*t),n.push(m.x,m.y,m.z),n.push(x.x,x.y,x.z),n.push(g.x,g.y,g.z))}return new Float32BufferAttribute(n,t)}function E(e,r){for(var a=[],t=0,n=0,o=e.length;t<o;t+=3,n++)m.fromArray(r,3*n),a.push(m.x,m.y,m.z),a.push(m.x,m.y,m.z),a.push(m.x,m.y,m.z);return new Float32BufferAttribute(a,3)}function S(e,r){for(var a=[],t=0,n=0,o=e.length;t<o;t+=2,n++)m.fromArray(r,3*n),a.push(m.x,m.y,m.z),a.push(m.x,m.y,m.z);return new Float32BufferAttribute(a,3)}function A(e,r){for(var a=r.array,t=r.itemSize,n=new a.constructor(e.length*t),o=0,i=0,s=0,l=e.length;s<l;s++){o=e[s]*t;for(var u=0;u<t;u++)n[i++]=a[o++]}return new Float32BufferAttribute(n,t)}var T=new Vector3,R=new Vector3;function U(e,r,a){for(var n=[],o={},i=0,s=e.length;i<s;i+=3){var l=e[i],u=e[i+1],c=e[i+2],f=new t(l,u,c);m.fromArray(r,3*l),x.fromArray(r,3*u),g.fromArray(r,3*c),R.subVectors(g,x),T.subVectors(m,x),R.cross(T),R.normalize(),f.normal.copy(R),void 0===o[l]&&(o[l]=[]),void 0===o[u]&&(o[u]=[]),void 0===o[c]&&(o[c]=[]),o[l].push(f.normal),o[u].push(f.normal),o[c].push(f.normal),n.push(f)}var p=[];for(i=0,s=n.length;i<s;i++){var d=M(o[(f=n[i]).a],f.normal,a),h=M(o[f.b],f.normal,a),v=M(o[f.c],f.normal,a);m.fromArray(r,3*f.a),x.fromArray(r,3*f.b),g.fromArray(r,3*f.c),p.push(d.x,d.y,d.z),p.push(h.x,h.y,h.z),p.push(v.x,v.y,v.z)}return new Float32BufferAttribute(p,3)}function M(e,r,a){var t=new Vector3;if(0===a)t.copy(r);else for(var n=0,o=e.length;n<o;n++)e[n].angleTo(r)<a&&t.add(e[n]);return t.normalize()}function C(e){for(var r=[],a=0,t=e.length;a<t;a+=3)r.push(new Color(e[a],e[a+1],e[a+2]));return r}function B(e,r,a,t,n){for(var o=[],i=!0===n?0:Math.PI,s=0,l=t.length;s<l;s++){var u=0===s?0:a[s-1];u=!0===n?u:i-u;var c=new Vector3;c.setFromSphericalCoords(r,u,0),o.push(c)}var f=e.index,p=e.attributes.position,d=new BufferAttribute(new Float32Array(3*e.attributes.position.count),3),h=new Vector3,v=new Color;for(s=0;s<f.count;s++){var b,m,x=f.getX(s);h.fromBufferAttribute(p,x);for(var g=1,w=1;w<o.length;w++){m=w;var L=o[b=w-1],k=o[m];if(!0===n){if(h.y<=L.y&&h.y>k.y){g=Math.abs(L.y-h.y)/Math.abs(L.y-k.y);break}}else if(h.y>=L.y&&h.y<k.y){g=Math.abs(L.y-h.y)/Math.abs(L.y-k.y);break}}var y=t[b],E=t[m];v.copy(y).lerp(E,g),d.setXYZ(x,v.r,v.g,v.b)}e.setAttribute("color",d)}var V=new TextureLoader(this.manager);if(V.setPath(this.resourcePath||o).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");return function(e){for(var r=e.nodes,a=new Scene,t=0,n=r.length;t<n;t++)s(o=r[t]);for(t=0,n=r.length;t<n;t++){var o,i=l(o=r[t]);i instanceof Object3D&&a.add(i),"WorldInfo"===o.name&&(a.userData.worldInfo=i)}return a}(function(e){var t=function(){for(var e=chevrotain.createToken,r=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),a=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:r}),t=e({name:"Version",pattern:/#VRML.*/,longer_alt:a}),n=e({name:"NodeName",pattern:new RegExp(["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"].join("|")),longer_alt:a}),o=e({name:"DEF",pattern:/DEF/,longer_alt:a}),i=e({name:"USE",pattern:/USE/,longer_alt:a}),s=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:a}),l=e({name:"TO",pattern:/TO/,longer_alt:a}),u=e({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]+|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),c=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),f=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),p=e({name:"TrueLiteral",pattern:/TRUE/}),d=e({name:"FalseLiteral",pattern:/FALSE/}),h=e({name:"NullLiteral",pattern:/NULL/}),v=e({name:"LSquare",pattern:/\[/}),b=e({name:"RSquare",pattern:/]/}),m=e({name:"LCurly",pattern:/{/}),x=e({name:"RCurly",pattern:/}/}),g=e({name:"Comment",pattern:/#.*/,group:chevrotain.Lexer.SKIPPED}),w=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:chevrotain.Lexer.SKIPPED}),n,o,i,s,l,p,d,h,t,a,r,u,c,f,v,b,m,x,g],L={},k=0,y=w.length;k<y;k++){var E=w[k];L[E.name]=E}return{tokens:w,tokenVocabulary:L}}(),n=new r(t.tokens),o=new a(t.tokenVocabulary),i=function(e){function r(){e.call(this),this.validateVisitor()}function a(e,r){var a={type:null,values:[]};if(r.node){a.type="node";for(var t=0,n=r.node.length;t<n;t++){var o=r.node[t];a.values.push(e.visit(o))}}if(r.use){a.type="use";for(var t=0,n=r.use.length;t<n;t++){var i=r.use[t];a.values.push(e.visit(i))}}if(r.StringLiteral){a.type="string";for(var t=0,n=r.StringLiteral.length;t<n;t++){var s=r.StringLiteral[t];a.values.push(s.image.replace(/'|"/g,""))}}if(r.NumberLiteral){a.type="number";for(var t=0,n=r.NumberLiteral.length;t<n;t++){var l=r.NumberLiteral[t];a.values.push(parseFloat(l.image))}}if(r.HexLiteral){a.type="hex";for(var t=0,n=r.HexLiteral.length;t<n;t++){var u=r.HexLiteral[t];a.values.push(u.image)}}if(r.TrueLiteral){a.type="boolean";for(var t=0,n=r.TrueLiteral.length;t<n;t++){var c=r.TrueLiteral[t];"TRUE"===c.image&&a.values.push(!0)}}if(r.FalseLiteral){a.type="boolean";for(var t=0,n=r.FalseLiteral.length;t<n;t++){var f=r.FalseLiteral[t];"FALSE"===f.image&&a.values.push(!1)}}return r.NullLiteral&&(a.type="null",r.NullLiteral.forEach(function(){a.values.push(null)})),a}return r.prototype=Object.assign(Object.create(e.prototype),{constructor:r,vrml:function(e){for(var r={version:this.visit(e.version),nodes:[],routes:[]},a=0,t=e.node.length;a<t;a++){var n=e.node[a];r.nodes.push(this.visit(n))}if(e.route)for(a=0,t=e.route.length;a<t;a++){var o=e.route[a];r.routes.push(this.visit(o))}return r},version:function(e){return e.Version[0].image},node:function(e){var r={name:e.NodeName[0].image,fields:[]};if(e.field)for(var a=0,t=e.field.length;a<t;a++){var n=e.field[a];r.fields.push(this.visit(n))}return e.def&&(r.DEF=this.visit(e.def[0])),r},field:function(e){var r,a={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(r=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(r=this.visit(e.multiFieldValue[0])),a.type=r.type,a.values=r.values,a},def:function(e){return(e.Identifier||e.NodeName)[0].image},use:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}},singleFieldValue:function(e){return a(this,e)},multiFieldValue:function(e){return a(this,e)},route:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}),new r}(o.getBaseCstVisitorConstructor()),s=n.lex(e);o.input=s.tokens;var l=o.vrml();if(o.errors.length>0)throw console.error(o.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return i.visit(l)}(e))}}),r.prototype={constructor:r,lex:function(e){var r=this.lexer.tokenize(e);if(r.errors.length>0)throw console.error(r.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return r}},a.prototype=Object.create(chevrotain.Parser.prototype),a.prototype.constructor=a;var n={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};return e}();export{VRMLLoader};
//# sourceMappingURL=/sm/b0eda175fcbd6b174683ddebcca8d36ecc262b5ad7874e6ac74afbeda1a8ac01.map