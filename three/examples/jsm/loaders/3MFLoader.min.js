/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/3MFLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferAttribute,BufferGeometry,ClampToEdgeWrapping,Color,FileLoader,Float32BufferAttribute,Group,LinearFilter,LinearMipmapLinearFilter,Loader,LoaderUtils,Matrix4,Mesh,MeshPhongMaterial,MeshStandardMaterial,MirroredRepeatWrapping,NearestFilter,RepeatWrapping,TextureLoader,sRGBEncoding}from"../../../build/three.module.js";import{JSZip}from"../libs/jszip.module.min.js";var ThreeMFLoader=function(e){Loader.call(this,e),this.availableExtensions=[]};ThreeMFLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ThreeMFLoader,load:function(e,t,r,a){var i=this,n=new FileLoader(i.manager);n.setPath(i.path),n.setResponseType("arraybuffer"),n.load(e,function(r){try{t(i.parse(r))}catch(t){a?a(t):console.error(t),i.manager.itemError(e)}},r,a)},parse:function(e){var t=this,r=new TextureLoader(this.manager);function a(e){for(var t=[],r=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship"),a=0;a<r.length;a++){var i=r[a],n={target:i.getAttribute("Target"),id:i.getAttribute("Id"),type:i.getAttribute("Type")};t.push(n)}return t}function i(e){for(var t={id:e.getAttribute("id"),basematerials:[]},r=e.querySelectorAll("base"),a=0;a<r.length;a++){var i=u(r[a]);i.index=a,t.basematerials.push(i)}return t}function n(e){for(var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("tex2coord"),a=[],i=0;i<r.length;i++){var n=r[i],o=n.getAttribute("u"),s=n.getAttribute("v");a.push(parseFloat(o),parseFloat(s))}return t.uvs=new Float32Array(a),t}function o(e){for(var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},r=e.querySelectorAll("color"),a=[],i=new Color,n=0;n<r.length;n++){var o=r[n].getAttribute("color");i.setStyle(o.substring(0,7)),i.convertSRGBToLinear(),a.push(i.r,i.g,i.b)}return t.colors=new Float32Array(a),t}function s(e){for(var t={id:e.getAttribute("id")},r=e.querySelectorAll("pbmetallic"),a=[],i=0;i<r.length;i++){var n=r[i];a.push({name:n.getAttribute("name"),metallicness:parseFloat(n.getAttribute("metallicness")),roughness:parseFloat(n.getAttribute("roughness"))})}return t.data=a,t}function u(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function l(e){var t={};t.objectId=e.getAttribute("objectid");var r=e.getAttribute("transform");return r&&(t.transform=p(r)),t}function p(e){var t=[];e.split(" ").forEach(function(e){t.push(parseFloat(e))});var r=new Matrix4;return r.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),r}function c(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var a=e.getAttribute("pid");a&&(t.pid=a);var i=e.getAttribute("pindex");i&&(t.pindex=i);var n=e.getAttribute("thumbnail");n&&(t.thumbnail=n);var o=e.getAttribute("partnumber");o&&(t.partnumber=o);var s=e.getAttribute("name");s&&(t.name=s);var u=e.querySelector("mesh");u&&(t.mesh=function(e){for(var t={},r=[],a=e.querySelectorAll("vertices vertex"),i=0;i<a.length;i++){var n=a[i],o=n.getAttribute("x"),s=n.getAttribute("y"),u=n.getAttribute("z");r.push(parseFloat(o),parseFloat(s),parseFloat(u))}t.vertices=new Float32Array(r);var l=[],p=[],c=e.querySelectorAll("triangles triangle");for(i=0;i<c.length;i++){var d=c[i],h=d.getAttribute("v1"),v=d.getAttribute("v2"),g=d.getAttribute("v3"),f=d.getAttribute("p1"),b=d.getAttribute("p2"),m=d.getAttribute("p3"),A=d.getAttribute("pid"),y={};y.v1=parseInt(h,10),y.v2=parseInt(v,10),y.v3=parseInt(g,10),p.push(y.v1,y.v2,y.v3),f&&(y.p1=parseInt(f,10)),b&&(y.p2=parseInt(b,10)),m&&(y.p3=parseInt(m,10)),A&&(y.pid=A),0<Object.keys(y).length&&l.push(y)}return t.triangleProperties=l,t.triangles=new Uint32Array(p),t}(u));var p=e.querySelector("components");return p&&(t.components=function(e){for(var t=[],r=e.querySelectorAll("component"),a=0;a<r.length;a++){var i=l(r[a]);t.push(i)}return t}(p)),t}function d(e){var t={unit:e.getAttribute("unit")||"millimeter"},r=e.querySelectorAll("metadata");r&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var a=e[r],i=a.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=a.textContent)}return t}(r));var a=e.querySelector("resources");a&&(t.resources=function(e){for(var t={basematerials:{}},r=e.querySelectorAll("basematerials"),a=0;a<r.length;a++){var u=i(r[a]);t.basematerials[u.id]=u}t.texture2d={};var l,p=e.querySelectorAll("texture2d");for(a=0;a<p.length;a++){var d=p[a],h={id:(l=d).getAttribute("id"),path:l.getAttribute("path"),contenttype:l.getAttribute("contenttype"),tilestyleu:l.getAttribute("tilestyleu"),tilestylev:l.getAttribute("tilestylev"),filter:l.getAttribute("filter")};t.texture2d[h.id]=h}t.colorgroup={};var v=e.querySelectorAll("colorgroup");for(a=0;a<v.length;a++){var g=o(v[a]);t.colorgroup[g.id]=g}t.pbmetallicdisplayproperties={};var f=e.querySelectorAll("pbmetallicdisplayproperties");for(a=0;a<f.length;a++){var b=s(f[a]);t.pbmetallicdisplayproperties[b.id]=b}t.texture2dgroup={};var m=e.querySelectorAll("texture2dgroup");for(a=0;a<m.length;a++){var A=n(m[a]);t.texture2dgroup[A.id]=A}t.object={};var y=e.querySelectorAll("object");for(a=0;a<y.length;a++){var x=c(y[a]);t.object[x.id]=x}return t}(a));var u=e.querySelector("build");return u&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),a=0;a<r.length;a++){var i=r[a],n={objectId:i.getAttribute("objectid")},o=i.getAttribute("transform");o&&(n.transform=p(o)),t.push(n)}return t}(u)),t}function h(e,t,a,i){var n=e.texid,o=a.resources.texture2d[n];if(o){var s=i[o.path],u=o.contenttype,l=new Blob([s],{type:u}),p=URL.createObjectURL(l),c=r.load(p,function(){URL.revokeObjectURL(p)});switch(c.encoding=sRGBEncoding,o.tilestyleu){case"wrap":c.wrapS=RepeatWrapping;break;case"mirror":c.wrapS=MirroredRepeatWrapping;break;case"none":case"clamp":c.wrapS=ClampToEdgeWrapping;break;default:c.wrapS=RepeatWrapping}switch(o.tilestylev){case"wrap":c.wrapT=RepeatWrapping;break;case"mirror":c.wrapT=MirroredRepeatWrapping;break;case"none":case"clamp":c.wrapT=ClampToEdgeWrapping;break;default:c.wrapT=RepeatWrapping}switch(o.filter){case"auto":c.magFilter=LinearFilter,c.minFilter=LinearMipmapLinearFilter;break;case"linear":c.magFilter=LinearFilter,c.minFilter=LinearFilter;break;case"nearest":c.magFilter=NearestFilter,c.minFilter=NearestFilter;break;default:c.magFilter=LinearFilter,c.minFilter=LinearMipmapLinearFilter}return c}return null}function v(e,t,r,a,i,n){for(var o=n.pindex,s={},u=0,l=t.length;u<l;u++){var p=void 0!==(F=t[u]).p1?F.p1:o;void 0===s[p]&&(s[p]=[]),s[p].push(F)}var c=Object.keys(s),d=[];for(u=0,l=c.length;u<l;u++){for(var h=c[u],v=s[h],g=y(e.basematerials[h],S,r,i,n,x),f=new BufferGeometry,b=[],m=a.vertices,A=0,w=v.length;A<w;A++){var F=v[A];b.push(m[3*F.v1+0]),b.push(m[3*F.v1+1]),b.push(m[3*F.v1+2]),b.push(m[3*F.v2+0]),b.push(m[3*F.v2+1]),b.push(m[3*F.v2+2]),b.push(m[3*F.v3+0]),b.push(m[3*F.v3+1]),b.push(m[3*F.v3+2])}f.setAttribute("position",new Float32BufferAttribute(b,3));var M=new Mesh(f,g);d.push(M)}return d}function g(e,t,r,a,i,n){for(var o=new BufferGeometry,s=[],u=[],l=a.vertices,p=e.uvs,c=0,d=t.length;c<d;c++){var v=t[c];s.push(l[3*v.v1+0]),s.push(l[3*v.v1+1]),s.push(l[3*v.v1+2]),s.push(l[3*v.v2+0]),s.push(l[3*v.v2+1]),s.push(l[3*v.v2+2]),s.push(l[3*v.v3+0]),s.push(l[3*v.v3+1]),s.push(l[3*v.v3+2]),u.push(p[2*v.p1+0]),u.push(p[2*v.p1+1]),u.push(p[2*v.p2+0]),u.push(p[2*v.p2+1]),u.push(p[2*v.p3+0]),u.push(p[2*v.p3+1])}o.setAttribute("position",new Float32BufferAttribute(s,3)),o.setAttribute("uv",new Float32BufferAttribute(u,2));var g=y(e,S,r,i,n,h),f=new MeshPhongMaterial({map:g,flatShading:!0});return new Mesh(o,f)}function f(e,t,r,a){for(var i=new BufferGeometry,n=[],o=[],s=a.vertices,u=e.colors,l=0,p=t.length;l<p;l++){var c=t[l],d=c.v1,h=c.v2,v=c.v3;n.push(s[3*d+0]),n.push(s[3*d+1]),n.push(s[3*d+2]),n.push(s[3*h+0]),n.push(s[3*h+1]),n.push(s[3*h+2]),n.push(s[3*v+0]),n.push(s[3*v+1]),n.push(s[3*v+2]);var g=c.p1,f=c.p2,b=c.p3;o.push(u[3*g+0]),o.push(u[3*g+1]),o.push(u[3*g+2]),o.push(u[3*(f||g)+0]),o.push(u[3*(f||g)+1]),o.push(u[3*(f||g)+2]),o.push(u[3*(b||g)+0]),o.push(u[3*(b||g)+1]),o.push(u[3*(b||g)+2])}i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute(o,3));var m=new MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new Mesh(i,m)}function b(e){var t=new BufferGeometry;t.setIndex(new BufferAttribute(e.triangles,1)),t.setAttribute("position",new BufferAttribute(e.vertices,3));var r=new MeshPhongMaterial({color:11184895,flatShading:!0});return new Mesh(t,r)}function m(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function A(e,t,r,a,i){for(var n=new Group,o=function(e,t,r,a,i){for(var n=Object.keys(e),o=[],s=0,u=n.length;s<u;s++){var l=n[s],p=e[l];switch(m(l,t)){case"material":for(var c=v(t.resources.basematerials[l],p,t,r,a,i),d=0,h=c.length;d<h;d++)o.push(c[d]);break;case"texture":var A=t.resources.texture2dgroup[l];o.push(g(A,p,t,r,a,i));break;case"vertexColors":var y=t.resources.colorgroup[l];o.push(f(y,p,0,r));break;case"default":o.push(b(r));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}return o}(function(e,t,r){for(var a={},i=t.triangleProperties,n=r.pid,o=0,s=i.length;o<s;o++){var u=i[o],l=void 0!==u.pid?u.pid:n;void 0===l&&(l="default"),void 0===a[l]&&(a[l]=[]),a[l].push(u)}return a}(0,e,i),r,e,a,i),s=0,u=o.length;s<u;s++)n.add(o[s]);return n}function y(e,t,r,a,i,n){return void 0!==e.build?e.build:(e.build=n(e,t,r,a,i),e.build)}function x(e,t,r){var a,i=e.displaypropertiesid,n=r.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==n[i]){var o=n[i].data[e.index];a=new MeshStandardMaterial({flatShading:!0,roughness:o.roughness,metalness:o.metallicness})}else a=new MeshPhongMaterial({flatShading:!0});a.name=e.name;var s=e.displaycolor,u=s.substring(0,7);return a.color.setStyle(u),a.color.convertSRGBToLinear(),9===s.length&&(a.opacity=parseInt(s.charAt(7)+s.charAt(8),16)/255),a}function w(e,t,r,a){for(var i=new Group,n=0;n<e.length;n++){var o=e[n],s=t[o.objectId];void 0===s&&(F(o.objectId,t,r,a),s=t[o.objectId]);var u=s.clone(),l=o.transform;l&&u.applyMatrix4(l),i.add(u)}return i}function F(e,r,a,i){var n=a.resources.object[e];if(n.mesh){var o=n.mesh;!function(e,r,a){if(e){for(var i=[],n=Object.keys(e),o=0;o<n.length;o++)for(var s=n[o],u=0;u<t.availableExtensions.length;u++)(l=t.availableExtensions[u]).ns===s&&i.push(l);for(o=0;o<i.length;o++){var l;(l=i[o]).apply(a,e[l.ns],r)}}}(a.extensions,o,a.xml),r[n.id]=y(o,r,a,i,n,A)}else{var s=n.components;r[n.id]=y(s,r,a,i,n,w)}}var M=function(e){var t,r,i,n,o=null,s=null,u=[],l=[],p=[],c=[],h={},v={};try{o=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: jszip missing and file is compressed."),null}for(s in o.files)s.match(/\_rels\/.rels$/)?t=s:s.match(/3D\/_rels\/.*\.model\.rels$/)?r=s:s.match(/^3D\/.*\.model$/)?u.push(s):s.match(/^3D\/Metadata\/.*\.xml$/)?l.push(s):s.match(/^3D\/Textures?\/.*/)?p.push(s):s.match(/^3D\/Other\/.*/)&&c.push(s);var g=new Uint8Array(o.file(t).asArrayBuffer());i=a(LoaderUtils.decodeText(g)),r&&(g=new Uint8Array(o.file(r).asArrayBuffer()),n=a(LoaderUtils.decodeText(g)));for(var f=0;f<u.length;f++){var b=u[f],m=new Uint8Array(o.file(b).asArrayBuffer()),A=LoaderUtils.decodeText(m),y=(new DOMParser).parseFromString(A,"application/xml");"model"!==y.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",b);var x=y.querySelector("model"),w={};for(f=0;f<x.attributes.length;f++){var F=x.attributes[f];F.name.match(/^xmlns:(.+)$/)&&(w[F.value]=RegExp.$1)}var M=d(x);M.xml=x,0<Object.keys(w).length&&(M.extensions=w),h[b]=M}for(f=0;f<p.length;f++){var S=p[f];v[S]=o.file(S).asArrayBuffer()}return{rels:i,modelRels:n,model:h,printTicket:{},texture:v,other:{}}}(e),S=function(e){var t=e.model,r=e.modelRels,a={},i=Object.keys(t),n={};if(r)for(var o=0,s=r.length;o<s;o++){var u=r[o],l=u.target.substring(1);e.texture[l]&&(n[u.target]=e.texture[l])}for(o=0;o<i.length;o++)for(var p=t[i[o]],c=Object.keys(p.resources.object),d=0;d<c.length;d++)F(c[d],a,p,n);return a}(M);return function(e,t){for(var r=new Group,a=t.rels[0],i=t.model[a.target.substring(1)].build,n=0;n<i.length;n++){var o=i[n],s=e[o.objectId],u=o.transform;u&&s.applyMatrix4(u),r.add(s)}return r}(S,M)},addExtension:function(e){this.availableExtensions.push(e)}});export{ThreeMFLoader};
//# sourceMappingURL=/sm/b86f12f8f4e42f8497e4ed60244eb8e498659156c7cd95ccab90f8606ae9c2f5.map