/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/VTKLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferAttribute,BufferGeometry,FileLoader,Float32BufferAttribute,Loader,LoaderUtils}from"../../../build/three.module.js";import{Zlib}from"../libs/inflate.module.min.js";var VTKLoader=function(t){Loader.call(this,t)};VTKLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:VTKLoader,load:function(t,e,r,a){var n=this,o=new FileLoader(n.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.load(t,function(r){try{e(n.parse(r))}catch(e){a?a(e):console.error(e),n.manager.itemError(t)}},r,a)},parse:function(t){function e(t,e){var r=t.length,a=new Int32Array(r+e.length);return a.set(t),a.set(e,r),a}function r(t){for(var e="",r=new Uint8Array(t),a=0,n=r.length;n--;)e+=String.fromCharCode(r[a++]);return e}var a=LoaderUtils.decodeText(new Uint8Array(t,0,250)).split("\n");return-1!==a[0].indexOf("xml")?function(t){function r(t){var e,r,a,n,o,i,s="undefined"!=typeof Uint8Array?Uint8Array:Array,l=[],f=[],u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=u.length;for(e=0;e<p;e++)l[e]=u[e];for(e=0;e<p;++e)f[u.charCodeAt(e)]=e;if(f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63,(p=t.length)%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=new s(3*p/4-(o="="===t[p-2]?2:"="===t[p-1]?1:0)),a=o>0?p-4:p;var A=0;for(e=0,r=0;e<a;e+=4,r+=3)n=f[t.charCodeAt(e)]<<18|f[t.charCodeAt(e+1)]<<12|f[t.charCodeAt(e+2)]<<6|f[t.charCodeAt(e+3)],i[A++]=(16711680&n)>>16,i[A++]=(65280&n)>>8,i[A++]=255&n;return 2===o?(n=f[t.charCodeAt(e)]<<2|f[t.charCodeAt(e+1)]>>4,i[A++]=255&n):1===o&&(n=f[t.charCodeAt(e)]<<10|f[t.charCodeAt(e+1)]<<4|f[t.charCodeAt(e+2)]>>2,i[A++]=n>>8&255,i[A++]=255&n),i}function a(t,a){var n,i,s,l,f=0;if("UInt64"===o.attributes.header_type?f=8:"UInt32"===o.attributes.header_type&&(f=4),"binary"===t.attributes.format&&a){var u,p,A,d,h,c;if("Float32"===t.attributes.type)var y=new Float32Array;else"Int64"===t.attributes.type&&(y=new Int32Array);p=(u=r(t["#text"]))[0];for(var b=1;b<f-1;b++)p|=u[b]<<b*f;for(d=(p+3)*f,c=d+=d%3>0?3-d%3:0,(h=[]).push(c),A=3*f,b=0;b<p;b++){for(var v=u[b*f+A],x=1;x<f-1;x++)v|=u[b*f+A+x]<<8*x;c+=v,h.push(c)}for(b=0;b<h.length-1;b++)w=(w=new Zlib.Inflate(u.slice(h[b],h[b+1]),{resize:!0,verify:!0}).decompress()).buffer,"Float32"===t.attributes.type?(w=new Float32Array(w),i=w,s=void 0,l=void 0,s=(n=y).length,(l=new Float32Array(s+i.length)).set(n),l.set(i,s),y=l):"Int64"===t.attributes.type&&(y=e(y,w=new Int32Array(w)));delete t["#text"],"Int64"===t.attributes.type&&"binary"===t.attributes.format&&(y=y.filter(function(t,e){if(e%2!=1)return!0}))}else{if("binary"!==t.attributes.format||a)if(t["#text"])var w=t["#text"].split(/\s+/).filter(function(t){if(""!==t)return t});else w=new Int32Array(0).buffer;else w=(w=r(t["#text"])).slice(f).buffer;delete t["#text"],"Float32"===t.attributes.type?y=new Float32Array(w):"Int32"===t.attributes.type?y=new Int32Array(w):"Int64"===t.attributes.type&&(y=new Int32Array(w),"binary"===t.attributes.format&&(y=y.filter(function(t,e){if(e%2!=1)return!0})))}return y}var n=null;if(window.DOMParser)try{n=(new DOMParser).parseFromString(t,"text/xml")}catch(t){n=null}else{if(!window.ActiveXObject)throw new Error("Cannot parse xml string!");try{if((n=new ActiveXObject("Microsoft.XMLDOM")).async=!1,!n.loadXML())throw new Error(n.parseError.reason+n.parseError.srcText)}catch(t){n=null}}var o=function t(e){var r={};if(1===e.nodeType){if(e.attributes&&e.attributes.length>0){r.attributes={};for(var a=0;a<e.attributes.length;a++){var n=e.attributes.item(a);r.attributes[n.nodeName]=n.nodeValue.trim()}}}else 3===e.nodeType&&(r=e.nodeValue.trim());if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var i=e.childNodes.item(o),s=i.nodeName;if(void 0===r[s])""!==(f=t(i))&&(r[s]=f);else{if(void 0===r[s].push){var l=r[s];r[s]=[l]}var f;""!==(f=t(i))&&r[s].push(f)}}return r}(n.documentElement),i=[],s=[],l=[];if(o.PolyData){for(var f=o.PolyData.Piece,u=o.attributes.hasOwnProperty("compressor"),p=["PointData","Points","Strips","Polys"],A=0,d=p.length;A<d;){var h=f[p[A]];if(h&&h.DataArray){if("[object Array]"===Object.prototype.toString.call(h.DataArray))var c=h.DataArray;else c=[h.DataArray];for(var y=0,b=c.length;y<b;)"#text"in c[y]&&c[y]["#text"].length>0&&(c[y].text=a(c[y],u)),y++;switch(p[A]){case"PointData":var v=parseInt(f.attributes.NumberOfPoints),x=h.attributes.Normals;if(v>0)for(var w=0,I=c.length;w<I;w++)if(x===c[w].attributes.Name){var g=c[w].attributes.NumberOfComponents;(s=new Float32Array(v*g)).set(c[w].text,0)}break;case"Points":(v=parseInt(f.attributes.NumberOfPoints))>0&&(g=h.DataArray.attributes.NumberOfComponents,(i=new Float32Array(v*g)).set(h.DataArray.text,0));break;case"Strips":var m=parseInt(f.attributes.NumberOfStrips);if(m>0){var O=new Int32Array(h.DataArray[0].text.length),F=new Int32Array(h.DataArray[1].text.length);O.set(h.DataArray[0].text,0),F.set(h.DataArray[1].text,0);var D=m+O.length;l=new Uint32Array(3*D-9*m);var T=0;for(w=0,I=m;w<I;w++){for(var L=[],P=0,S=F[w],C=0;P<S-C;P++)L.push(O[P]),w>0&&(C=F[w-1]);var N=0;for(S=F[w],C=0;N<S-C-2;N++)N%2?(l[T++]=L[N],l[T++]=L[N+2],l[T++]=L[N+1]):(l[T++]=L[N],l[T++]=L[N+1],l[T++]=L[N+2]),w>0&&(C=F[w-1])}}break;case"Polys":var E=parseInt(f.attributes.NumberOfPolys);if(E>0){O=new Int32Array(h.DataArray[0].text.length),F=new Int32Array(h.DataArray[1].text.length),O.set(h.DataArray[0].text,0),F.set(h.DataArray[1].text,0),D=E+O.length,l=new Uint32Array(3*D-9*E),T=0;var B=0;for(w=0,I=E,C=0;w<I;){var U=[];for(P=0,S=F[w];P<S-C;)U.push(O[B++]),P++;for(N=1;N<S-C-1;)l[T++]=U[0],l[T++]=U[N],l[T++]=U[N+1],N++;C=F[++w-1]}}}}A++}var j=new BufferGeometry;return j.setIndex(new BufferAttribute(l,1)),j.setAttribute("position",new BufferAttribute(i,3)),s.length===i.length&&j.setAttribute("normal",new BufferAttribute(s,3)),j}throw new Error("Unsupported DATASET type")}(r(t)):a[2].includes("ASCII")?function(t){var e,r=[],a=[],n=[],o=[],i=/^[^\d.\s-]+/,s=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,l=/^(\d+)\s+([\s\d]*)/,f=/^POINTS /,u=/^POLYGONS /,p=/^TRIANGLE_STRIPS /,A=/^POINT_DATA[ ]+(\d+)/,d=/^CELL_DATA[ ]+(\d+)/,h=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,c=/^NORMALS[ ]+(\w+)[ ]+(\w+)/,y=!1,b=!1,v=!1,x=!1,w=!1,I=!1,g=!1,m=t.split("\n");for(var O in m){var F=m[O].trim();if(0===F.indexOf("DATASET")){var D=F.split(" ")[1];if("POLYDATA"!==D)throw new Error("Unsupported DATASET type: "+D)}else if(y)for(;null!==(e=s.exec(F))&&null===i.exec(F);){var T=parseFloat(e[1]),L=parseFloat(e[2]),P=parseFloat(e[3]);a.push(T,L,P)}else if(b){if(null!==(e=l.exec(F))){var S=parseInt(e[1]),C=e[2].split(/\s+/);if(S>=3)for(var N=parseInt(C[0]),E=1,B=0;B<S-2;++B)U=parseInt(C[E]),j=parseInt(C[E+1]),r.push(N,U,j),E++}}else if(v){if(null!==(e=l.exec(F))){var U,j;if(S=parseInt(e[1]),C=e[2].split(/\s+/),S>=3)for(B=0;B<S-2;B++)B%2==1?(N=parseInt(C[B]),U=parseInt(C[B+2]),j=parseInt(C[B+1]),r.push(N,U,j)):(N=parseInt(C[B]),U=parseInt(C[B+1]),j=parseInt(C[B+2]),r.push(N,U,j))}}else if(x||w)if(I)for(;null!==(e=s.exec(F))&&null===i.exec(F);){var G=parseFloat(e[1]),R=parseFloat(e[2]),_=parseFloat(e[3]);n.push(G,R,_)}else if(g)for(;null!==(e=s.exec(F))&&null===i.exec(F);){var M=parseFloat(e[1]),V=parseFloat(e[2]),k=parseFloat(e[3]);o.push(M,V,k)}null!==u.exec(F)?(b=!0,y=!1,v=!1):null!==f.exec(F)?(b=!1,y=!0,v=!1):null!==p.exec(F)?(b=!1,y=!1,v=!0):null!==A.exec(F)?(x=!0,y=!1,b=!1,v=!1):null!==d.exec(F)?(w=!0,y=!1,b=!1,v=!1):null!==h.exec(F)?(I=!0,g=!1,y=!1,b=!1,v=!1):null!==c.exec(F)&&(g=!0,I=!1,y=!1,b=!1,v=!1)}var K=new BufferGeometry;if(K.setIndex(r),K.setAttribute("position",new Float32BufferAttribute(a,3)),o.length===a.length&&K.setAttribute("normal",new Float32BufferAttribute(o,3)),n.length!==r.length)n.length===a.length&&K.setAttribute("color",new Float32BufferAttribute(n,3));else{var X=(K=K.toNonIndexed()).attributes.position.count/3;if(n.length===3*X){var Y=[];for(O=0;O<X;O++)G=n[3*O+0],R=n[3*O+1],_=n[3*O+2],Y.push(G,R,_),Y.push(G,R,_),Y.push(G,R,_);K.setAttribute("color",new Float32BufferAttribute(Y,3))}}return K}(r(t)):function(t){var e,r,a,n,o,i,s,l=new Uint8Array(t),f=new DataView(t),u=[],p=[],A=[],d=[],h=0;function c(t,e){for(var r=e,a=t[r],n=[];10!==a;)n.push(String.fromCharCode(a)),a=t[++r];return{start:e,end:r,next:r+1,parsedString:n.join("")}}for(;;){if(0===(s=(i=c(l,h)).parsedString).indexOf("DATASET")){var y=s.split(" ")[1];if("POLYDATA"!==y)throw new Error("Unsupported DATASET type: "+y)}else if(0===s.indexOf("POINTS")){for(d.push(s),e=4*(n=parseInt(s.split(" ")[1],10))*3,u=new Float32Array(3*n),r=i.next,a=0;a<n;a++)u[3*a]=f.getFloat32(r,!1),u[3*a+1]=f.getFloat32(r+4,!1),u[3*a+2]=f.getFloat32(r+8,!1),r+=12;i.next=i.next+e+1}else if(0===s.indexOf("TRIANGLE_STRIPS")){var b=parseInt(s.split(" ")[1],10);e=4*(g=parseInt(s.split(" ")[2],10)),A=new Uint32Array(3*g-9*b);var v=0;for(r=i.next,a=0;a<b;a++){var x=f.getInt32(r,!1),w=[];for(r+=4,o=0;o<x;o++)w.push(f.getInt32(r,!1)),r+=4;for(var I=0;I<x-2;I++)I%2?(A[v++]=w[I],A[v++]=w[I+2],A[v++]=w[I+1]):(A[v++]=w[I],A[v++]=w[I+1],A[v++]=w[I+2])}i.next=i.next+e+1}else if(0===s.indexOf("POLYGONS")){var g;for(b=parseInt(s.split(" ")[1],10),e=4*(g=parseInt(s.split(" ")[2],10)),A=new Uint32Array(3*g-9*b),v=0,r=i.next,a=0;a<b;a++){for(x=f.getInt32(r,!1),w=[],r+=4,o=0;o<x;o++)w.push(f.getInt32(r,!1)),r+=4;for(I=1;I<x-1;I++)A[v++]=w[0],A[v++]=w[I],A[v++]=w[I+1]}i.next=i.next+e+1}else if(0===s.indexOf("POINT_DATA")){for(n=parseInt(s.split(" ")[1],10),i=c(l,i.next),e=4*n*3,p=new Float32Array(3*n),r=i.next,a=0;a<n;a++)p[3*a]=f.getFloat32(r,!1),p[3*a+1]=f.getFloat32(r+4,!1),p[3*a+2]=f.getFloat32(r+8,!1),r+=12;i.next=i.next+e}if((h=i.next)>=l.byteLength)break}var m=new BufferGeometry;return m.setIndex(new BufferAttribute(A,1)),m.setAttribute("position",new BufferAttribute(u,3)),p.length===u.length&&m.setAttribute("normal",new BufferAttribute(p,3)),m}(t)}});export{VTKLoader};
//# sourceMappingURL=/sm/341e09002289a91d9ee6071501f87d3b6d39b134efa3f5a8555644fdd791aecb.map