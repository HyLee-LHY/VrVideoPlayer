/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/loaders/EXRLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{DataTextureLoader,FloatType,HalfFloatType,LinearEncoding,LinearFilter,NearestFilter,RGBAFormat,RGBEEncoding,RGBEFormat,RGBFormat,UnsignedByteType}from"../../../build/three.module.js";import{Zlib}from"../libs/inflate.module.min.js";var EXRLoader=function(e){DataTextureLoader.call(this,e),this.type=FloatType};EXRLoader.prototype=Object.assign(Object.create(DataTextureLoader.prototype),{constructor:EXRLoader,parse:function(e){const r=65536,n=r>>3,a=14,t=65537,i=1<<a,o=i-1,l=32768,f=65535,s=59,u=63,c=2+u-s,v=8,h=4,p=4,w=2,y=1,d=0,g=1,m=0,b=1,A=2,S=Math.pow(2.7182818,2.2);var U=new DataView(new ArrayBuffer(8));function M(e){if(0===e)return[e,0];U.setFloat64(0,e);var r=U.getUint32(0)>>>20&2047;0===r&&(U.setFloat64(0,e*Math.pow(2,64)),r=(U.getUint32(0)>>>20&2047)-64);var n=r-1022;return[function(e,r){for(var n=Math.min(3,Math.ceil(Math.abs(r)/1023)),a=e,t=0;t<n;t++)a*=Math.pow(2,Math.floor((r+t)/n));return a}(e,-n),n]}const E={l:0,c:0,lc:0};function R(e,r,n,a,t){for(;n<e;)r=r<<8|ne(a,t),n+=8;n-=e,E.l=r>>n&(1<<e)-1,E.c=r,E.lc=n}const I=new Array(59);function O(e,r,n,a,i,o,l){for(var f=n,v=0,h=0;i<=o;i++){if(f.value-n.value>a)return!1;R(6,v,h,e,f);var p=E.l;if(v=E.c,h=E.lc,l[i]=p,p==u){if(f.value-n.value>a)throw"Something wrong with hufUnpackEncTable";R(8,v,h,e,f);var w=E.l+c;if(v=E.c,h=E.lc,i+w>o+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)l[i++]=0;i--}else if(p>=s){if(i+(w=p-s+2)>o+1)throw"Something wrong with hufUnpackEncTable";for(;w--;)l[i++]=0;i--}}!function(e){for(var r=0;r<=58;++r)I[r]=0;for(r=0;r<t;++r)I[e[r]]+=1;var n=0;for(r=58;r>0;--r){var a=n+I[r]>>1;I[r]=n,n=a}for(r=0;r<t;++r){var i=e[r];i>0&&(e[r]=i|I[i]++<<6)}}(l)}function C(e){return 63&e}function x(e){return e>>6}const T={c:0,lc:0};function F(e,r,n,a){e=e<<8|ne(n,a),r+=8,T.c=e,T.lc=r}const z={c:0,lc:0};function N(e,r,n,a,t,i,o,l,f,s){if(e==r){a<8&&(F(n,a,t,o),n=T.c,a=T.lc);var u=n>>(a-=8);u=new Uint8Array([u])[0];if(f.value+u>s)return!1;for(var c=l[f.value-1];u-- >0;)l[f.value++]=c}else{if(!(f.value<s))return!1;l[f.value++]=e}z.c=n,z.lc=a}function P(e){return 65535&e}function L(e){var r=P(e);return r>32767?r-65536:r}const D={a:0,b:0};function B(e,r){var n=L(e),a=L(r),t=n+(1&a)+(a>>1),i=t,o=t-a;D.a=i,D.b=o}function k(e,r){var n=P(e),a=P(r),t=n-(a>>1)&f,i=a+t-l&f;D.a=i,D.b=t}function _(e,r,n,a,t,i,o){for(var l,f=o<16384,s=n>t?t:n,u=1;u<=s;)u<<=1;for(l=u>>=1,u>>=1;u>=1;){for(var c,v,h,p,w=0,y=w+i*(t-l),d=i*u,g=i*l,m=a*u,b=a*l;w<=y;w+=g){for(var A=w,S=w+a*(n-l);A<=S;A+=b){var U=A+m,M=(E=A+d)+m;f?(B(e[A+r],e[E+r]),c=D.a,h=D.b,B(e[U+r],e[M+r]),v=D.a,p=D.b,B(c,v),e[A+r]=D.a,e[U+r]=D.b,B(h,p),e[E+r]=D.a,e[M+r]=D.b):(k(e[A+r],e[E+r]),c=D.a,h=D.b,k(e[U+r],e[M+r]),v=D.a,p=D.b,k(c,v),e[A+r]=D.a,e[U+r]=D.b,k(h,p),e[E+r]=D.a,e[M+r]=D.b)}if(n&u){var E=A+d;f?B(e[A+r],e[E+r]):k(e[A+r],e[E+r]),c=D.a,e[E+r]=D.b,e[A+r]=c}}if(t&u)for(A=w,S=w+a*(n-l);A<=S;A+=b){U=A+m;f?B(e[A+r],e[U+r]):k(e[A+r],e[U+r]),c=D.a,e[U+r]=D.b,e[A+r]=c}l=u,u>>=1}return w}function X(e,r,n,l,f,s){var u=n.value,c=re(r,n),v=re(r,n);n.value+=4;var h=re(r,n);if(n.value+=4,c<0||c>=t||v<0||v>=t)throw"Something wrong with HUF_ENCSIZE";var p=new Array(t),w=new Array(i);if(function(e){for(var r=0;r<i;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(w),O(e,0,n,l-(n.value-u),c,v,p),h>8*(l-(n.value-u)))throw"Something wrong with hufUncompress";!function(e,r,n,t){for(;r<=n;r++){var i=x(e[r]),o=C(e[r]);if(i>>o)throw"Invalid table entry";if(o>a){if((u=t[i>>o-a]).len)throw"Invalid table entry";if(u.lit++,u.p){var l=u.p;u.p=new Array(u.lit);for(var f=0;f<u.lit-1;++f)u.p[f]=l[f]}else u.p=new Array(1);u.p[u.lit-1]=r}else if(o){var s=0;for(f=1<<a-o;f>0;f--){var u;if((u=t[(i<<a-o)+s]).len||u.p)throw"Invalid table entry";u.len=o,u.lit=r,s++}}}}(p,c,v,w),function(e,r,n,t,i,l,f,s,u,c){for(var v=0,h=0,p=s,w=Math.trunc(i.value+(l+7)/8);i.value<w;)for(F(v,h,n,i),v=T.c,h=T.lc;h>=a;)if((m=r[v>>h-a&o]).len)h-=m.len,N(m.lit,f,v,h,n,0,i,u,c,p),v=z.c,h=z.lc;else{if(!m.p)throw"hufDecode issues";var y;for(y=0;y<m.lit;y++){for(var d=C(e[m.p[y]]);h<d&&i.value<w;)F(v,h,n,i),v=T.c,h=T.lc;if(h>=d&&x(e[m.p[y]])==(v>>h-d&(1<<d)-1)){h-=d,N(m.p[y],f,v,h,n,0,i,u,c,p),v=z.c,h=z.lc;break}}if(y==m.lit)throw"hufDecode issues"}var g=8-l&7;for(v>>=g,h-=g;h>0;){var m;if(!(m=r[v<<a-h&o]).len)throw"hufDecode issues";h-=m.len,N(m.lit,f,v,h,n,0,i,u,c,p),v=z.c,h=z.lc}}(p,w,e,0,n,h,v,s,f,{value:0})}function Z(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function V(e,r){for(var n=0,a=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[n++],t>i));)r[t++]=e[a++]}function G(e){for(var r=e.byteLength,n=new Array,a=0,t=new DataView(e);r>0;){var i=t.getInt8(a++);if(i<0){r-=(l=-i)+1;for(var o=0;o<l;o++)n.push(t.getUint8(a++))}else{var l=i;r-=2;var f=t.getUint8(a++);for(o=0;o<l+1;o++)n.push(f)}}return n}function W(e,r,n){for(var a,t=1;t<64;)65280==(a=r[e.value])?t=64:a>>8==255?t+=255&a:(n[t]=a,t++),e.value++}function H(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(.196349375),a=.5*Math.cos(.39269875),t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(1.374445625);for(var f=new Array(4),s=new Array(4),u=new Array(4),c=new Array(4),v=0;v<8;++v){var h=8*v;f[0]=a*e[h+2],f[1]=o*e[h+2],f[2]=a*e[h+6],f[3]=o*e[h+6],s[0]=n*e[h+1]+t*e[h+3]+i*e[h+5]+l*e[h+7],s[1]=t*e[h+1]-l*e[h+3]-n*e[h+5]-i*e[h+7],s[2]=i*e[h+1]-n*e[h+3]+l*e[h+5]+t*e[h+7],s[3]=l*e[h+1]-i*e[h+3]+t*e[h+5]-n*e[h+7],u[0]=r*(e[h+0]+e[h+4]),u[3]=r*(e[h+0]-e[h+4]),u[1]=f[0]+f[3],u[2]=f[1]-f[2],c[0]=u[0]+u[1],c[1]=u[3]+u[2],c[2]=u[3]-u[2],c[3]=u[0]-u[1],e[h+0]=c[0]+s[0],e[h+1]=c[1]+s[1],e[h+2]=c[2]+s[2],e[h+3]=c[3]+s[3],e[h+4]=c[3]-s[3],e[h+5]=c[2]-s[2],e[h+6]=c[1]-s[1],e[h+7]=c[0]-s[0]}for(var p=0;p<8;++p)f[0]=a*e[16+p],f[1]=o*e[16+p],f[2]=a*e[48+p],f[3]=o*e[48+p],s[0]=n*e[8+p]+t*e[24+p]+i*e[40+p]+l*e[56+p],s[1]=t*e[8+p]-l*e[24+p]-n*e[40+p]-i*e[56+p],s[2]=i*e[8+p]-n*e[24+p]+l*e[40+p]+t*e[56+p],s[3]=l*e[8+p]-i*e[24+p]+t*e[40+p]-n*e[56+p],u[0]=r*(e[p]+e[32+p]),u[3]=r*(e[p]-e[32+p]),u[1]=f[0]+f[3],u[2]=f[1]-f[2],c[0]=u[0]+u[1],c[1]=u[3]+u[2],c[2]=u[3]-u[2],c[3]=u[0]-u[1],e[0+p]=c[0]+s[0],e[8+p]=c[1]+s[1],e[16+p]=c[2]+s[2],e[24+p]=c[3]+s[3],e[32+p]=c[3]-s[3],e[40+p]=c[2]-s[2],e[48+p]=c[1]-s[1],e[56+p]=c[0]-s[0]}function Y(e){for(var r=0;r<64;++r){var n=e[0][r],a=e[1][r],t=e[2][r];e[0][r]=n+1.5747*t,e[1][r]=n-.1873*a-.4682*t,e[2][r]=n+1.8556*a}}function j(e,r,n){for(var a=0;a<64;++a)r[n+a]=le(q(e[a]))}function q(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(S,Math.abs(e)-1)}function J(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===Zlib&&console.error("THREE.EXRLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var n=new Zlib.Inflate(r,{resize:!0,verify:!0}),a=new Uint8Array(n.decompress().buffer),t=new Uint8Array(a.length);return Z(a),V(a,t),new DataView(t.buffer)}function K(e){var r=e.viewer,n={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(ve.channels.length*e.type*w)),t={version:te(r,n),unknownUncompressedSize:te(r,n),unknownCompressedSize:te(r,n),acCompressedSize:te(r,n),dcCompressedSize:te(r,n),rleCompressedSize:te(r,n),rleUncompressedSize:te(r,n),rleRawSize:te(r,n),totalAcUncompressedCount:te(r,n),totalDcUncompressedCount:te(r,n),acCompression:te(r,n)};if(t.version<2)throw"EXRLoader.parse: "+ve.compression+" version "+t.version+" is unsupported";for(var i=new Array,o=fe(r,n)-w;o>0;){var l=Q(r.buffer,n),f=ae(r,n),s=f>>2&3,u=new Int8Array([(f>>4)-1])[0],c=ae(r,n);i.push({name:l,index:u,type:c,compression:s}),o-=l.length+3}for(var v=ve.channels,h=new Array(e.channels),p=0;p<e.channels;++p){var y=h[p]={},S=v[p];y.name=S.name,y.compression=m,y.decoded=!1,y.type=S.pixelType,y.pLinear=S.pLinear,y.width=e.width,y.height=e.lines}for(var U={idx:new Array(3)},M=0;M<e.channels;++M)for(y=h[M],p=0;p<i.length;++p){var E=i[p];y.name==E.name&&(y.compression=E.compression,E.index>=0&&(U.idx[E.index]=M),y.offset=M)}if(t.acCompressedSize>0)switch(t.acCompression){case d:var R=new Uint16Array(t.totalAcUncompressedCount);X(e.array,r,n,t.acCompressedSize,R,t.totalAcUncompressedCount);break;case g:var I=e.array.slice(n.value,n.value+t.totalAcUncompressedCount),O=new Zlib.Inflate(I,{resize:!0,verify:!0});R=new Uint16Array(O.decompress().buffer);n.value+=t.totalAcUncompressedCount}if(t.dcCompressedSize>0){var C={array:e.array,offset:n,size:t.dcCompressedSize},x=new Uint16Array(J(C).buffer);n.value+=t.dcCompressedSize}if(t.rleRawSize>0){I=e.array.slice(n.value,n.value+t.rleCompressedSize);var T=G((O=new Zlib.Inflate(I,{resize:!0,verify:!0})).decompress().buffer);n.value+=t.rleCompressedSize}var F=0,z=new Array(h.length);for(p=0;p<z.length;++p)z[p]=new Array;for(var N=0;N<e.lines;++N)for(var P=0;P<h.length;++P)z[P].push(F),F+=h[P].width*e.type*w;!function(e,r,n,a,t,i){var o=new DataView(i.buffer),l=n[e.idx[0]].width,f=n[e.idx[0]].height,s=Math.floor(l/8),u=Math.ceil(l/8),c=Math.ceil(f/8),v=l-8*(u-1),h=f-8*(c-1),p={value:0},y=new Array(3),d=new Array(3),g=new Array(3),m=new Array(3),b=new Array(3);for(let n=0;n<3;++n)b[n]=r[e.idx[n]],y[n]=n<1?0:y[n-1]+u*c,d[n]=new Float32Array(64),g[n]=new Uint16Array(64),m[n]=new Uint16Array(64*u);for(let r=0;r<c;++r){var A=8;r==c-1&&(A=h);var S=8;for(let e=0;e<u;++e){e==u-1&&(S=v);for(let e=0;e<3;++e)g[e].fill(0),g[e][0]=t[y[e]++],W(p,a,g[e]),U=g[e],(M=d[e])[0]=oe(U[0]),M[1]=oe(U[1]),M[2]=oe(U[5]),M[3]=oe(U[6]),M[4]=oe(U[14]),M[5]=oe(U[15]),M[6]=oe(U[27]),M[7]=oe(U[28]),M[8]=oe(U[2]),M[9]=oe(U[4]),M[10]=oe(U[7]),M[11]=oe(U[13]),M[12]=oe(U[16]),M[13]=oe(U[26]),M[14]=oe(U[29]),M[15]=oe(U[42]),M[16]=oe(U[3]),M[17]=oe(U[8]),M[18]=oe(U[12]),M[19]=oe(U[17]),M[20]=oe(U[25]),M[21]=oe(U[30]),M[22]=oe(U[41]),M[23]=oe(U[43]),M[24]=oe(U[9]),M[25]=oe(U[11]),M[26]=oe(U[18]),M[27]=oe(U[24]),M[28]=oe(U[31]),M[29]=oe(U[40]),M[30]=oe(U[44]),M[31]=oe(U[53]),M[32]=oe(U[10]),M[33]=oe(U[19]),M[34]=oe(U[23]),M[35]=oe(U[32]),M[36]=oe(U[39]),M[37]=oe(U[45]),M[38]=oe(U[52]),M[39]=oe(U[54]),M[40]=oe(U[20]),M[41]=oe(U[22]),M[42]=oe(U[33]),M[43]=oe(U[38]),M[44]=oe(U[46]),M[45]=oe(U[51]),M[46]=oe(U[55]),M[47]=oe(U[60]),M[48]=oe(U[21]),M[49]=oe(U[34]),M[50]=oe(U[37]),M[51]=oe(U[47]),M[52]=oe(U[50]),M[53]=oe(U[56]),M[54]=oe(U[59]),M[55]=oe(U[61]),M[56]=oe(U[35]),M[57]=oe(U[36]),M[58]=oe(U[48]),M[59]=oe(U[49]),M[60]=oe(U[57]),M[61]=oe(U[58]),M[62]=oe(U[62]),M[63]=oe(U[63]),H(d[e]);Y(d);for(let r=0;r<3;++r)j(d[r],m[r],64*e)}let i=0;for(let a=0;a<3;++a){let t=n[e.idx[a]].type;for(let e=8*r;e<8*r+A;++e){i=b[a][e];for(let r=0;r<s;++r){let n=64*r+8*(7&e);o.setUint16(i+0*w*t,m[a][n+0],!0),o.setUint16(i+1*w*t,m[a][n+1],!0),o.setUint16(i+2*w*t,m[a][n+2],!0),o.setUint16(i+3*w*t,m[a][n+3],!0),o.setUint16(i+4*w*t,m[a][n+4],!0),o.setUint16(i+5*w*t,m[a][n+5],!0),o.setUint16(i+6*w*t,m[a][n+6],!0),o.setUint16(i+7*w*t,m[a][n+7],!0),i+=8*w*t}}if(s!=u)for(let e=8*r;e<8*r+A;++e){let r=b[a][e]+8*s*w*t,n=64*s+8*(7&e);for(let e=0;e<S;++e)o.setUint16(r+e*w*t,m[a][n+e],!0)}}}var U,M;for(var E=new Uint16Array(l),R=(o=new DataView(i.buffer),0);R<3;++R){n[e.idx[R]].decoded=!0;var I=n[e.idx[R]].type;if(2==n[R].type)for(var O=0;O<f;++O){let e=b[R][O];for(var C=0;C<l;++C)E[C]=o.getUint16(e+C*w*I,!0);for(C=0;C<l;++C)o.setFloat32(e+C*w*I,oe(E[C]),!0)}}}(U,z,h,R,x,a);for(p=0;p<h.length;++p){if(!(y=h[p]).decoded)switch(y.compression){case A:var L=0,D=0;for(N=0;N<e.lines;++N){for(var B=z[p][L],k=0;k<y.width;++k){for(var _=0;_<w*y.type;++_)a[B++]=T[D+_*y.width*y.height];D++}L++}break;case b:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function Q(e,r){for(var n=new Uint8Array(e),a=0;0!=n[r.value+a];)a+=1;var t=(new TextDecoder).decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,t}function $(e,r){var n=e.getUint32(0,!0);return r.value=r.value+v,n}function ee(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+p,n}function re(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+p,n}function ne(e,r){var n=e[r.value];return r.value=r.value+y,n}function ae(e,r){var n=e.getUint8(r.value);return r.value=r.value+y,n}function te(e,r){var n=Number(e.getBigInt64(r.value,!0));return r.value+=v,n}function ie(e,r){var n=e.getFloat32(r.value,!0);return r.value+=h,n}function oe(e){var r=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(r?31===r?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):n/1024*6103515625e-14)}function le(e){U.setFloat32(0,e);var r=U.getInt32(0),n=r>>16&32768,a=r>>12&2047,t=r>>23&255;return t<103?n:t>142?(n|=31744,n|=(255==t?0:1)&&8388607&r):t<113?n|=((a|=2048)>>114-t)+(a>>113-t&1):(n|=t-112<<10|a>>1,n+=1&a)}function fe(e,r){var n=e.getUint16(r.value,!0);return r.value+=w,n}function se(e,r,n,a,t){if("string"===a||"stringvector"===a||"iccProfile"===a)return function(e,r,n){var a=(new TextDecoder).decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,a}(r,n,t);if("chlist"===a)return function(e,r,n,a){for(var t=n.value,i=[];n.value<t+a-1;){var o=Q(r,n),l=ee(e,n),f=ae(e,n);n.value+=3;var s=ee(e,n),u=ee(e,n);i.push({name:o,pixelType:l,pLinear:f,xSampling:s,ySampling:u})}return n.value+=1,i}(e,r,n,t);if("chromaticities"===a)return function(e,r){return{redX:ie(e,r),redY:ie(e,r),greenX:ie(e,r),greenY:ie(e,r),blueX:ie(e,r),blueY:ie(e,r),whiteX:ie(e,r),whiteY:ie(e,r)}}(e,n);if("compression"===a)return function(e,r){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][ae(e,r)]}(e,n);if("box2i"===a)return function(e,r){return{xMin:re(e,r),yMin:re(e,r),xMax:re(e,r),yMax:re(e,r)}}(e,n);if("lineOrder"===a)return function(e,r){return["INCREASING_Y"][ae(e,r)]}(e,n);if("float"===a)return ie(e,n);if("v2f"===a)return function(e,r){return[ie(e,r),ie(e,r)]}(e,n);if("int"===a)return ee(e,n);if("rational"===a)return function(e,r){return[ee(e,r),re(e,r)]}(e,n);if("timecode"===a)return function(e,r){return[re(e,r),re(e,r)]}(e,n);throw"Cannot parse value for unsupported type: "+a}var ue=new DataView(e),ce=new Uint8Array(e),ve={};ue.getUint32(0,!0),ue.getUint8(4,!0),ue.getUint8(5,!0);for(var he={value:8},pe=!0;pe;){var we=Q(e,he);if(0==we)pe=!1;else{var ye=se(ue,e,he,Q(e,he),re(ue,he));ve[we]=ye}}var de,ge,me,be,Ae=ve.dataWindow.yMax+1;switch(ve.compression){case"NO_COMPRESSION":ge=1,de=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ge=1,de=function(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(G(r)),a=new Uint8Array(n.length);return Z(n),V(n,a),new DataView(a.buffer)};break;case"ZIPS_COMPRESSION":ge=1,de=J;break;case"ZIP_COMPRESSION":ge=16,de=J;break;case"PIZ_COMPRESSION":ge=32,de=function(e){for(var a=e.viewer,t={value:e.offset.value},i=e.width*ge*(ve.channels.length*e.type),o=new Uint16Array(i),l=new Uint8Array(n),f=0,s=new Array(e.channels),u=0;u<e.channels;u++)s[u]={},s[u].start=f,s[u].end=s[u].start,s[u].nx=e.width,s[u].ny=e.lines,s[u].size=e.type,f+=s[u].nx*s[u].ny*s[u].size;var c=fe(a,t),v=fe(a,t);if(v>=n)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=v)for(u=0;u<v-c+1;u++)l[u+c]=ae(a,t);var h=new Uint16Array(r),p=function(e,n){for(var a=0,t=0;t<r;++t)(0==t||e[t>>3]&1<<(7&t))&&(n[a++]=t);for(var i=a-1;a<r;)n[a++]=0;return i}(l,h),y=re(a,t);for(X(e.array,a,t,y,o,f),u=0;u<e.channels;++u)for(var d=s[u],g=0;g<s[u].size;++g)_(o,d.start+g,d.nx,d.size,d.ny,d.nx*d.size,p);!function(e,r,n){for(var a=0;a<n;++a)r[a]=e[r[a]]}(h,o,f);for(var m=0,b=new Uint8Array(o.buffer.byteLength),A=0;A<e.lines;A++)for(var S=0;S<e.channels;S++){var U=(d=s[S]).nx*d.size,M=new Uint8Array(o.buffer,d.end*w,U*w);b.set(M,m),m+=U*w,d.end+=U}return new DataView(b.buffer)};break;case"DWAA_COMPRESSION":ge=32,de=K;break;case"DWAB_COMPRESSION":ge=256,de=K;break;default:throw"EXRLoader.parse: "+ve.compression+" is unsupported"}var Se=ve.channels[0].pixelType;if(1===Se)switch(this.type){case UnsignedByteType:case FloatType:be=function(e,r){return oe(fe(e,r))},me=w;break;case HalfFloatType:be=fe,me=w}else{if(2!==Se)throw"EXRLoader.parse: unsupported pixelType "+Se+" for "+ve.compression+".";switch(this.type){case UnsignedByteType:case FloatType:be=ie,me=h;break;case HalfFloatType:be=function(e,r){return le(ie(e,r))},me=h}}for(var Ue=Ae/ge,Me=0;Me<Ue;Me++)$(ue,he);var Ee=ve.dataWindow.xMax-ve.dataWindow.xMin+1,Re=ve.dataWindow.yMax-ve.dataWindow.yMin+1,Ie=Ee*Re*4;switch(this.type){case UnsignedByteType:case FloatType:var Oe=new Float32Array(Ie);ve.channels.length<4&&Oe.fill(1,0,Ie);break;case HalfFloatType:Oe=new Uint16Array(Ie);ve.channels.length<4&&Oe.fill(15360,0,Ie);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var Ce,xe,Te={R:0,G:1,B:2,A:3},Fe={size:0,width:Ee,lines:ge,offset:he,array:ce,viewer:ue,type:Se,channels:ve.channels.length},ze={value:0},Ne=0;Ne<Re/ge;Ne++){Ce=re(ue,he),Ie=re(ue,he),Fe.lines=Ce+ge>Re?Re-Ce:ge,Fe.offset=he,Fe.size=Ie,xe=de(Fe),he.value+=Ie;for(var Pe=0;Pe<ge;Pe++){var Le=Pe+Ne*ge;if(Le>=Re)break;for(var De=0;De<ve.channels.length;De++)for(var Be=Te[ve.channels[De].name],ke=0;ke<Ee;ke++){var _e=Pe*(ve.channels.length*Ee)+De*Ee+ke;ze.value=_e*me;var Xe=be(xe,ze);Oe[4*Ee*(Re-1-Le)+4*ke+Be]=Xe}}}if(this.type===UnsignedByteType){let e,r,n;const a=Oe.length,t=new Uint8Array(a);for(let a=0;a<Re;++a)for(let i=0;i<Ee;++i){r=a*Ee*4+4*i;const o=Oe[n=(Re-1-a)*Ee*4+4*i],l=Oe[n+1],f=Oe[n+2];if((e=f>(e=o>l?o:l)?f:e)<1e-32)t[r]=t[r+1]=t[r+2]=t[r+3]=0;else{const n=M(e);e=256*n[0]/e,t[r]=o*e,t[r+1]=l*e,t[r+2]=f*e,t[r+3]=n[1]+128}}Oe=t}let Ze=this.type===UnsignedByteType?RGBEFormat:RGBAFormat;return{header:ve,width:Ee,height:Re,data:Oe,format:Ze,type:this.type}},setDataType:function(e){return this.type=e,this},load:function(e,r,n,a){return DataTextureLoader.prototype.load.call(this,e,function(e,n){switch(e.type){case UnsignedByteType:e.encoding=RGBEEncoding,e.minFilter=NearestFilter,e.magFilter=NearestFilter,e.generateMipmaps=!1,e.flipY=!0;break;case FloatType:case HalfFloatType:e.encoding=LinearEncoding,e.minFilter=LinearFilter,e.magFilter=LinearFilter,e.generateMipmaps=!1,e.flipY=!1}r&&r(e,n)},n,a)}});export{EXRLoader};
//# sourceMappingURL=/sm/72978c49e8910613d2a6b9cbbd044b598e1fb3971a250a4bd69ea549d0122bae.map