/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/modifiers/SimplifyModifier.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BufferGeometry,Float32BufferAttribute,Geometry,Vector3}from"../../../build/three.module.js";var SimplifyModifier=function(){};!function(){var e=new Vector3,o=new Vector3;function i(e,o){var i=e.indexOf(o);i>-1&&e.splice(i,1)}function t(e,o){var i,t,r,s=o.position.distanceTo(e.position),n=0,h=[],f=e.faces.length;for(i=0;i<f;i++)(t=e.faces[i]).hasVertex(o)&&h.push(t);for(i=0;i<f;i++){var a=1;t=e.faces[i];for(var l=0;l<h.length;l++){r=h[l];var v=t.normal.dot(r.normal);a=Math.min(a,(1.001-v)/2)}n=Math.max(n,a)}return h.length<2&&(n=1),s*n+0}function r(e){if(0===e.neighbors.length)return e.collapseNeighbor=null,void(e.collapseCost=-.01);e.collapseCost=1e5,e.collapseNeighbor=null;for(var o=0;o<e.neighbors.length;o++){var i=t(e,e.neighbors[o]);e.collapseNeighbor||(e.collapseNeighbor=e.neighbors[o],e.collapseCost=i,e.minCost=i,e.totalCost=0,e.costCount=0),e.costCount++,e.totalCost+=i,i<e.minCost&&(e.collapseNeighbor=e.neighbors[o],e.minCost=i)}e.collapseCost=e.totalCost/e.costCount}function s(e,o){for(console.assert(0===e.faces.length);e.neighbors.length;){i(e.neighbors.pop().neighbors,e)}i(o,e)}function n(e,o){i(o,e),e.v1&&i(e.v1.faces,e),e.v2&&i(e.v2.faces,e),e.v3&&i(e.v3.faces,e);for(var t,r,s=[e.v1,e.v2,e.v3],n=0;n<3;n++)r=s[(n+1)%3],(t=s[n])&&r&&(t.removeIfNonNeighbor(r),r.removeIfNonNeighbor(t))}function h(e,o,i,t){if(t){var h,f=[];for(h=0;h<i.neighbors.length;h++)f.push(i.neighbors[h]);for(h=i.faces.length-1;h>=0;h--)i.faces[h].hasVertex(t)&&n(i.faces[h],o);for(h=i.faces.length-1;h>=0;h--)i.faces[h].replaceVertex(i,t);for(s(i,e),h=0;h<f.length;h++)r(f[h])}else s(i,e)}function f(e){for(var o=e[0],i=0;i<e.length;i++)e[i].collapseCost<o.collapseCost&&(o=e[i]);return o}function a(e,o,i,t,r,s){this.a=t,this.b=r,this.c=s,this.v1=e,this.v2=o,this.v3=i,this.normal=new Vector3,this.computeNormal(),e.faces.push(this),e.addUniqueNeighbor(o),e.addUniqueNeighbor(i),o.faces.push(this),o.addUniqueNeighbor(e),o.addUniqueNeighbor(i),i.faces.push(this),i.addUniqueNeighbor(e),i.addUniqueNeighbor(o)}function l(e,o){this.position=e,this.id=o,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}a.prototype.computeNormal=function(){var i=this.v1.position,t=this.v2.position,r=this.v3.position;e.subVectors(r,t),o.subVectors(i,t),e.cross(o).normalize(),this.normal.copy(e)},a.prototype.hasVertex=function(e){return e===this.v1||e===this.v2||e===this.v3},a.prototype.replaceVertex=function(e,o){e===this.v1?this.v1=o:e===this.v2?this.v2=o:e===this.v3&&(this.v3=o),i(e.faces,this),o.faces.push(this),e.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(e),e.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(e),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()},l.prototype.addUniqueNeighbor=function(e){var o,i;o=this.neighbors,i=e,-1===o.indexOf(i)&&o.push(i)},l.prototype.removeIfNonNeighbor=function(e){var o=this.neighbors,i=this.faces,t=o.indexOf(e);if(-1!==t){for(var r=0;r<i.length;r++)if(i[r].hasVertex(e))return;o.splice(t,1)}},SimplifyModifier.prototype.modify=function(e,o){e.isBufferGeometry&&(e=(new Geometry).fromBufferGeometry(e)),e.mergeVertices();var i,t,s,n=e.vertices,v=e.faces,c=[],u=[];for(i=0,t=n.length;i<t;i++){var g=new l(n[i],i);c.push(g)}for(i=0,t=v.length;i<t;i++){var p=(q=v[i]).a,b=q.b,d=q.c,N=new a(c[p],c[b],c[d],p,b,d);u.push(N)}for(i=0,t=c.length;i<t;i++)r(c[i]);for(var m=o;m--;){if(!(s=f(c))){console.log("THREE.SimplifyModifier: No next vertex");break}h(c,u,s,s.collapseNeighbor)}var y=new BufferGeometry,x=[],C=[];for(i=0;i<c.length;i++){g=c[i].position;x.push(g.x,g.y,g.z)}for(i=0;i<u.length;i++){var q=u[i];p=c.indexOf(q.v1),b=c.indexOf(q.v2),d=c.indexOf(q.v3);C.push(p,b,d)}return y.setAttribute("position",new Float32BufferAttribute(x,3)),y.setIndex(C),y}}();export{SimplifyModifier};
//# sourceMappingURL=/sm/a3e3f71645d508ba5142350358fa58d835a379d1b790e64e91b123016d4004da.map