/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/jsm/renderers/Projector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{BackSide,Box3,BufferGeometry,Color,DoubleSide,FrontSide,Frustum,Geometry,Light,Line,LineSegments,Matrix3,Matrix4,Mesh,Points,Sprite,Vector2,Vector3,Vector4}from"../../../build/three.module.js";var RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},RenderableFace=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.v3=new RenderableVertex,this.normalModel=new Vector3,this.vertexNormalsModel=[new Vector3,new Vector3,new Vector3],this.vertexNormalsLength=0,this.color=new Color,this.material=null,this.uvs=[new Vector2,new Vector2,new Vector2],this.z=0,this.renderOrder=0},RenderableVertex=function(){this.position=new Vector3,this.positionWorld=new Vector3,this.positionScreen=new Vector4,this.visible=!0};RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)};var RenderableLine=function(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.vertexColors=[new Color,new Color],this.material=null,this.z=0,this.renderOrder=0},RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Vector2,this.material=null,this.renderOrder=0},Projector=function(){var e,r,t,i,o,n,a,s,l,c,p,u=[],f=0,d=[],h=0,m=[],v=0,y=[],x=0,g=[],S=0,b={objects:[],lights:[],elements:[]},w=new Vector3,M=new Vector4,z=new Box3(new Vector3(-1,-1,-1),new Vector3(1,1,1)),V=new Box3,j=new Array(3),R=new Matrix4,O=new Matrix4,C=new Matrix4,L=new Matrix3,T=new Frustum,B=new Vector4,k=new Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var W=new function(){var e=[],r=[],i=[],n=null,s=new Matrix3;function l(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(p),i.copy(t).applyMatrix4(O);var o=1/i.w;i.x*=o,i.y*=o,i.z*=o,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function c(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(j[0]=e.positionScreen,j[1]=r.positionScreen,j[2]=t.positionScreen,z.intersectsBox(V.setFromPoints(j)))}function u(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(t){n=t,s.getNormalMatrix(n.matrixWorld),e.length=0,r.length=0,i.length=0},projectVertex:l,checkTriangleVisibility:c,checkBackfaceCulling:u,pushVertex:function(e,r,i){(t=N()).position.set(e,r,i),l(t)},pushNormal:function(r,t,i){e.push(r,t,i)},pushColor:function(e,t,i){r.push(e,t,i)},pushUv:function(e,r){i.push(e,r)},pushLine:function(e,t){var i=d[e],o=d[t];i.positionScreen.copy(i.position).applyMatrix4(C),o.positionScreen.copy(o.position).applyMatrix4(C),!0===E(i.positionScreen,o.positionScreen)&&(i.positionScreen.multiplyScalar(1/i.positionScreen.w),o.positionScreen.multiplyScalar(1/o.positionScreen.w),(a=G()).id=n.id,a.v1.copy(i),a.v2.copy(o),a.z=Math.max(i.positionScreen.z,o.positionScreen.z),a.renderOrder=n.renderOrder,a.material=n.material,n.material.vertexColors&&(a.vertexColors[0].fromArray(r,3*e),a.vertexColors[1].fromArray(r,3*t)),b.elements.push(a))},pushTriangle:function(t,a,l,p){var f=d[t],h=d[a],m=d[l];if(!1!==c(f,h,m)&&(p.side===DoubleSide||!0===u(f,h,m))){(o=P()).id=n.id,o.v1.copy(f),o.v2.copy(h),o.v3.copy(m),o.z=(f.positionScreen.z+h.positionScreen.z+m.positionScreen.z)/3,o.renderOrder=n.renderOrder,w.subVectors(m.position,h.position),M.subVectors(f.position,h.position),w.cross(M),o.normalModel.copy(w),o.normalModel.applyMatrix3(s).normalize();for(var v=0;v<3;v++){var y=o.vertexNormalsModel[v];y.fromArray(e,3*arguments[v]),y.applyMatrix3(s).normalize(),o.uvs[v].fromArray(i,2*arguments[v])}o.vertexNormalsLength=3,o.material=p,p.vertexColors&&o.color.fromArray(r,3*t),b.elements.push(o)}}}};function A(t){(e=function(){if(r===f){var e=new RenderableObject;return u.push(e),f++,r++,e}return u[r++]}()).id=t.id,e.object=t,w.setFromMatrixPosition(t.matrixWorld),w.applyMatrix4(O),e.z=w.z,e.renderOrder=t.renderOrder,b.objects.push(e)}function F(e,r,t){var i=1/e.w;e.z*=i,e.z>=-1&&e.z<=1&&((l=function(){if(c===S){var e=new RenderableSprite;return g.push(e),S++,c++,e}return g[c++]}()).id=r.id,l.x=e.x*i,l.y=e.y*i,l.z=e.z,l.renderOrder=r.renderOrder,l.object=r,l.rotation=r.rotation,l.scale.x=r.scale.x*Math.abs(l.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),l.scale.y=r.scale.y*Math.abs(l.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),l.material=r.material,b.elements.push(l))}function N(){if(i===h){var e=new RenderableVertex;return d.push(e),h++,i++,e}return d[i++]}function P(){if(n===v){var e=new RenderableFace;return m.push(e),v++,n++,e}return m[n++]}function G(){if(s===x){var e=new RenderableLine;return y.push(e),x++,s++,e}return y[s++]}function I(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function E(e,r){var t=0,i=1,o=e.z+e.w,n=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;return o>=0&&n>=0&&a>=0&&s>=0||!(o<0&&n<0||a<0&&s<0)&&(o<0?t=Math.max(t,o/(o-n)):n<0&&(i=Math.min(i,o/(o-n))),a<0?t=Math.max(t,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<t)&&(e.lerp(r,t),r.lerp(e,1-i),!0))}this.projectScene=function(e,t,l,u){n=0,s=0,c=0,b.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),R.copy(t.matrixWorldInverse),O.multiplyMatrices(t.projectionMatrix,R),T.setFromProjectionMatrix(O),r=0,b.objects.length=0,b.lights.length=0,function e(r){if(!1!==r.visible){if(r instanceof Light)b.lights.push(r);else if(r instanceof Mesh||r instanceof Line||r instanceof Points){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===T.intersectsObject(r))return;A(r)}else if(r instanceof Sprite){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===T.intersectsSprite(r))return;A(r)}for(var t=r.children,i=0,o=t.length;i<o;i++)e(t[i])}}(e),!0===l&&b.objects.sort(I);for(var f=b.objects,h=0,m=f.length;h<m;h++){var v=f[h].object,y=v.geometry;if(W.setObject(v),p=v.matrixWorld,i=0,v instanceof Mesh){if(y instanceof BufferGeometry){var x=v.material,g=Array.isArray(x),S=y.attributes,z=y.groups;if(void 0===S.position)continue;for(var V=0,j=(je=S.position.array).length;V<j;V+=3){var D=je[V],U=je[V+1],H=je[V+2];if(!0===x.morphTargets)for(var X=y.morphAttributes.position,Y=y.morphTargetsRelative,Z=v.morphTargetInfluences,q=0,J=X.length;q<J;q++){if(0!==(le=Z[q])){var K=X[q];Y?(D+=K.getX(V/3)*le,U+=K.getY(V/3)*le,H+=K.getZ(V/3)*le):(D+=(K.getX(V/3)-je[V])*le,U+=(K.getY(V/3)-je[V+1])*le,H+=(K.getZ(V/3)-je[V+2])*le)}}W.pushVertex(D,U,H)}if(void 0!==S.normal){var Q=S.normal.array;for(V=0,j=Q.length;V<j;V+=3)W.pushNormal(Q[V],Q[V+1],Q[V+2])}if(void 0!==S.color)for(V=0,j=(ze=S.color.array).length;V<j;V+=3)W.pushColor(ze[V],ze[V+1],ze[V+2]);if(void 0!==S.uv){var $=S.uv.array;for(V=0,j=$.length;V<j;V+=2)W.pushUv($[V],$[V+1])}if(null!==y.index){var _=y.index.array;if(z.length>0)for(var ee=0;ee<z.length;ee++){var re=z[ee];if(void 0!==(x=!0===g?v.material[re.materialIndex]:v.material))for(V=re.start,j=re.start+re.count;V<j;V+=3)W.pushTriangle(_[V],_[V+1],_[V+2],x)}else for(V=0,j=_.length;V<j;V+=3)W.pushTriangle(_[V],_[V+1],_[V+2],x)}else if(z.length>0)for(ee=0;ee<z.length;ee++){re=z[ee];if(void 0!==(x=!0===g?v.material[re.materialIndex]:v.material))for(V=re.start,j=re.start+re.count;V<j;V+=3)W.pushTriangle(V,V+1,V+2,x)}else for(V=0,j=je.length/3;V<j;V+=3)W.pushTriangle(V,V+1,V+2,x)}else if(y instanceof Geometry){var te=y.vertices,ie=y.faces,oe=y.faceVertexUvs[0];L.getNormalMatrix(p);x=v.material,g=Array.isArray(x);for(var ne=0,ae=te.length;ne<ae;ne++){var se=te[ne];if(w.copy(se),!0===x.morphTargets)for(X=y.morphTargets,Z=v.morphTargetInfluences,q=0,J=X.length;q<J;q++){var le;if(0!==(le=Z[q])){var ce=(K=X[q]).vertices[ne];w.x+=(ce.x-se.x)*le,w.y+=(ce.y-se.y)*le,w.z+=(ce.z-se.z)*le}}W.pushVertex(w.x,w.y,w.z)}for(var pe=0,ue=ie.length;pe<ue;pe++){var fe=ie[pe];if(void 0!==(x=!0===g?v.material[fe.materialIndex]:v.material)){var de=x.side,he=d[fe.a],me=d[fe.b],ve=d[fe.c];if(!1!==W.checkTriangleVisibility(he,me,ve)){var ye=W.checkBackfaceCulling(he,me,ve);if(de!==DoubleSide){if(de===FrontSide&&!1===ye)continue;if(de===BackSide&&!0===ye)continue}(o=P()).id=v.id,o.v1.copy(he),o.v2.copy(me),o.v3.copy(ve),o.normalModel.copy(fe.normal),!1!==ye||de!==BackSide&&de!==DoubleSide||o.normalModel.negate(),o.normalModel.applyMatrix3(L).normalize();for(var xe=fe.vertexNormals,ge=0,Se=Math.min(xe.length,3);ge<Se;ge++){var be=o.vertexNormalsModel[ge];be.copy(xe[ge]),!1!==ye||de!==BackSide&&de!==DoubleSide||be.negate(),be.applyMatrix3(L).normalize()}o.vertexNormalsLength=xe.length;var we=oe[pe];if(void 0!==we)for(var Me=0;Me<3;Me++)o.uvs[Me].copy(we[Me]);o.color=fe.color,o.material=x,o.z=(he.positionScreen.z+me.positionScreen.z+ve.positionScreen.z)/3,o.renderOrder=v.renderOrder,b.elements.push(o)}}}}}else if(v instanceof Line){if(C.multiplyMatrices(O,p),y instanceof BufferGeometry){if(void 0!==(S=y.attributes).position){for(V=0,j=(je=S.position.array).length;V<j;V+=3)W.pushVertex(je[V],je[V+1],je[V+2]);if(void 0!==S.color){var ze;for(V=0,j=(ze=S.color.array).length;V<j;V+=3)W.pushColor(ze[V],ze[V+1],ze[V+2])}if(null!==y.index)for(V=0,j=(_=y.index.array).length;V<j;V+=2)W.pushLine(_[V],_[V+1]);else{var Ve=v instanceof LineSegments?2:1;for(V=0,j=je.length/3-1;V<j;V+=Ve)W.pushLine(V,V+1)}}}else if(y instanceof Geometry){if(0===(te=v.geometry.vertices).length)continue;(he=N()).positionScreen.copy(te[0]).applyMatrix4(C);for(Ve=v instanceof LineSegments?2:1,ne=1,ae=te.length;ne<ae;ne++)(he=N()).positionScreen.copy(te[ne]).applyMatrix4(C),(ne+1)%Ve>0||(me=d[i-2],B.copy(he.positionScreen),k.copy(me.positionScreen),!0===E(B,k)&&(B.multiplyScalar(1/B.w),k.multiplyScalar(1/k.w),(a=G()).id=v.id,a.v1.positionScreen.copy(B),a.v2.positionScreen.copy(k),a.z=Math.max(B.z,k.z),a.renderOrder=v.renderOrder,a.material=v.material,v.material.vertexColors&&(a.vertexColors[0].copy(v.geometry.colors[ne]),a.vertexColors[1].copy(v.geometry.colors[ne-1])),b.elements.push(a)))}}else if(v instanceof Points){if(C.multiplyMatrices(O,p),y instanceof Geometry)for(ne=0,ae=(te=v.geometry.vertices).length;ne<ae;ne++){se=te[ne];M.set(se.x,se.y,se.z,1),M.applyMatrix4(C),F(M,v,t)}else if(y instanceof BufferGeometry){if(void 0!==(S=y.attributes).position){var je;for(V=0,j=(je=S.position.array).length;V<j;V+=3)M.set(je[V],je[V+1],je[V+2],1),M.applyMatrix4(C),F(M,v,t)}}}else v instanceof Sprite&&(v.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,v.matrixWorld),M.set(p.elements[12],p.elements[13],p.elements[14],1),M.applyMatrix4(O),F(M,v,t))}return!0===u&&b.elements.sort(I),b}};export{RenderableObject,RenderableFace,RenderableVertex,RenderableLine,RenderableSprite,Projector};
//# sourceMappingURL=/sm/2e519faa7c60de96307ecb4435806252e9249e7a55c55c226e7b80dde5e54632.map