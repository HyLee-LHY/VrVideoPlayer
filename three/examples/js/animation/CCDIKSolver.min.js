/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/js/animation/CCDIKSolver.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
console.warn("THREE.CCDIKSolver: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/index.html#manual/en/introduction/Import-via-modules."),THREE.CCDIKSolver=function(){function e(e,t){this.mesh=e,this.iks=t||[],this._valid()}var t,r,i,o,n,a,s,l,h,c;function E(e,t){THREE.Object3D.call(this),this.root=e,this.iks=t||[],this.matrix.copy(e.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new THREE.SphereBufferGeometry(.25,16,8),this.targetSphereMaterial=new THREE.MeshBasicMaterial({color:new THREE.Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new THREE.MeshBasicMaterial({color:new THREE.Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new THREE.MeshBasicMaterial({color:new THREE.Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new THREE.LineBasicMaterial({color:new THREE.Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}return e.prototype={constructor:e,update:(t=new THREE.Quaternion,r=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Vector3,n=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Quaternion,l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,function(){for(var e=this.mesh.skeleton.bones,E=this.iks,d=Math,p=0,m=E.length;p<m;p++){var u=E[p],f=e[u.effector],v=e[u.target];r.setFromMatrixPosition(v.matrixWorld);for(var T=u.links,w=void 0!==u.iteration?u.iteration:1,H=0;H<w;H++){for(var M=!1,R=0,x=T.length;R<x;R++){var g=e[T[R].index];if(!1===T[R].enabled)break;var y=T[R].limitation,b=T[R].rotationMin,k=T[R].rotationMax;g.matrixWorld.decompose(a,s,l),s.inverse(),o.setFromMatrixPosition(f.matrixWorld),n.subVectors(o,a),n.applyQuaternion(s),n.normalize(),i.subVectors(r,a),i.applyQuaternion(s),i.normalize();var V=i.dot(n);if(V>1?V=1:V<-1&&(V=-1),!((V=d.acos(V))<1e-5)){if(void 0!==u.minAngle&&V<u.minAngle&&(V=u.minAngle),void 0!==u.maxAngle&&V>u.maxAngle&&(V=u.maxAngle),h.crossVectors(n,i),h.normalize(),t.setFromAxisAngle(h,V),g.quaternion.multiply(t),void 0!==y){var W=g.quaternion.w;W>1&&(W=1);var A=d.sqrt(1-W*W);g.quaternion.set(y.x*A,y.y*A,y.z*A,W)}void 0!==b&&g.rotation.setFromVector3(g.rotation.toVector3(c).max(b)),void 0!==k&&g.rotation.setFromVector3(g.rotation.toVector3(c).min(k)),g.updateMatrixWorld(!0),M=!0}}if(!M)break}}return this}),createHelper:function(){return new E(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){for(var e=this.iks,t=this.mesh.skeleton.bones,r=0,i=e.length;r<i;r++){var o,n,a=e[r],s=t[a.effector],l=a.links;o=s;for(var h=0,c=l.length;h<c;h++)n=t[l[h].index],o.parent!==n&&console.warn("THREE.CCDIKSolver: bone "+o.name+" is not the child of bone "+n.name),o=n}}},E.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:E,updateMatrixWorld:function(){var e=new THREE.Matrix4,t=new THREE.Vector3;function r(e,r){return t.setFromMatrixPosition(e.matrixWorld).applyMatrix4(r)}function i(e,t,i,o){var n=r(i,o);e[3*t+0]=n.x,e[3*t+1]=n.y,e[3*t+2]=n.z}return function(t){var o=this.root;if(this.visible){var n=0,a=this.iks,s=o.skeleton.bones;e.getInverse(o.matrixWorld);for(var l=0,h=a.length;l<h;l++){var c=a[l],E=s[c.target],d=s[c.effector],p=this.children[n++],m=this.children[n++];p.position.copy(r(E,e)),m.position.copy(r(d,e));for(var u=0,f=c.links.length;u<f;u++){var v=s[c.links[u].index];this.children[n++].position.copy(r(v,e))}var T=this.children[n++],w=T.geometry.attributes.position.array;i(w,0,E,e),i(w,1,d,e);for(u=0,f=c.links.length;u<f;u++){i(w,u+2,v=s[c.links[u].index],e)}T.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(o.matrixWorld),THREE.Object3D.prototype.updateMatrixWorld.call(this,t)}}(),_init:function(){var e=this,t=this.iks;function r(t){return new THREE.Line(function(e){var t=new THREE.BufferGeometry,r=new Float32Array(3*(2+e.links.length));return t.setAttribute("position",new THREE.BufferAttribute(r,3)),t}(t),e.lineMaterial)}for(var i=0,o=t.length;i<o;i++){var n=t[i];this.add(new THREE.Mesh(e.sphereGeometry,e.targetSphereMaterial)),this.add(new THREE.Mesh(e.sphereGeometry,e.effectorSphereMaterial));for(var a=0,s=n.links.length;a<s;a++)this.add(new THREE.Mesh(e.sphereGeometry,e.linkSphereMaterial));this.add(r(n))}}}),e}();
//# sourceMappingURL=/sm/cdc8a099a991f535b8cd3d8774b398823630a16916fe5128198576a184d960df.map