/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/js/utils/SkeletonUtils.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function parallelTraverse(e,t,r){r(e,t);for(var n=0;n<e.children.length;n++)parallelTraverse(e.children[n],t.children[n],r)}console.warn("THREE.SkeletonUtils: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/index.html#manual/en/introduction/Import-via-modules."),THREE.SkeletonUtils={retarget:function(){var e=new THREE.Vector3,t=new THREE.Quaternion,r=new THREE.Vector3,n=new THREE.Matrix4,o=new THREE.Matrix4,i=new THREE.Matrix4;return function(a,s,l){(l=l||{}).preserveMatrix=void 0===l.preserveMatrix||l.preserveMatrix,l.preservePosition=void 0===l.preservePosition||l.preservePosition,l.preserveHipPosition=void 0!==l.preserveHipPosition&&l.preserveHipPosition,l.useTargetMatrix=void 0!==l.useTargetMatrix&&l.useTargetMatrix,l.hip=void 0!==l.hip?l.hip:"hip",l.names=l.names||{};var p,m,u,c,d,f,x=s.isObject3D?s.skeleton.bones:this.getBones(s),h=a.isObject3D?a.skeleton.bones:this.getBones(a);if(a.isObject3D?a.skeleton.pose():(l.useTargetMatrix=!0,l.preserveMatrix=!1),l.preservePosition)for(d=[],f=0;f<h.length;f++)d.push(h[f].position.clone());if(l.preserveMatrix)for(a.updateMatrixWorld(),a.matrixWorld.identity(),f=0;f<a.children.length;++f)a.children[f].updateMatrixWorld(!0);if(l.offsets)for(p=[],f=0;f<h.length;++f)m=h[f],u=l.names[m.name]||m.name,l.offsets&&l.offsets[u]&&(m.matrix.multiply(l.offsets[u]),m.matrix.decompose(m.position,m.quaternion,m.scale),m.updateMatrixWorld()),p.push(m.matrixWorld.clone());for(f=0;f<h.length;++f){if(m=h[f],u=l.names[m.name]||m.name,c=this.getBoneByName(u,x),i.copy(m.matrixWorld),c){if(c.updateMatrixWorld(),l.useTargetMatrix?o.copy(c.matrixWorld):(o.getInverse(a.matrixWorld),o.multiply(c.matrixWorld)),r.setFromMatrixScale(o),o.scale(r.set(1/r.x,1/r.y,1/r.z)),i.makeRotationFromQuaternion(t.setFromRotationMatrix(o)),a.isObject3D){var v=h.indexOf(m),E=p?p[v]:n.getInverse(a.skeleton.boneInverses[v]);i.multiply(E)}i.copyPosition(o)}m.parent&&m.parent.isBone?(m.matrix.getInverse(m.parent.matrixWorld),m.matrix.multiply(i)):m.matrix.copy(i),l.preserveHipPosition&&u===l.hip&&m.matrix.setPosition(e.set(0,m.position.y,0)),m.matrix.decompose(m.position,m.quaternion,m.scale),m.updateMatrixWorld()}if(l.preservePosition)for(f=0;f<h.length;++f)m=h[f],(u=l.names[m.name]||m.name)!==l.hip&&m.position.copy(d[f]);l.preserveMatrix&&a.updateMatrixWorld(!0)}}(),retargetClip:function(e,t,r,n){(n=n||{}).useFirstFramePosition=void 0!==n.useFirstFramePosition&&n.useFirstFramePosition,n.fps=void 0!==n.fps?n.fps:30,n.names=n.names||[],t.isObject3D||(t=this.getHelperFromSkeleton(t));var o,i,a,s,l,p,m=Math.round(r.duration*(n.fps/1e3)*1e3),u=1/n.fps,c=[],d=new THREE.AnimationMixer(t),f=this.getBones(e.skeleton),x=[];for(d.clipAction(r).play(),d.update(0),t.updateMatrixWorld(),l=0;l<m;++l){var h=l*u;for(this.retarget(e,t,n),p=0;p<f.length;++p)s=n.names[f[p].name]||f[p].name,this.getBoneByName(s,t.skeleton)&&(i=f[p],a=x[p]=x[p]||{bone:i},n.hip===s&&(a.pos||(a.pos={times:new Float32Array(m),values:new Float32Array(3*m)}),n.useFirstFramePosition&&(0===l&&(o=i.position.clone()),i.position.sub(o)),a.pos.times[l]=h,i.position.toArray(a.pos.values,3*l)),a.quat||(a.quat={times:new Float32Array(m),values:new Float32Array(4*m)}),a.quat.times[l]=h,i.quaternion.toArray(a.quat.values,4*l));d.update(u),t.updateMatrixWorld()}for(l=0;l<x.length;++l)(a=x[l])&&(a.pos&&c.push(new THREE.VectorKeyframeTrack(".bones["+a.bone.name+"].position",a.pos.times,a.pos.values)),c.push(new THREE.QuaternionKeyframeTrack(".bones["+a.bone.name+"].quaternion",a.quat.times,a.quat.values)));return d.uncacheAction(r),new THREE.AnimationClip(r.name,-1,c)},getHelperFromSkeleton:function(e){var t=new THREE.SkeletonHelper(e.bones[0]);return t.skeleton=e,t},getSkeletonOffsets:function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector2,i=new THREE.Vector2;return function(a,s,l){(l=l||{}).hip=void 0!==l.hip?l.hip:"hip",l.names=l.names||{},s.isObject3D||(s=this.getHelperFromSkeleton(s));var p,m,u,c,d=Object.keys(l.names),f=Object.values(l.names),x=s.isObject3D?s.skeleton.bones:this.getBones(s),h=a.isObject3D?a.skeleton.bones:this.getBones(a),v=[];for(a.skeleton.pose(),c=0;c<h.length;++c)if(p=h[c],u=l.names[p.name]||p.name,(m=this.getBoneByName(u,x))&&u!==l.hip){var E=this.getNearestBone(p.parent,d),g=this.getNearestBone(m.parent,f);E.updateMatrixWorld(),g.updateMatrixWorld(),e.setFromMatrixPosition(E.matrixWorld),t.setFromMatrixPosition(p.matrixWorld),r.setFromMatrixPosition(g.matrixWorld),n.setFromMatrixPosition(m.matrixWorld),o.subVectors(new THREE.Vector2(t.x,t.y),new THREE.Vector2(e.x,e.y)).normalize(),i.subVectors(new THREE.Vector2(n.x,n.y),new THREE.Vector2(r.x,r.y)).normalize();var M=o.angle()-i.angle(),T=(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,0,M));p.matrix.multiply(T),p.matrix.decompose(p.position,p.quaternion,p.scale),p.updateMatrixWorld(),v[u]=T}return v}}(),renameBones:function(e,t){for(var r=this.getBones(e),n=0;n<r.length;++n){var o=r[n];t[o.name]&&(o.name=t[o.name])}return this},getBones:function(e){return Array.isArray(e)?e:e.bones},getBoneByName:function(e,t){for(var r=0,n=this.getBones(t);r<n.length;r++)if(e===n[r].name)return n[r]},getNearestBone:function(e,t){for(;e.isBone;){if(-1!==t.indexOf(e.name))return e;e=e.parent}},findBoneTrackData:function(e,t){for(var r=/\[(.*)\]\.(.*)/,n={name:e},o=0;o<t.length;++o){var i=r.exec(t[o].name);i&&e===i[1]&&(n[i[2]]=o)}return n},getEqualsBonesNames:function(e,t){var r=this.getBones(e),n=this.getBones(t),o=[];e:for(var i=0;i<r.length;i++)for(var a=r[i].name,s=0;s<n.length;s++)if(a===n[s].name){o.push(a);continue e}return o},clone:function(e){var t=new Map,r=new Map,n=e.clone();return parallelTraverse(e,n,function(e,n){t.set(n,e),r.set(e,n)}),n.traverse(function(e){if(e.isSkinnedMesh){var n=e,o=t.get(e),i=o.skeleton.bones;n.skeleton=o.skeleton.clone(),n.bindMatrix.copy(o.bindMatrix),n.skeleton.bones=i.map(function(e){return r.get(e)}),n.bind(n.skeleton,n.bindMatrix)}}),n}};
//# sourceMappingURL=/sm/957ca92189a671df673e374b5a76f12c5c9258912a7af153a8d5e506e9cb0c79.map