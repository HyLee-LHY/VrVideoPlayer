/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/js/misc/ConvexObjectBreaker.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
console.warn("THREE.ConvexObjectBreaker: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/index.html#manual/en/introduction/Import-via-modules."),THREE.ConvexObjectBreaker=function(e,t){this.minSizeForBreak=e||1.4,this.smallDelta=t||1e-4,this.tempLine1=new THREE.Line3,this.tempPlane1=new THREE.Plane,this.tempPlane2=new THREE.Plane,this.tempPlane_Cut=new THREE.Plane,this.tempCM1=new THREE.Vector3,this.tempCM2=new THREE.Vector3,this.tempVector3=new THREE.Vector3,this.tempVector3_2=new THREE.Vector3,this.tempVector3_3=new THREE.Vector3,this.tempVector3_P0=new THREE.Vector3,this.tempVector3_P1=new THREE.Vector3,this.tempVector3_P2=new THREE.Vector3,this.tempVector3_N0=new THREE.Vector3,this.tempVector3_N1=new THREE.Vector3,this.tempVector3_AB=new THREE.Vector3,this.tempVector3_CB=new THREE.Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var r=0;r<900;r++)this.segments[r]=!1},THREE.ConvexObjectBreaker.prototype={constructor:THREE.ConvexObjectBreaker,prepareBreakableObject:function(e,t,r,n,o){e.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var s=e.userData;s.mass=t,s.velocity=r.clone(),s.angularVelocity=n.clone(),s.breakable=o},subdivideByImpact:function(e,t,r,n,o){var s=[],a=this.tempPlane1,i=this.tempPlane2;this.tempVector3.addVectors(t,r),a.setFromCoplanarPoints(t,e.position,this.tempVector3);var c=o+n,m=this;return function o(p,l,h,u){if(Math.random()<.05*u||u>c)s.push(p);else{var E=Math.PI;0===u?(i.normal.copy(a.normal),i.constant=a.constant):u<=n?(E=(h-l)*(.2+.6*Math.random())+l,m.tempVector3_2.copy(e.position).sub(t).applyAxisAngle(r,E).add(t),i.setFromCoplanarPoints(t,m.tempVector3,m.tempVector3_2)):(E=(.5*(1&u)+.2*(2-Math.random()))*Math.PI,m.tempVector3_2.copy(t).sub(p.position).applyAxisAngle(r,E).add(p.position),m.tempVector3_3.copy(r).add(p.position),i.setFromCoplanarPoints(p.position,m.tempVector3_3,m.tempVector3_2)),m.cutByPlane(p,i,m.tempResultObjects);var v=m.tempResultObjects.object1,d=m.tempResultObjects.object2;v&&o(v,l,E,u+1),d&&o(d,E,h,u+1)}}(e,0,2*Math.PI,0),s},cutByPlane:function(e,t,r){var n=e.geometry,o=n.attributes.position.array,s=n.attributes.normal.array,a=o.length/3,i=a/3,c=n.getIndex();function m(e,t){var r=3*e+t;return c?c[r]:r}c&&(i=(c=c.array).length/3);for(var p=[],l=[],h=this.smallDelta,u=a*a,E=0;E<u;E++)this.segments[E]=!1;var v=this.tempVector3_P0,d=this.tempVector3_P1,f=this.tempVector3_N0,V=this.tempVector3_N1;for(E=0;E<i-1;E++){var b=m(E,0),y=m(E,1),T=m(E,2);f.set(s[b],s[b]+1,s[b]+2);for(var R=E+1;R<i;R++){var C=m(R,0),H=m(R,1),j=m(R,2);V.set(s[C],s[C]+1,s[C]+2),1-f.dot(V)<h&&(b===C||b===H||b===j?y===C||y===H||y===j?(this.segments[b*a+y]=!0,this.segments[y*a+b]=!0):(this.segments[T*a+b]=!0,this.segments[b*a+T]=!0):y!==C&&y!==H&&y!==j||(this.segments[T*a+y]=!0,this.segments[y*a+T]=!0))}}var x=this.tempPlane_Cut;e.updateMatrix(),THREE.ConvexObjectBreaker.transformPlaneToLocalSpace(t,e.matrix,x);for(E=0;E<i;E++)for(var g=m(E,0),B=m(E,1),M=m(E,2),P=0;P<3;P++){var w=0===P?g:1===P?B:M,O=0===P?B:1===P?M:g;if(!this.segments[w*a+O]){this.segments[w*a+O]=!0,this.segments[O*a+w]=!0,v.set(o[3*w],o[3*w+1],o[3*w+2]),d.set(o[3*O],o[3*O+1],o[3*O+2]);var _=0;(k=x.distanceToPoint(v))>h?(_=2,l.push(v.clone())):k<-h?(_=1,p.push(v.clone())):(_=3,p.push(v.clone()),l.push(v.clone()));var k,z=0;if((k=x.distanceToPoint(d))>h?(z=2,l.push(d.clone())):k<-h?(z=1,p.push(d.clone())):(z=3,p.push(d.clone()),l.push(d.clone())),1===_&&2===z||2===_&&1===z){this.tempLine1.start.copy(v),this.tempLine1.end.copy(d);var I=new THREE.Vector3;if(void 0===(I=x.intersectLine(this.tempLine1,I)))return console.error("Internal error: segment does not intersect plane."),r.segmentedObject1=null,r.segmentedObject2=null,0;p.push(I),l.push(I.clone())}}}var D=.5*e.userData.mass;this.tempCM1.set(0,0,0);var F=0,S=p.length;if(S>0){for(E=0;E<S;E++)this.tempCM1.add(p[E]);this.tempCM1.divideScalar(S);for(E=0;E<S;E++){(q=p[E]).sub(this.tempCM1),F=Math.max(F,q.x,q.y,q.z)}this.tempCM1.add(e.position)}this.tempCM2.set(0,0,0);var L=0,A=l.length;if(A>0){for(E=0;E<A;E++)this.tempCM2.add(l[E]);this.tempCM2.divideScalar(A);for(E=0;E<A;E++){var q;(q=l[E]).sub(this.tempCM2),L=Math.max(L,q.x,q.y,q.z)}this.tempCM2.add(e.position)}var G=null,N=null,Y=0;return S>4&&((G=new THREE.Mesh(new THREE.ConvexBufferGeometry(p),e.material)).position.copy(this.tempCM1),G.quaternion.copy(e.quaternion),this.prepareBreakableObject(G,D,e.userData.velocity,e.userData.angularVelocity,2*F>this.minSizeForBreak),Y++),A>4&&((N=new THREE.Mesh(new THREE.ConvexBufferGeometry(l),e.material)).position.copy(this.tempCM2),N.quaternion.copy(e.quaternion),this.prepareBreakableObject(N,D,e.userData.velocity,e.userData.angularVelocity,2*L>this.minSizeForBreak),Y++),r.object1=G,r.object2=N,Y}},THREE.ConvexObjectBreaker.transformFreeVector=function(e,t){var r=e.x,n=e.y,o=e.z,s=t.elements;return e.x=s[0]*r+s[4]*n+s[8]*o,e.y=s[1]*r+s[5]*n+s[9]*o,e.z=s[2]*r+s[6]*n+s[10]*o,e},THREE.ConvexObjectBreaker.transformFreeVectorInverse=function(e,t){var r=e.x,n=e.y,o=e.z,s=t.elements;return e.x=s[0]*r+s[1]*n+s[2]*o,e.y=s[4]*r+s[5]*n+s[6]*o,e.z=s[8]*r+s[9]*n+s[10]*o,e},THREE.ConvexObjectBreaker.transformTiedVectorInverse=function(e,t){var r=e.x,n=e.y,o=e.z,s=t.elements;return e.x=s[0]*r+s[1]*n+s[2]*o-s[12],e.y=s[4]*r+s[5]*n+s[6]*o-s[13],e.z=s[8]*r+s[9]*n+s[10]*o-s[14],e},THREE.ConvexObjectBreaker.transformPlaneToLocalSpace=function(){var e=new THREE.Vector3;return function(t,r,n){n.normal.copy(t.normal),n.constant=t.constant;var o=THREE.ConvexObjectBreaker.transformTiedVectorInverse(t.coplanarPoint(e),r);THREE.ConvexObjectBreaker.transformFreeVectorInverse(n.normal,r),n.constant=-o.dot(n.normal)}}();
//# sourceMappingURL=/sm/d0cd9d13732f3231aab3f66dae992b44b82b02e56eb5ef7f5be7c2def6f841bd.map