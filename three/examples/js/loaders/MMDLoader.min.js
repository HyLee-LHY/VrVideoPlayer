/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/three@0.117.1/examples/js/loaders/MMDLoader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
console.warn("THREE.MMDLoader: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/index.html#manual/en/introduction/Import-via-modules."),THREE.MMDLoader=function(){function e(e){THREE.Loader.call(this,e),this.loader=new THREE.FileLoader(this.manager),this.parser=null,this.meshBuilder=new a(this.manager),this.animationBuilder=new o}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,setAnimationPath:function(e){return this.animationPath=e,this},load:function(e,t,a,r){var n,o=this.meshBuilder.setCrossOrigin(this.crossOrigin);n=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e);var i=this._extractExtension(e).toLowerCase();"pmd"===i||"pmx"===i?this["pmd"===i?"loadPMD":"loadPMX"](e,function(e){t(o.build(e,n,a,r))},a,r):r&&r(new Error("THREE.MMDLoader: Unknown model file extension ."+i+"."))},loadAnimation:function(e,t,a,r,n){var o=this.animationBuilder;this.loadVMD(e,function(e){a(t.isCamera?o.buildCameraAnimation(e):o.build(e,t))},r,n)},loadWithAnimation:function(e,t,a,r,n){var o=this;this.load(e,function(e){o.loadAnimation(t,e,function(t){a({mesh:e,animation:t})},r,n)},r,n)},loadPMD:function(e,t,a,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,function(e){t(n.parsePmd(e,!0))},a,r)},loadPMX:function(e,t,a,r){var n=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(e,function(e){t(n.parsePmx(e,!0))},a,r)},loadVMD:function(e,t,a,r){var n=Array.isArray(e)?e:[e],o=[],i=n.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer");for(var A=0,l=n.length;A<l;A++)this.loader.load(n[A],function(e){o.push(s.parseVmd(e,!0)),o.length===i&&t(s.mergeVmds(o))},a,r)},loadVPD:function(e,t,a,r,n){var o=this._getParser();this.loader.setMimeType(t?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").load(e,function(e){a(o.parseVpd(e,!0))},r,n)},_extractExtension:function(e){var t=e.lastIndexOf(".");return t<0?"":e.slice(t+1)},_getParser:function(){if(null===this.parser){if("undefined"==typeof MMDParser)throw new Error("THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new MMDParser.Parser}return this.parser}});var t=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function a(e){this.geometryBuilder=new r,this.materialBuilder=new n(e)}function r(){}function n(e){this.manager=e,this.textureLoader=new THREE.TextureLoader(this.manager),this.tgaLoader=null}function o(){}function i(e,t,a,r,n){THREE.Interpolant.call(this,e,t,a,r),this.interpolationParams=n}return a.prototype={constructor:a,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},build:function(e,t,a,r){var n=this.geometryBuilder.build(e),o=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(t).build(e,n,a,r),i=new THREE.SkinnedMesh(n,o),s=new THREE.Skeleton(function(e){var t,a,r,n,o=e.geometry,i=[];if(o&&void 0!==o.bones){for(r=0,n=o.bones.length;r<n;r++)a=o.bones[r],t=new THREE.Bone,i.push(t),t.name=a.name,t.position.fromArray(a.pos),t.quaternion.fromArray(a.rotq),void 0!==a.scl&&t.scale.fromArray(a.scl);for(r=0,n=o.bones.length;r<n;r++)-1!==(a=o.bones[r]).parent&&null!==a.parent&&void 0!==i[a.parent]?i[a.parent].add(i[r]):e.add(i[r])}return e.updateMatrixWorld(!0),i}(i));return i.bind(s),i}},r.prototype={constructor:r,build:function(e){for(var t=[],a=[],r=[],n=[],o=[],i=[],s=[],A=[],l=[],u=[],h=[],p=[],d=[],f=[],m=0,g={},c=0;c<e.metadata.vertexCount;c++){for(var E=e.vertices[c],R=0,T=E.position.length;R<T;R++)t.push(E.position[R]);for(R=0,T=E.normal.length;R<T;R++)r.push(E.normal[R]);for(R=0,T=E.uv.length;R<T;R++)a.push(E.uv[R]);for(R=0;R<4;R++)s.push(E.skinIndices.length-1>=R?E.skinIndices[R]:0);for(R=0;R<4;R++)A.push(E.skinWeights.length-1>=R?E.skinWeights[R]:0)}for(c=0;c<e.metadata.faceCount;c++){var v=e.faces[c];for(R=0,T=v.indices.length;R<T;R++)n.push(v.indices[R])}for(c=0;c<e.metadata.materialCount;c++){var C=e.materials[c];o.push({offset:3*m,count:3*C.faceCount}),m+=C.faceCount}for(c=0;c<e.metadata.rigidBodyCount;c++){var b=e.rigidBodies[c],x=g[b.boneIndex];x=void 0===x?b.type:Math.max(b.type,x),g[b.boneIndex]=x}for(c=0;c<e.metadata.boneCount;c++){-1!==(Y={parent:(Q=e.bones[c]).parentIndex,name:Q.name,pos:Q.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==g[c]?g[c]:-1}).parent&&(Y.pos[0]-=e.bones[Y.parent].position[0],Y.pos[1]-=e.bones[Y.parent].position[1],Y.pos[2]-=e.bones[Y.parent].position[2]),i.push(Y)}if("pmd"===e.metadata.format)for(c=0;c<e.metadata.ikCount;c++){var y={target:(B=e.iks[c]).target,effector:B.effector,iteration:B.iteration,maxAngle:4*B.maxAngle,links:[]};for(R=0,T=B.links.length;R<T;R++){(I={}).index=B.links[R].index,I.enabled=!0,e.bones[I.index].name.indexOf("ひざ")>=0&&(I.limitation=new THREE.Vector3(1,0,0)),y.links.push(I)}h.push(y)}else for(c=0;c<e.metadata.boneCount;c++){var B;if(void 0!==(B=e.bones[c].ik)){for(y={target:c,effector:B.effector,iteration:B.iteration,maxAngle:B.maxAngle,links:[]},R=0,T=B.links.length;R<T;R++){var I;if((I={}).index=B.links[R].index,I.enabled=!0,1===B.links[R].angleLimitation){var w=B.links[R].lowerLimitationAngle,M=B.links[R].upperLimitationAngle,H=-M[0],k=-M[1];M[0]=-w[0],M[1]=-w[1],w[0]=H,w[1]=k,I.rotationMin=(new THREE.Vector3).fromArray(w),I.rotationMax=(new THREE.Vector3).fromArray(M)}y.links.push(I)}h.push(y)}}if("pmx"===e.metadata.format){for(c=0;c<e.metadata.boneCount;c++){var Q,P=(Q=e.bones[c]).grant;if(void 0!==P){y={index:c,parentIndex:P.parentIndex,ratio:P.ratio,isLocal:P.isLocal,affectRotation:P.affectRotation,affectPosition:P.affectPosition,transformationClass:Q.transformationClass};p.push(y)}}p.sort(function(e,t){return e.transformationClass-t.transformationClass})}function U(t,a,r){for(var n=0;n<a.elementCount;n++){var o,i=a.elements[n];o="pmd"===e.metadata.format?e.morphs[0].elements[i.index].index:i.index,t.array[3*o+0]+=i.position[0]*r,t.array[3*o+1]+=i.position[1]*r,t.array[3*o+2]+=i.position[2]*r}}for(c=0;c<e.metadata.morphCount;c++){var V=e.morphs[c],O={name:V.name},L=new THREE.Float32BufferAttribute(3*e.metadata.vertexCount,3);L.name=V.name;for(R=0;R<3*e.metadata.vertexCount;R++)L.array[R]=t[R];if("pmd"===e.metadata.format)0!==c&&U(L,V,1);else if(0===V.type)for(R=0;R<V.elementCount;R++){var S=e.morphs[V.elements[R].index],D=V.elements[R].ratio;1===S.type&&U(L,S,D)}else 1===V.type?U(L,V,1):2===V.type||3===V.type||4===V.type||5===V.type||6===V.type||7===V.type||V.type;l.push(O),u.push(L)}for(c=0;c<e.metadata.rigidBodyCount;c++){var N=e.rigidBodies[c];O={};for(var F in N)O[F]=N[F];if("pmx"===e.metadata.format&&-1!==O.boneIndex){var Y=e.bones[O.boneIndex];O.position[0]-=Y.position[0],O.position[1]-=Y.position[1],O.position[2]-=Y.position[2]}d.push(O)}for(c=0;c<e.metadata.constraintCount;c++){var z=e.constraints[c];O={};for(var F in z)O[F]=z[F];var K=d[O.rigidBodyIndex1],J=d[O.rigidBodyIndex2];0!==K.type&&2===J.type&&-1!==K.boneIndex&&-1!==J.boneIndex&&e.bones[J.boneIndex].parentIndex===K.boneIndex&&(J.type=1),f.push(O)}var W=new THREE.BufferGeometry;W.setAttribute("position",new THREE.Float32BufferAttribute(t,3)),W.setAttribute("normal",new THREE.Float32BufferAttribute(r,3)),W.setAttribute("uv",new THREE.Float32BufferAttribute(a,2)),W.setAttribute("skinIndex",new THREE.Uint16BufferAttribute(s,4)),W.setAttribute("skinWeight",new THREE.Float32BufferAttribute(A,4)),W.setIndex(n);c=0;for(var _=o.length;c<_;c++)W.addGroup(o[c].offset,o[c].count,c);return W.bones=i,W.morphTargets=l,W.morphAttributes.position=u,W.morphTargetsRelative=!1,W.userData.MMD={bones:i,iks:h,grants:p,rigidBodies:d,constraints:f,format:e.metadata.format},W.computeBoundingSphere(),W}},n.prototype={constructor:n,crossOrigin:"anonymous",resourcePath:void 0,setCrossOrigin:function(e){return this.crossOrigin=e,this},setResourcePath:function(e){return this.resourcePath=e,this},build:function(e,t){var a=[],r={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var n=0;n<e.metadata.materialCount;n++){var o=e.materials[n],i={userData:{}};if(void 0!==o.name&&(i.name=o.name),i.color=(new THREE.Color).fromArray(o.diffuse),i.opacity=o.diffuse[3],i.specular=(new THREE.Color).fromArray(o.specular),i.emissive=(new THREE.Color).fromArray(o.ambient),i.shininess=Math.max(o.shininess,1e-4),i.transparent=1!==i.opacity,i.skinning=t.bones.length>0,i.morphTargets=t.morphTargets.length>0,i.fog=!0,i.blending=THREE.CustomBlending,i.blendSrc=THREE.SrcAlphaFactor,i.blendDst=THREE.OneMinusSrcAlphaFactor,i.blendSrcAlpha=THREE.SrcAlphaFactor,i.blendDstAlpha=THREE.DstAlphaFactor,"pmx"===e.metadata.format&&1==(1&o.flag)?i.side=THREE.DoubleSide:i.side=1===i.opacity?THREE.FrontSide:THREE.DoubleSide,"pmd"===e.metadata.format){if(o.fileName){var s=o.fileName.split("*");if(i.map=this._loadTexture(s[0],r),s.length>1){var A=s[1].slice(-4).toLowerCase();i.envMap=this._loadTexture(s[1],r,{sphericalReflectionMapping:!0}),i.combine=".sph"===A?THREE.MultiplyOperation:THREE.AddOperation}}var l=-1===o.toonIndex?"toon00.bmp":e.toonTextures[o.toonIndex].fileName;i.gradientMap=this._loadTexture(l,r,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(l)}),i.userData.outlineParameters={thickness:1===o.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===o.edgeFlag}}else{var u;-1!==o.textureIndex&&(i.map=this._loadTexture(e.textures[o.textureIndex],r)),-1===o.envTextureIndex||1!==o.envFlag&&2!=o.envFlag||(i.envMap=this._loadTexture(e.textures[o.envTextureIndex],r,{sphericalReflectionMapping:!0}),i.combine=1===o.envFlag?THREE.MultiplyOperation:THREE.AddOperation),-1===o.toonIndex||0!==o.toonFlag?(l="toon"+("0"+(o.toonIndex+1)).slice(-2)+".bmp",u=!0):(l=e.textures[o.toonIndex],u=!1),i.gradientMap=this._loadTexture(l,r,{isToonTexture:!0,isDefaultToonTexture:u}),i.userData.outlineParameters={thickness:o.edgeSize/300,color:o.edgeColor.slice(0,3),alpha:o.edgeColor[3],visible:0!=(16&o.flag)&&o.edgeSize>0}}void 0!==i.map&&(i.transparent||this._checkImageTransparency(i.map,t,n),i.emissive.multiplyScalar(.2)),a.push(new THREE.MeshToonMaterial(i))}if("pmx"===e.metadata.format){function h(e,t){for(var a=0,r=e.length;a<r;a++){var n=e[a];if(-1!==n.index){var o=t[n.index];o.opacity!==n.diffuse[3]&&(o.transparent=!0)}}}n=0;for(var p=e.morphs.length;n<p;n++){var d=e.morphs[n],f=d.elements;if(0===d.type)for(var m=0,g=f.length;m<g;m++){var c=e.morphs[f[m].index];8===c.type&&h(c.elements,a)}else 8===d.type&&h(f,a)}}return a},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===THREE.TGALoader)throw new Error("THREE.MMDLoader: Import THREE.TGALoader");this.tgaLoader=new THREE.TGALoader(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(e){return 10===e.length&&/toon(10|0[0-9])\.bmp/.test(e)},_loadTexture:function(e,a,r,n,o){var i,s=this;if(!0===(r=r||{}).isDefaultToonTexture){var A;try{A=parseInt(e.match(/toon([0-9]{2})\.bmp$/)[1])}catch(t){console.warn("THREE.MMDLoader: "+e+" seems like a not right default texture path. Using toon00.bmp instead."),A=0}i=t[A]}else i=this.resourcePath+e;if(void 0!==a[i])return a[i];var l=this.manager.getHandler(i);null===l&&(l=".tga"===e.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var u=l.load(i,function(e){!0===r.isToonTexture&&(e.image=s._getRotatedImage(e.image),e.magFilter=THREE.NearestFilter,e.minFilter=THREE.NearestFilter),e.flipY=!1,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping;for(var t=0;t<u.readyCallbacks.length;t++)u.readyCallbacks[t](u);delete u.readyCallbacks},n,o);return!0===r.sphericalReflectionMapping&&(u.mapping=THREE.SphericalReflectionMapping),u.readyCallbacks=[],a[i]=u,u},_getRotatedImage:function(e){var t=document.createElement("canvas"),a=t.getContext("2d"),r=e.width,n=e.height;return t.width=r,t.height=n,a.clearRect(0,0,r,n),a.translate(r/2,n/2),a.rotate(.5*Math.PI),a.translate(-r/2,-n/2),a.drawImage(e,0,0),a.getImageData(0,0,r,n)},_checkImageTransparency:function(e,t,a){e.readyCallbacks.push(function(r){function n(e,t){var a=e.width,r=e.height,n=Math.round(t.x*a)%a,o=Math.round(t.y*r)%r;n<0&&(n+=a),o<0&&(o+=r);var i=o*a+n;return e.data[4*i+3]}var o=void 0!==r.image.data?r.image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var a=t.getContext("2d");return a.drawImage(e,0,0),a.getImageData(0,0,t.width,t.height)}(r.image),i=t.groups[a];(function(e,t,a){var r=e.width,o=e.height;if(e.data.length/(r*o)!=4)return!1;for(var i=0;i<a.length;i+=3){for(var s={x:0,y:0},A=0;A<3;A++){var l=a[3*i+A],u={x:t[2*l+0],y:t[2*l+1]};if(n(e,u)<253)return!0;s.x+=u.x,s.y+=u.y}if(s.x/=3,s.y/=3,n(e,s)<253)return!0}return!1})(o,t.attributes.uv.array,t.index.array.slice(i.start,i.start+i.count))&&(e.transparent=!0)})}},o.prototype={constructor:o,build:function(e,t){for(var a=this.buildSkeletalAnimation(e,t).tracks,r=this.buildMorphAnimation(e,t).tracks,n=0,o=r.length;n<o;n++)a.push(r[n]);return new THREE.AnimationClip("",-1,a)},buildSkeletalAnimation:function(e,t){function a(e,t,a){e.push(t[a+0]/127),e.push(t[a+8]/127),e.push(t[a+4]/127),e.push(t[a+12]/127)}for(var r=[],n={},o=t.skeleton.bones,i={},s=0,A=o.length;s<A;s++)i[o[s].name]=!0;for(s=0;s<e.metadata.motionCount;s++){var l=e.motions[s],u=l.boneName;void 0!==i[u]&&(n[u]=n[u]||[],n[u].push(l))}for(var h in n){var p=n[h];p.sort(function(e,t){return e.frameNum-t.frameNum});var d=[],f=[],m=[],g=[],c=[],E=t.skeleton.getBoneByName(h).position.toArray();for(s=0,A=p.length;s<A;s++){var R=p[s].frameNum/30,T=p[s].position,v=p[s].rotation,C=p[s].interpolation;d.push(R);for(var b=0;b<3;b++)f.push(E[b]+T[b]);for(b=0;b<4;b++)m.push(v[b]);for(b=0;b<3;b++)a(g,C,b);a(c,C,3)}var x=".bones["+h+"]";r.push(this._createTrack(x+".position",THREE.VectorKeyframeTrack,d,f,g)),r.push(this._createTrack(x+".quaternion",THREE.QuaternionKeyframeTrack,d,m,c))}return new THREE.AnimationClip("",-1,r)},buildMorphAnimation:function(e,t){for(var a=[],r={},n=t.morphTargetDictionary,o=0;o<e.metadata.morphCount;o++){var i=e.morphs[o],s=i.morphName;void 0!==n[s]&&(r[s]=r[s]||[],r[s].push(i))}for(var A in r){var l=r[A];l.sort(function(e,t){return e.frameNum-t.frameNum});for(var u=[],h=[],p=(o=0,l.length);o<p;o++)u.push(l[o].frameNum/30),h.push(l[o].weight);a.push(new THREE.NumberKeyframeTrack(".morphTargetInfluences["+n[A]+"]",u,h))}return new THREE.AnimationClip("",-1,a)},buildCameraAnimation:function(e){function t(e,t){e.push(t.x),e.push(t.y),e.push(t.z)}function a(e,t,a){e.push(t[4*a+0]/127),e.push(t[4*a+1]/127),e.push(t[4*a+2]/127),e.push(t[4*a+3]/127)}var r=[],n=void 0===e.cameras?[]:e.cameras.slice();n.sort(function(e,t){return e.frameNum-t.frameNum});for(var o,i,s=[],A=[],l=[],u=[],h=[],p=[],d=[],f=[],m=[],g=new THREE.Quaternion,c=new THREE.Euler,E=new THREE.Vector3,R=new THREE.Vector3,T=0,v=n.length;T<v;T++){var C=n[T],b=C.frameNum/30,x=C.position,y=C.rotation,B=C.distance,I=C.fov,w=C.interpolation;s.push(b),E.set(0,0,-B),R.set(x[0],x[1],x[2]),c.set(-y[0],-y[1],-y[2]),g.setFromEuler(c),E.add(R),E.applyQuaternion(g),t(A,R),(o=l).push((i=g).x),o.push(i.y),o.push(i.z),o.push(i.w),t(u,E),h.push(I);for(var M=0;M<3;M++)a(p,w,M);a(d,w,3);for(M=0;M<3;M++)a(f,w,4);a(m,w,5)}return(r=[]).push(this._createTrack("target.position",THREE.VectorKeyframeTrack,s,A,p)),r.push(this._createTrack(".quaternion",THREE.QuaternionKeyframeTrack,s,l,d)),r.push(this._createTrack(".position",THREE.VectorKeyframeTrack,s,u,f)),r.push(this._createTrack(".fov",THREE.NumberKeyframeTrack,s,h,m)),new THREE.AnimationClip("",-1,r)},_createTrack:function(e,t,a,r,n){if(a.length>2){a=a.slice(),r=r.slice(),n=n.slice();for(var o=r.length/a.length,s=n.length/a.length,A=1,l=2,u=a.length;l<u;l++){for(var h=0;h<o;h++)if(r[A*o+h]!==r[(A-1)*o+h]||r[A*o+h]!==r[l*o+h]){A++;break}if(l>A){a[A]=a[l];for(h=0;h<o;h++)r[A*o+h]=r[l*o+h];for(h=0;h<s;h++)n[A*s+h]=n[l*s+h]}}a.length=A+1,r.length=(A+1)*o,n.length=(A+1)*s}var p=new t(e,a,r);return p.createInterpolant=function(e){return new i(this.times,this.values,this.getValueSize(),e,new Float32Array(n))},p}},i.prototype=Object.assign(Object.create(THREE.Interpolant.prototype),{constructor:i,interpolate_:function(e,t,a,r){var n=this.resultBuffer,o=this.sampleValues,i=this.valueSize,s=this.interpolationParams,A=e*i,l=A-i,u=r-t<.05?0:(a-t)/(r-t);if(4===i){var h=s[4*e+0],p=s[4*e+1],d=s[4*e+2],f=s[4*e+3],m=this._calculate(h,p,d,f,u);THREE.Quaternion.slerpFlat(n,0,o,l,o,A,m)}else if(3===i)for(var g=0;g!==i;++g){h=s[12*e+4*g+0],p=s[12*e+4*g+1],d=s[12*e+4*g+2],f=s[12*e+4*g+3],m=this._calculate(h,p,d,f,u);n[g]=o[l+g]*(1-m)+o[A+g]*m}else{h=s[4*e+0],p=s[4*e+1],d=s[4*e+2],f=s[4*e+3],m=this._calculate(h,p,d,f,u);n[0]=o[l]*(1-m)+o[A]*m}return n},_calculate:function(e,t,a,r,n){for(var o,i,s,A=.5,l=A,u=1-l,h=Math,p=0;p<15;p++){var d=(o=3*u*u*l)*e+(i=3*u*l*l)*t+(s=l*l*l)-n;if(h.abs(d)<1e-5)break;A/=2,u=1-(l+=d<0?A:-A)}return o*a+i*r+s}}),e}();
//# sourceMappingURL=/sm/2673cb920d7a18a0125ac77d05098c132b9e9799af35a771c83cc91eb8a805bd.map